leave_home:
  alias: Éteindre et Sécuriser la maison
  mode: queued
  sequence:
  - action: switch.turn_off
    data: {}
    target:
      entity_id: switch.microphones
  - action: script.eteindre_tous_les_lecteur_multimedia
    metadata: {}
    data: {}
  - if:
    - condition: state
      entity_id: input_boolean.mode_chien
      state: 'off'
    - condition: state
      entity_id: input_boolean.automation_presence_simulator
      state: 'off'
    then:
    - action: light.turn_off
      target:
        entity_id:
        - light.all_lights
      data: {}
    - alias: Close shutters
      if:
      - condition: state
        entity_id: input_boolean.surveillance_de_la_maison_fermer_le_volet_quand_maison_vide
        state: 'on'
      then:
      - action: cover.close_cover
        metadata: {}
        data: {}
        target:
          entity_id:
          - cover.volets_salon
  - alias: Lock door
    if:
    - condition: state
      entity_id: binary_sensor.capteur_ouverture_porte_entree
      state: 'off'
    then:
    - delay:
        hours: 0
        minutes: 0
        seconds: 1
        milliseconds: 0
    - action: lock.lock
      metadata: {}
      data: {}
      target:
        entity_id: lock.serrure_porte_d_entree
    else:
    - action: script.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: script.power_notification_porte_d_entree_ouverte
  icon: mdi:home-export-outline
  fields: {}
  description: ''
welcome_home:
  alias: Bienvenue a la maison
  mode: queued
  sequence:
  - action: light.turn_on
    metadata: {}
    data:
      transition: 2
      brightness_pct: 60
    target:
      entity_id: light.entree_suspension
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
    enabled: true
  - action: light.turn_on
    metadata: {}
    data:
      transition: 2
      brightness_pct: 70
    target:
      entity_id:
      - light.salon_buffet_gauche
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
    enabled: true
  - action: light.turn_on
    metadata: {}
    data:
      transition: 2
      brightness_pct: 70
    target:
      entity_id: light.salon_suspension_tv
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
    enabled: true
  - action: light.turn_on
    metadata: {}
    data:
      transition: 2
      brightness_pct: 70
    target:
      entity_id:
      - light.salon_buffet_droit
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
    enabled: true
  - action: light.turn_on
    target:
      entity_id: light.salon_trepied
    data:
      transition: 2
      brightness_pct: 70
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
    enabled: true
  - action: light.turn_on
    metadata: {}
    data:
      brightness_pct: 40
      transition: 2
    target:
      entity_id:
      - light.hue_aurelle_panel_1
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
    enabled: true
  - action: light.turn_on
    target:
      entity_id:
      - light.cuisine_comptoir
    data:
      transition: 2
      brightness_pct: 40
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
    enabled: true
  - action: light.turn_on
    target:
      entity_id:
      - light.hue_white_candle_2
    data:
      transition: 2
      brightness_pct: 60
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
    enabled: true
  - action: light.turn_on
    data:
      transition: 2
      brightness_pct: 60
    target:
      entity_id: light.hue_white_candle_1
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
    enabled: true
  - action: light.turn_on
    target:
      entity_id:
      - light.cuisine_suspension
    data:
      transition: 2
      brightness_pct: 60
  icon: mdi:home-import-outline
  description: ''
wake_up:
  alias: Réveil Lumineux - Lumières
  sequence:
  - action: light.turn_off
    data: {}
    target:
      area_id: chambre
  - action: light.turn_on
    data:
      transition: 300
      brightness_pct: 100
      color_temp_kelvin: 2074
    target:
      entity_id: light.chambre_bloom
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - action: light.turn_on
    data:
      transition: 300
      brightness_pct: 100
    target:
      entity_id:
      - light.chambre_suspension
      - light.chambre_chevet_droit
      - light.chambre_chevet_gauche
  - delay:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - action: light.turn_on
    data: {}
    target:
      entity_id: light.chambre_guirlande
  mode: single
  icon: mdi:weather-sunset-up
start_marilou_bedtime_routine:
  alias: Démarrer la routine du sommeil de Marilou
  sequence:
  - action: media_player.volume_set
    data:
      volume_level: 0.1
    target:
      entity_id:
      - media_player.vpe_chambre_marilou_music_assistant
  - action: music_assistant.play_media
    data:
      media_id: Au Dodo Marilou
      enqueue: replace
      media_type: playlist
    target:
      entity_id: media_player.vpe_chambre_marilou_music_assistant
  - action: media_player.shuffle_set
    data:
      shuffle: true
    target:
      entity_id:
      - media_player.vpe_chambre_marilou_music_assistant
  - sequence:
    - delay:
        hours: 0
        minutes: 0
        seconds: 10
        milliseconds: 0
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: media_player.vpe_chambre_marilou_music_assistant
          state: playing
      then:
      - action: media_player.media_play
        metadata: {}
        data: {}
        target:
          entity_id: media_player.vpe_chambre_marilou_music_assistant
      - delay:
          hours: 0
          minutes: 0
          seconds: 10
          milliseconds: 0
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: media_player.vpe_chambre_marilou_music_assistant
            state: playing
        then:
        - action: media_player.media_next_track
          metadata: {}
          data: {}
          target:
            entity_id: media_player.vpe_chambre_marilou_music_assistant
    alias: Fallback in case audio does not start
  mode: single
  icon: mdi:bell-sleep
  description: ''
lancer_playlist_de_reveil:
  alias: Réveil Lumineux - Musique
  sequence:
  - action: media_player.volume_set
    data:
      volume_level: 0.2
    target:
      entity_id:
      - media_player.vpe_chambre_music_assistant
  - action: media_player.shuffle_set
    data:
      shuffle: true
    target:
      entity_id:
      - media_player.vpe_chambre_music_assistant
  - action: music_assistant.play_media
    target:
      entity_id:
      - media_player.vpe_chambre_music_assistant
    data:
      media_id: Chillhop Master Playlist
      enqueue: replace
      media_type: playlist
  - sequence:
    - delay:
        hours: 0
        minutes: 0
        seconds: 10
        milliseconds: 0
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: media_player.vpe_chambre_music_assistant
          state: playing
      then:
      - action: media_player.media_play
        metadata: {}
        data: {}
        target:
          entity_id: media_player.vpe_chambre_music_assistant
      - delay:
          hours: 0
          minutes: 0
          seconds: 10
          milliseconds: 0
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: media_player.vpe_chambre_music_assistant
            state: playing
        then:
        - action: media_player.media_next_track
          metadata: {}
          data: {}
          target:
            entity_id: media_player.vpe_chambre_music_assistant
    alias: Fallback in case audio does not start
  mode: single
  icon: mdi:alarm
controler_le_standing_desk:
  alias: Controler le Standing desk
  sequence:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{target_position == ''standing''}}'
      sequence:
      - repeat:
          sequence:
          - action: button.press
            target:
              entity_id:
              - button.standing_desk_move_desk_to_position_1
            data: {}
          - wait_for_trigger:
            - entity_id:
              - binary_sensor.standing_desk_moving
              to: 'on'
              trigger: state
            timeout:
              hours: 0
              minutes: 0
              seconds: 3
              milliseconds: 0
          - wait_for_trigger:
            - entity_id:
              - binary_sensor.standing_desk_moving
              to: 'off'
              trigger: state
            timeout:
              hours: 0
              minutes: 0
              seconds: 20
              milliseconds: 0
          - if:
            - condition: template
              value_template: '{{ repeat.index >= 5 }}'
            then:
            - stop: ''
          while:
          - condition: not
            conditions:
            - condition: state
              entity_id: sensor.standing_desk_state
              state: standing_position
    - conditions:
      - condition: template
        value_template: '{{target_position == ''sitting''}}'
      sequence:
      - repeat:
          sequence:
          - action: button.press
            target:
              entity_id: button.standing_desk_move_desk_to_position_2
            data: {}
          - wait_for_trigger:
            - entity_id:
              - binary_sensor.standing_desk_moving
              to: 'on'
              trigger: state
            timeout:
              hours: 0
              minutes: 0
              seconds: 3
              milliseconds: 0
          - wait_for_trigger:
            - entity_id:
              - binary_sensor.standing_desk_moving
              to: 'off'
              trigger: state
            timeout:
              hours: 0
              minutes: 0
              seconds: 20
              milliseconds: 0
          - if:
            - condition: template
              value_template: '{{ repeat.index >= 5 }}'
            then:
            - stop: ''
          while:
          - condition: not
            conditions:
            - condition: state
              entity_id: sensor.standing_desk_state
              state: seated_position
  fields:
    target_position:
      selector:
        select:
          options:
          - label: Position debout
            value: standing
          - label: Position assise
            value: sitting
          multiple: false
      name: Position cible
      description: Position cible du standing desk (Assise ou Debout)
      required: true
  description: Contrôler les standing desk dans le bureau en donnant une position
    cible. (Assise ou Debout)
  icon: mdi:desk
eteindre_tous_les_lecteur_multimedia:
  alias: Éteindre tous les lecteurs multimédia
  sequence:
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id: media_player.tous_les_lecteurs_multimedia_ne_supportant_pas_on_off
  - action: media_player.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - media_player.tous_les_lecteurs_multimedia_supportant_on_off
  - action: media_player.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - media_player.apple_tv_salon
  description: ''
  icon: mdi:television-speaker-off
test_2:
  alias: Crazy Wake Up
  sequence:
  - action: media_player.volume_set
    target:
      entity_id: media_player.vpe_chambre_media_player
    data:
      volume_level: 0.8
  - action: media_player.play_media
    target:
      entity_id: media_player.vpe_chambre_media_player
    data:
      media_content_id: media-source://media_source/local/wake_up.mp3
      media_content_type: audio/mpeg
    metadata:
      title: wake_up.mp3
      thumbnail:
      media_class: music
      children_media_class:
      navigateIds:
      - {}
      - media_content_type: app
        media_content_id: media-source://media_source
  - wait_for_trigger:
    - entity_id:
      - media_player.vpe_chambre_media_player
      to: playing
      trigger: state
  - action: light.turn_on
    metadata: {}
    data:
      transition: 14
    target:
      area_id: chambre
  - delay:
      hours: 0
      minutes: 0
      seconds: 12
      milliseconds: 0
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: chambre
  - delay:
      hours: 0
      minutes: 0
      seconds: 2
      milliseconds: 0
  - repeat:
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          flash: short
        target:
          entity_id: light.chambre
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      while:
      - condition: state
        entity_id: media_player.vpe_chambre_media_player
        state: playing
  description: ''
transfer_music_music_assistant:
  alias: Transférer Musique (Music Assistant)
  sequence:
  - action: music_assistant.transfer_queue
    metadata: {}
    target: '{{target}}'
    data:
      source_player: '{{source}}'
      auto_play: true
  fields:
    target:
      selector:
        target: {}
      name: Target location of the music stream (After Transfer)
      required: true
    source:
      selector:
        entity:
          domain: media_player
          integration: music_assistant
      name: Source location of the music stream (Currently playing)
  description: ''
  icon: mdi:account-music
preparer_depart_maison:
  alias: Préparer départ maison
  sequence:
  - alias: Notify windows open
    if:
    - condition: state
      entity_id: binary_sensor.all_windows
      state: 'on'
    then:
    - variables:
        open_windows: "{{ \n  expand(states.binary_sensor.all_windows.attributes.entity_id)\n
          \   | selectattr('state', 'eq', 'on')\n    | map(attribute='entity_id')
          \n    | list\n}}"
    - action: script.turn_on
      metadata: {}
      data:
        variables:
          user_message: '{%- from ''unique_area_names.jinja'' import unique_area_names
            -%}

            Des fenêtres sont toujours ouvertes alors que vous allez partir ({{unique_area_names(open_windows)}})

            '
      target:
        entity_id: script.power_notification_fenetres_ouvertes
  - alias: Notify oven running
    if:
    - condition: state
      entity_id: binary_sensor.is_oven_running
      state: 'on'
    then:
    - action: script.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: script.power_notification_four_allume
  - alias: Notify cooktop running
    if:
    - condition: state
      entity_id: binary_sensor.is_induction_cooktop_running
      state: 'on'
    then:
    - action: script.turn_on
      metadata: {}
      data: {}
      target:
        entity_id:
        - script.power_notification_plaques_a_induction_allumees
  - alias: Notify french door open
    if:
    - condition: state
      entity_id: binary_sensor.capteur_ouverture_porte_fenetre_salon
      state: 'on'
    then:
    - action: script.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: script.power_notification_porte_fenetre_du_salon_ouverte
  mode: queued
  icon: mdi:home-export-outline
  fields: {}
  description: ''
power_notification_litiere_pleine:
  alias: Power Notification - Litière pleine
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001F408  Litière"
      default_message: Pensez à nettoyer la litière !
      button_title: C'est fait!
      discard_when:
      - trigger: state
        entity_id:
        - binary_sensor.is_litter_full
        to: 'off'
      button_action:
      - action: counter.reset
        metadata: {}
        data: {}
        target:
          entity_id: counter.passages_litiere
      replace_older_notification: true
  description: ''
  icon: mdi:bell
power_notification_poubelle_noire_non_sortie_a_temps:
  alias: Power Notification - Poubelle Noire non sortie a temps
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001F5D1️ Poubelle Noire"
      default_message: Vous devez sortir la poubelle noire!
  description: ''
power_notification_poubelle_verte_non_sortie_a_temps:
  alias: 'Power Notification - Poubelle Verte non sortie a temps '
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: ♻️ Poubelle Noire
      default_message: Vous devez sortir la poubelle verte!
  description: ''
  icon: mdi:bell
power_notification_poubelle_noire_a_sortir:
  alias: Power Notification - Poubelle Noire à sortir
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001F5D1️ Poubelle Noire"
      default_message: N'oubliez pas de sortir la poubelle noire
      button_title: C'est fait!
      button_action:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.poubelle_noire_a_sortir
      discard_when:
      - trigger: state
        entity_id:
        - input_boolean.poubelle_noire_a_sortir
        to: 'off'
      button: true
      replace_older_notification: true
  description: ''
  icon: mdi:bell
power_notification_poubelle_verte_a_sortir:
  alias: Power Notification - Poubelle Verte à sortir
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: ♻️ Poubelle Verte
      default_message: N'oubliez pas de sortir la poubelle verte
      button_title: C'est fait!
      button_action:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - input_boolean.poubelle_verte_a_sortir
      discard_when:
      - trigger: state
        entity_id:
        - input_boolean.poubelle_verte_a_sortir
        to: 'off'
      button: true
      replace_older_notification: true
  description: ''
  icon: mdi:bell
power_notification_pluie_et_portes_ouvertes:
  alias: Power Notification - Pluie et portes ouvertes
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001F302 In pleut!"
      default_message: Certaines portes sont ouvertes et il commence a pleuvoir
      discard_when:
      - trigger: state
        entity_id:
        - binary_sensor.all_doors
        to: 'off'
      - trigger: state
        entity_id:
        - sensor.wittboy_rain_rate_piezo
        to: '0.0'
      replace_older_notification: true
  description: ''
  icon: mdi:water
power_notification_pluie_et_fenetres_ouvertes:
  alias: Power Notification - Pluie et fenêtres ouvertes
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001F302 In pleut!"
      default_message: Certaines fenêtres sont ouvertes et il commence a pleuvoir
      discard_when:
      - trigger: state
        entity_id:
        - binary_sensor.all_windows
        to: 'off'
      - trigger: state
        entity_id:
        - sensor.wittboy_rain_rate_piezo
        to: '0.0'
      replace_older_notification: true
  description: ''
  icon: mdi:water
power_notification_mise_a_jour_dispo:
  alias: Power Notification - Mise a jour dispo
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      persons:
      - person.jenova70
      default_title: "\U0001F4E6 Mise a jour disponible"
      default_message: Des mises à jours sont disponibles
      discard_when:
      - trigger: state
        entity_id:
        - sensor.pending_updates
        to: '0'
      target: send_to_all
      notification_data_advanced:
        url: /config/dashboard
      replace_older_notification: true
  description: ''
  icon: mdi:cellphone-arrow-down
power_notification_batteries_faibles:
  alias: Power Notification - Batteries Faibles
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      persons:
      - person.jenova70
      default_title: "\U0001FAAB Batteries faibles !"
      default_message: Certaines battery sont faibles
      target: send_to_all
      notification_data_advanced:
        url: /lovelace-system/batteries
      replace_older_notification: true
  description: ''
  icon: mdi:battery-10
power_notification_servaar:
  alias: Power Notification - Servaar
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_all
      persons:
      - person.jenova70
      default_title: "\U0001F4FA Servaar"
      default_message: Film ou épisode téléchargé
  description: ''
  icon: mdi:movie
power_notification_simulation_de_presence_et_eloignement_du_domicile:
  alias: Power Notification - Simulation de presence et éloignement du domicile
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_nearest
      default_title: "\U0001F6F8 Vous êtes loin"
      default_message: Vous vous trouvez loin du domicile, activer la simulation de
        présence?
      button_title: D'accord!
      button_action:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.automation_presence_simulator
      discard_when:
      - trigger: state
        entity_id:
        - binary_sensor.far_away
        to: 'off'
      - trigger: state
        entity_id:
        - input_boolean.automation_presence_simulator
        to: 'on'
      thing: zone.home
      replace_older_notification: true
  description: ''
  icon: mdi:controller-classic
power_notification_pont_chaban_delmas:
  alias: Power Notification - Pont Chaban Delmas
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_all
      persons:
      - person.jenova70
      default_title: "\U0001F309  Pont Chaban Delmas"
      default_message: Le pont Chaban Delmas fermera demain
  description: ''
  icon: mdi:bridge
power_notification_rappel_charge_tesla:
  alias: Power Notification - Rappel charge Tesla
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      persons:
      - person.jenova70
      default_title: "\U0001F3CE️ Tesla"
      default_message: Pensez à charger la voiture.
      discard_when:
      - trigger: state
        entity_id:
        - binary_sensor.meme_cable_de_charge
        to: 'on'
      target: send_to_all
      replace_older_notification: true
  description: ''
  icon: phu:tesla-icon
power_notification_desactiver_mode_invite_lors_de_l_arrivee:
  alias: Power Notification - Désactiver Mode Invité lors de l'arrivée
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      persons: []
      zones:
      - zone.home
      default_title: ✨ Monde Invité
      default_message: Bienvenue à la maison, désactiver le mode invité?
      button_title: Ok!
      button_action:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.guest_mode
      discard_when:
      - trigger: state
        entity_id:
        - input_boolean.guest_mode
        to: 'off'
      replace_older_notification: true
  description: ''
  icon: mdi:creation
power_notification_porte_d_entree_restee_ouverte:
  alias: Power Notification - Porte d'entrée restée ouverte
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001F6AA Porte d'entrée"
      default_message: La porte d'entrée est restée ouverte!
      discard_when:
      - trigger: state
        entity_id:
        - binary_sensor.capteur_ouverture_porte_entree
        to: 'off'
      default_importance: true
      replace_older_notification: true
  description: ''
  icon: mdi:door-open
power_notification_courrier_a_relever:
  alias: Power Notification - Courrier à relever
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001F4EB Boite aux lettres"
      default_message: Vous avez du courrier !
      button_title: Courrier relevé!
      button_action:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.courrier_a_relever
      discard_when:
      - trigger: state
        entity_id:
        - input_boolean.courrier_a_relever
        to: 'off'
      replace_older_notification: true
  description: ''
  icon: mdi:mailbox-up
power_notification_machine_a_laver_terminee:
  alias: Power Notification - Machine à laver terminée
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001FAE7 Machine à laver"
      default_message: Cycle de lavage terminé !
      button_title: Machine vidée!
      button_action:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Inactive
        target:
          entity_id: input_select.etat_machine_a_laver
      discard_when:
      - trigger: state
        entity_id:
        - input_select.etat_machine_a_laver
        from: À vider
      replace_older_notification: true
  description: ''
  icon: mdi:washing-machine-alert
power_notification_fenetres_ouvertes:
  alias: Power Notification - Fenêtres ouvertes
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.proche_de_la_maison
      default_title: "\U0001FA9F Fenêtres ouvertes !"
      default_message: Les fenêtres suivantes sont toujours ouvertes alors que vous
        allez partir!
      discard_when:
      - trigger: state
        entity_id:
        - binary_sensor.all_windows
        to: 'off'
      - trigger: state
        entity_id:
        - input_select.modes_de_presence_de_la_maison_v2
        to: Occupée
      replace_older_notification: true
  description: ''
  icon: mdi:window-open
power_notification_four_allume:
  alias: Power Notification - Four allumé
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.proche_de_la_maison
      default_title: "\U0001F958 Four allumé"
      default_message: Le four est en marche alors que vous allez partir!
      discard_when:
      - trigger: state
        entity_id:
        - binary_sensor.is_oven_running
        to: 'off'
      - trigger: state
        entity_id:
        - input_select.modes_de_presence_de_la_maison_v2
        to: Occupée
      default_importance: true
      replace_older_notification: true
  description: ''
  icon: mdi:stove
power_notification_plaques_a_induction_allumees:
  alias: Power Notification - Plaques à induction allumées
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.proche_de_la_maison
      default_title: "\U0001F373 Plaques à induction allumées"
      default_message: Les plaques à induction sont en marche alors que vous allez
        partir!
      discard_when:
      - trigger: state
        entity_id:
        - binary_sensor.is_induction_cooktop_running
        to: 'off'
      - trigger: state
        entity_id:
        - input_select.modes_de_presence_de_la_maison_v2
        to: Occupée
      default_importance: true
      replace_older_notification: true
  description: ''
  icon: mdi:gas-burner
power_notification_porte_fenetre_du_salon_ouverte:
  alias: Power Notification - Porte fenêtre du salon ouverte
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.proche_de_la_maison
      default_title: "\U0001F6AAPorte fenêtre du salon"
      default_message: La porte fenêtre du salon est toujours ouverte alors que vous
        allez partir!
      discard_when:
      - trigger: state
        entity_id:
        - binary_sensor.capteur_ouverture_porte_fenetre_salon
        to: 'off'
      - trigger: state
        entity_id:
        - input_select.modes_de_presence_de_la_maison_v2
        to: Occupée
      default_importance: false
      replace_older_notification: true
  description: ''
  icon: mdi:door-open
power_notification_porte_d_entree_ouverte:
  alias: Power Notification - Porte d'entrée ouverte lors du départ
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.proche_de_la_maison
      default_title: "\U0001F6AAPorte d'entrée"
      default_message: La porte d'entrée est toujours ouverte alors que vous allez
        partir!
      discard_when:
      - trigger: state
        entity_id:
        - binary_sensor.capteur_ouverture_porte_entree
        to: 'off'
      - trigger: state
        entity_id:
        - input_select.modes_de_presence_de_la_maison_v2
        to: Occupée
      default_importance: true
      replace_older_notification: true
  description: ''
  icon: mdi:door-open
power_notification_temperature_anormale_dans_le_bureau:
  alias: Power Notification - Température anormale dans le bureau
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001F321️ Température anormale"
      default_message: Température anormale dans le bureau
      replace_older_notification: true
  description: ''
  icon: mdi:home-thermometer
power_notification_temperature_anormale_dans_le_salon:
  alias: Power Notification - Température anormale dans le salon
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001F321️ Température anormale"
      default_message: Température anormale dans le salon
      replace_older_notification: true
  description: ''
  icon: mdi:home-thermometer
power_notification_temperature_anormale_dans_la_chambre:
  alias: Power Notification - Température anormale dans la chambre
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001F321️ Température anormale"
      default_message: Température anormale dans la chambre
      replace_older_notification: true
  description: ''
  icon: mdi:home-thermometer
power_notification_temperature_anormale_dans_la_chambre_de_marilou:
  alias: Power Notification - Température anormale dans la chambre de Marilou
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001F321️ Température anormale"
      default_message: Température anormale dans la chambre de Marilou
      replace_older_notification: true
  description: ''
  icon: mdi:home-thermometer
quitter_la_maison:
  alias: Départ en cours
  sequence:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Départ en cours
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
    enabled: true
  description: Passer la maison en mode "Départ en cours". A utiliser lorsque je suis
    sur le point de quitter mon domicile.
  icon: mdi:home-export-outline
  fields: {}
recuperer_previsions_meteorologiques:
  alias: Récupérer prévisions météorologiques
  sequence:
  - action: weather.get_forecasts
    target:
      entity_id:
      - weather.floirac
    data:
      type: '{{frequency}}'
    response_variable: result
  - stop: ''
    response_variable: result
  description: Récupérer les prévisions météorologiques a mon domicile
  icon: mdi:weather-cloudy
  fields:
    frequency:
      selector:
        select:
          options:
          - value: daily
            label: Journalière
          - value: hourly
            label: Horaire
      name: Fréquence
      required: true
      description: Fréquence des prévisions. Une par heure ou une par jour.
recuperer_liste_de_course:
  alias: Récupérer liste de course
  sequence:
  - action: todo.get_items
    target:
      entity_id:
      - todo.listes_des_courses
    response_variable: result
    data:
      status: needs_action
  - stop: ''
    response_variable: result
  description: A utiliser lorsqu'un utilisateur veux connaitre la liste de course
  icon: mdi:basket
jouer_de_la_musique_music_assistant:
  sequence:
  - action: conversation.process
    data:
      agent_id: conversation.music_assistant_search_bot
      text: '{{query}}'
    response_variable: response_from_ai
  - variables:
      media_data: '{{response_from_ai.response.speech.plain.speech|from_json}}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{media_data.media_type in ["artist","album"]}}'
      sequence:
      - variables:
          decorate_data:
            enqueue: replace
      - action: music_assistant.play_media
        data: '{{ dict(media_data, **decorate_data) }}'
        target:
          area_id: '{{area}}'
      - variables:
          decorate_data:
            enqueue: add
            radio_mode: true
      - action: music_assistant.play_media
        data: '{{ dict(media_data, **decorate_data) }}'
        target:
          area_id: '{{area}}'
    - conditions:
      - condition: template
        value_template: '{{media_data.media_type in ["track"]}}'
      sequence:
      - variables:
          decorate_data:
            enqueue: replace
            radio_mode: true
      - action: music_assistant.play_media
        data: '{{ dict(media_data, **decorate_data) }}'
        target:
          area_id: '{{area}}'
  - stop: ''
    response_variable: media_data
  fields:
    query:
      selector:
        text:
      name: Requête
      description: Requête a jouer (Un artiste, un album, une chanson, quelque chose
        de plus complexe)
      required: true
    area:
      selector:
        area:
          entity:
            integration: music_assistant
          multiple: false
      name: Piece
      description: Pièce dans laquelle jouer la requete
      required: true
  alias: Jouer de la musique (Music Assistant)
  description: Jouer n'importe quoi dans n'importe quelle piece de la maison
  icon: mdi:music
create_date_time_reminder:
  sequence:
  - action: calendar.create_event
    metadata: {}
    data:
      summary: '{{reminder}}'
      start_date_time: '{{as_datetime(date)}}'
      end_date_time: '{{as_datetime(date) + timedelta(minutes=5)}}'
    target:
      entity_id: calendar.rappels
  fields:
    reminder:
      selector:
        text:
      name: reminder
      description: Reminder, String, Mandatory, Example "Take out the trash"
      required: true
    date:
      selector:
        datetime: {}
      name: date
      description: Reminder Date, date, mandatory. Guess time for fuzzy request such
        as "Evening" or "Morning". Default to 8am for requests with no clear time.
      required: true
  alias: Create Date Time Reminder
  description: Create a date time reminder.
  icon: mdi:reminder
create_location_based_reminder:
  sequence:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ reminder_trigger == ''empty''}}'
      sequence:
      - action: todo.add_item
        metadata: {}
        data:
          item: '{{reminder}}'
        target:
          entity_id: todo.rappels_maison_vide
    - conditions:
      - condition: template
        value_template: '{{ reminder_trigger == ''occupied''}}'
      sequence:
      - action: todo.add_item
        metadata: {}
        data:
          item: '{{reminder}}'
        target:
          entity_id: todo.rappels_maison_occupee
  fields:
    reminder:
      selector:
        text:
      name: reminder
      description: Reminder, String, Mandatory, Example "Take out the trash"
      required: true
    reminder_trigger:
      selector:
        select:
          options:
          - value: empty
            label: When the house becomes empty
          - value: occupied
            label: When the house becomes occupied
      name: Reminder Trigger
      description: Trigger of the reminder, either when the house becomes empty or
        when it becomes occupied, mandatory
      required: true
  alias: 'Create Location Based Reminder '
  description: Create a location based reminder (When I leave or arrive home)
  icon: mdi:reminder
power_notification_rappel:
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      persons: []
      default_title: "\U0001F514 Rappel"
      default_message: Vous avez un rappel
      notification_data_advanced:
        url: /lovelace-system/reminders
      target: send_to_all
  alias: Power Notification - Rappel Calendrier
  description: ''
  icon: mdi:calendar
power_notification_rappel_maison_occupee:
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      persons: []
      default_title: "\U0001F514 Rappel"
      default_message: Vous avez un rappel
      notification_data_advanced:
        url: /lovelace-system/reminders
      target: send_to_persons_in_zones
      zones:
      - zone.proche_de_la_maison
  alias: Power Notification - Rappel Maison Occupée
  description: ''
  icon: mdi:home-import-outline
power_notification_rappel_maison_vide:
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      persons: []
      default_title: "\U0001F514 Rappel"
      default_message: Vous avez un rappel
      notification_data_advanced:
        url: /lovelace-system/reminders
      target: send_to_persons_in_zones
      zones:
      - zone.proche_de_la_maison
  alias: Power Notification - Rappel Maison Vide
  description: ''
  icon: mdi:home-export-outline
activer_le_mode_sommeil_de_marilou:
  sequence:
  - action: input_boolean.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.mode_sommeil_marilou
  alias: 'Activer le mode sommeil de Marilou '
  description: 'Active le mode sommeil de ma fille Marilou lorsque je la couche. '
  icon: mdi:sleep
power_notification_porte_d_entree_ouverte_lors_du_coucher:
  alias: Power Notification - Porte d'entrée ouverte lors du coucher
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001F6AAPorte d'entrée"
      default_message: La porte d'entrée est toujours ouverte alors que vous vous
        coucher!
      discard_when:
      - trigger: state
        entity_id:
        - binary_sensor.capteur_ouverture_porte_entree
        to: 'off'
      default_importance: true
      replace_older_notification: true
  description: ''
  icon: mdi:door-open
power_notification_serrure_verouillee_sur_porte_ouverte:
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.proche_de_la_maison
      default_title: "\U0001F512 Serrure"
      default_message: 'La serrure est verrouillée alors que la porte est toujours
        ouverte ! '
      default_importance: true
      discard_when:
      - trigger: state
        entity_id:
        - lock.serrure_porte_d_entree
        to: unlocked
      - trigger: state
        entity_id:
        - binary_sensor.capteur_ouverture_porte_entree
        to: 'off'
      replace_older_notification: true
  alias: Power notification - Serrure vérouillée sur porte ouverte
  description: ''
power_notification_serrure_deverrouillee:
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      persons:
      - person.jenova70
      target: send_to_all
      zones: []
      default_title: "\U0001F513 Serrure"
      default_message: 'La serrure vient d''être déverrouillée '
      default_importance: true
  alias: Power notification - Serrure deverrouillée
  description: ''
power_notification_lancement_machine_a_laver_prevu:
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_in_zones
      zones:
      - zone.home
      default_title: "\U0001FAE7 Machine à laver"
      default_message: La machine à laver démarrera automatiquement cette nuit
      discard_when:
      - trigger: state
        entity_id:
        - input_select.etat_machine_a_laver
        from: Plannifiée
      replace_older_notification: true
  alias: Power Notification - Lancement machine à laver prévu
  description: ''
start_escape_game:
  sequence:
  - variables:
      input_voice_assistant: '{% set input_area_entities = area_entities(area) %}
        {% set voice_assistant_pipelines = label_entities("Choix d''assistant") %}
        {% set input_voice_assistant = intersect(input_area_entities,voice_assistant_pipelines)
        %} {{input_voice_assistant}}

        '
  - action: select.select_option
    metadata: {}
    data:
      option: Escape Game Master
    target:
      entity_id: '{{input_voice_assistant}}'
  - action: assist_satellite.announce
    metadata: {}
    data:
      preannounce: false
      message: Creation of the story in progress. Please wait.
    target:
      area_id: '{{area}}'
  - action: conversation.process
    metadata: {}
    data:
      text: Generate new story
      agent_id: conversation.chatgpt_4
    response_variable: response_from_ai
  - variables:
      story: '{{response_from_ai.response.speech.plain.speech|from_json}}'
      description: '{{story.description}}'
  - action: assist_satellite.start_conversation
    metadata: {}
    data:
      preannounce: true
      extra_system_prompt: 'BEGINING STORY:


        {{story}}


        END STORY

        '
      start_message: '{{description}}

        What do you want to do first?

        '
    target:
      area_id: '{{area}}'
  alias: Start Escape Game
  description: ''
  fields:
    area:
      selector:
        area:
          entity:
            domain: assist_satellite
      name: Area
      description: Area in which the escape room audio game will start
      required: true
power_notification_montre_oubliee:
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      persons:
      - person.jenova70
      default_title: ⌚ Montre oubliée?
      default_message: La montre est toujours à la maison alors que le telephone ne
        l'ai plus!
      button_title: Détacher ma montre
      button_action:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.montre_portee
      replace_older_notification: true
  alias: Power Notification - Montre oubliée
  description: ''
power_notification_telephone_oublie:
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      persons:
      - person.jenova70
      default_title: ⌚ Téléphone oublié?
      default_message: Le téléphone est toujours à la maison alors que la montre ne
        l'ai plus!
      button_title: Détacher mon téléphone
      button_action:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - input_boolean.telephone_porte
      replace_older_notification: true
  alias: Power Notification - Téléphone oublié
  description: ''
power_notification_appareil_reattache_automatiquement:
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      persons:
      - person.jenova70
      default_title: 'Appareil personnel '
      default_message: Appareil réattaché automatiquement
      replace_older_notification: true
  alias: Power Notification - Appareil réattaché automatiquement
  description: ''
power_notification_serrure_verrouillee:
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      persons:
      - person.jenova70
      target: send_to_all
      zones: []
      default_title: "\U0001F513 Serrure"
      default_message: La serrure vient d'être verrouillée
      default_importance: false
  alias: Power notification - Serrure verrouillée
  description: ''
power_notification_fuite_d_eau:
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      default_title: "\U0001F4A7 Fuite d'eau"
      default_message: Fuite d'eau détectée!
      default_importance: true
      notification_data_advanced:
        url: /lovelace/fuites
  alias: Power Notification - Fuite d'eau
  description: ''
power_notification_sonnette_video:
  use_blueprint:
    path: jlo/power_notification_creator.yaml
    input:
      target: send_to_persons_not_in_zones
      zones:
      - zone.home
      default_title: "\U0001F3A5 Sonnette "
      notification_data_advanced:
        entity_id: camera.sonnette_fluide
        url: /lovelace/cameras
      default_message: La sonnette a détectée quelque chose
  alias: Power notification - Sonnette vidéo
  description: ''
