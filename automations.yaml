- id: '1688111538910'
  alias: Litière Intelligente - Incrementer passages litière
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_mouvement_litiere
    to: 'on'
    from: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_clean_cat_litter_box
    state: 'on'
  actions:
  - action: counter.increment
    metadata: {}
    data: {}
    target:
      entity_id: counter.passages_litiere
  mode: single
- id: '1688112377959'
  alias: "Litière Intelligente - \U0001F514 Notifier litière pleine"
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.is_litter_full
    trigger: state
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  conditions:
  - condition: state
    entity_id: input_boolean.automation_clean_cat_litter_box
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: state
    entity_id: binary_sensor.is_litter_full
    state: 'on'
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_litiere_pleine
  mode: single
- id: '1688114260897'
  alias: Poubelles Intelligentes - Poubelle noire à sortir
  description: ''
  triggers:
  - entity_id:
    - schedule.planning_poubelle_noire
    to: 'on'
    from: 'off'
    trigger: state
  conditions: []
  actions:
  - action: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.poubelle_noire_a_sortir
  mode: single
- id: '1688114327500'
  alias: Poubelles Intelligentes - Poubelle verte à sortir
  description: ''
  triggers:
  - entity_id:
    - schedule.planning_poubelle_verte
    to: 'on'
    from: 'off'
    trigger: state
  conditions: []
  actions:
  - action: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.poubelle_verte_a_sortir
  mode: single
- id: '1688114732811'
  alias: "Poubelles Intelligentes - \U0001F514 Poubelle noire non sortie à temps"
  description: ''
  triggers:
  - entity_id:
    - schedule.planning_poubelle_noire
    to: 'off'
    from: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_take_out_trash
    state: 'on'
  - condition: state
    entity_id: input_boolean.poubelle_noire_a_sortir
    state: 'on'
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_poubelle_noire_non_sortie_a_temps
  - action: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.poubelle_noire_a_sortir
  mode: single
- id: '1688114808231'
  alias: "Poubelles Intelligentes - \U0001F514 Poubelle verte non sortie à temps"
  description: ''
  triggers:
  - entity_id:
    - schedule.planning_poubelle_verte
    to: 'off'
    from: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_take_out_trash
    state: 'on'
  - condition: state
    entity_id: input_boolean.poubelle_verte_a_sortir
    state: 'on'
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_poubelle_verte_non_sortie_a_temps
  - action: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.poubelle_verte_a_sortir
  mode: single
- id: '1688116237944'
  alias: Boîte aux Lettres Intelligente - Courrier à relever
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_mouvement_boite_aux_lettres
    to: 'on'
    from: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.is_front_door_recently_open
    state: 'off'
  actions:
  - action: input_boolean.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.courrier_a_relever
  mode: single
- id: '1688116301973'
  alias: Boîte aux Lettres Intelligente - Courrier relevé
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_mouvement_boite_aux_lettres
    to: 'on'
    from: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.is_front_door_recently_open
    state: 'on'
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.courrier_a_relever
  mode: single
- id: '1688139412657'
  alias: Réveil intelligent - Régler heures de déclenchement
  description: ''
  triggers:
  - entity_id:
    - input_datetime.wake_up_time
    trigger: state
  conditions: []
  actions:
  - action: input_datetime.set_datetime
    data:
      datetime: '{{today_at(states(''input_datetime.wake_up_time'')) - timedelta(minutes
        = 5)}}'
    target:
      entity_id: input_datetime.wake_up_time_lights
  mode: single
- id: '1688139621896'
  alias: Réveil intelligent - Allumer Lumières
  description: ''
  triggers:
  - at: input_datetime.wake_up_time_lights
    trigger: time
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: state
        entity_id: input_select.reveil_intelligent
        state: Automatique
      - condition: state
        entity_id: binary_sensor.jour_de_travail_aujourdhui
        state: 'on'
    - condition: state
      entity_id: input_select.reveil_intelligent
      state: Activé
  actions:
  - action: script.wake_up
    data: {}
  mode: single
- id: '1688368387161'
  alias: Bureau - Meetings
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.jean_loics_macbook_pro_camera_in_use
    to: 'on'
    from: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 5
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_meetings
    state: 'on'
  - condition: state
    entity_id: person.jenova70
    state: home
  - condition: state
    state: 'on'
    entity_id: binary_sensor.capteur_presence_bureau_occupancy
  - condition: state
    entity_id: binary_sensor.jean_loics_macbook_pro_active
    state: 'on'
  - condition: state
    entity_id: device_tracker.jean_loics_macbook_pro
    state: home
  actions:
  - data:
      scene_id: dynamic_scene_before_meeting
      snapshot_entities:
      - light.bureau_suspension
    action: scene.create
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - data:
      brightness_pct: 100
      color_temp_kelvin: 3521
    target:
      entity_id:
      - light.bureau_suspension
    action: light.turn_on
  - data:
      brightness_pct: 60
      color_temp_kelvin: 3521
    target:
      entity_id:
      - light.hue_play_bars
    action: light.turn_on
  - data: {}
    target:
      entity_id: switch.vpe_bureau_microphone
    action: switch.turn_off
  - if:
    - condition: state
      entity_id: binary_sensor.jean_loics_macbook_pro_camera_in_use
      state: 'on'
    then:
    - wait_for_trigger:
      - entity_id:
        - binary_sensor.jean_loics_macbook_pro_camera_in_use
        to: 'off'
        from: 'on'
        trigger: state
      continue_on_timeout: false
  - data: {}
    target:
      entity_id: light.hue_play_bars
    action: light.turn_off
  - data: {}
    target:
      entity_id: scene.dynamic_scene_before_meeting
    action: scene.turn_on
  - data: {}
    target:
      entity_id: switch.vpe_bureau_microphone
    action: switch.turn_on
  - action: scene.delete
    metadata: {}
    data: {}
    target:
      entity_id: scene.dynamic_scene_before_meeting
  mode: restart
- id: '1688371620889'
  alias: Surveillance de la maison - Éteindre appareils lors du départ
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  conditions:
  - condition: state
    entity_id: input_boolean.depart_intelligent
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - action: script.leave_home
    data: {}
  mode: queued
  max: 10
- id: '1688373819985'
  alias: Surveillance de la maison - Allumer appareils lors de l'arrivée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Occupée
    from: Arrivée en cours
  conditions:
  - condition: state
    entity_id: input_boolean.arrivee_intelligente
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - action: cover.open_cover
    data: {}
    target:
      entity_id: cover.volets_salon
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: exterieur
      floor_id:
      - premier_etage
      - rez_de_chaussee
  - if:
    - condition: state
      entity_id: binary_sensor.exterieur_lumineux
      state: 'off'
    then:
    - action: script.turn_on
      data: {}
      target:
        entity_id: script.welcome_home
  mode: queued
  max: 10
- id: '1688375110167'
  alias: "Surveillance de la maison - \U0001F514 Notifier pluie et portes/fenêtres
    ouvertes "
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.wittboy_rain_rate_piezo
    above: 0
  conditions:
  - condition: state
    entity_id: input_boolean.recevoir_notification_fenetre_ouverte_et_pluie
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: state
    entity_id: binary_sensor.all_openings
    state: 'on'
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.all_doors
      state: 'on'
    then:
    - variables:
        open_doors: "{{ \n  expand(states.binary_sensor.all_doors.attributes.entity_id)\n
          \   | selectattr('state', 'eq', 'on')\n    | map(attribute='entity_id')\n
          \   | list\n}}"
    - action: script.turn_on
      data:
        variables:
          user_message: '{%- from ''unique_area_names.jinja'' import unique_area_names
            -%} Il commence a pleuvoir et des portes sont ouvertes ({{unique_area_names(open_doors)}})

            '
      target:
        entity_id: script.power_notification_pluie_et_portes_ouvertes
  - if:
    - condition: state
      entity_id: binary_sensor.all_windows
      state: 'on'
    then:
    - variables:
        open_windows: "{{ \n  expand(states.binary_sensor.all_windows.attributes.entity_id)\n
          \   | selectattr('state', 'eq', 'on')\n    | map(attribute='entity_id')\n
          \   | list\n}}"
    - action: script.turn_on
      data:
        variables:
          user_message: '{%- from ''unique_area_names.jinja'' import unique_area_names
            -%} Il commence a pleuvoir et des fenêtres sont ouvertes ({{unique_area_names(open_windows)}})

            '
      target:
        entity_id: script.power_notification_pluie_et_fenetres_ouvertes
  mode: single
- id: '1688386134462'
  alias: "Surveillance du système - \U0001F514 Notifier mise a jour dispo"
  description: ''
  triggers:
  - entity_id:
    - sensor.pending_updates
    attribute: entities
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_monitor_system
    state: 'on'
  - condition: template
    value_template: '{{trigger.to_state.state | int(0) > 0}}'
  actions:
  - action: script.turn_on
    metadata: {}
    data:
      variables:
        user_message: '{%- from ''device_names_clean.jinja'' import device_names_clean
          -%}

          {{device_names_clean(trigger.to_state.attributes.entities)}}

          '
    target:
      entity_id: script.power_notification_mise_a_jour_dispo
  mode: queued
  max: 10
- id: '1688390987276'
  alias: "Surveillance du système - \U0001F514 Notifier batteries faibles"
  description: ''
  triggers:
  - at: '21:00:00'
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.automation_monitor_system
    state: 'on'
  - condition: state
    entity_id: person.jenova70
    state: home
  - condition: numeric_state
    entity_id: sensor.low_batteries
    above: 0
  actions:
  - action: script.turn_on
    metadata: {}
    data:
      variables:
        user_message: '{%- from ''device_names_clean.jinja'' import device_names_clean
          -%}

          {{device_names_clean(state_attr(''sensor.low_batteries'',''entities''))}}

          '
    target:
      entity_id: script.power_notification_batteries_faibles
  mode: single
- id: '1688537182551'
  alias: "Servarr - \U0001F514 Notification "
  description: ''
  triggers:
  - allowed_methods:
    - POST
    local_only: true
    webhook_id: sonarr-download--KqTQ4vReuFd_as1xTR_hPqk2
    id: sonarr-download
    variables:
      title: ✅ Épisode téléchargé !
      message: '{{trigger.json.series.title}} - {{trigger.json.episodes[0].seasonNumber}}x{{trigger.json.episodes[0].episodeNumber}}
        - {{trigger.json.episodes[0].title}}'
    trigger: webhook
  - allowed_methods:
    - POST
    local_only: true
    webhook_id: radarr-download-grab-ugUFeiF1HF_WK_-jpm1aFMCQ
    id: radarr-download
    variables:
      title: ✅ Film téléchargé !
      message: '{{trigger.json.movie.title}} ({{trigger.json.movie.year}})'
    trigger: webhook
  conditions:
  - condition: state
    entity_id: input_boolean.recevoir_notification_media_telecharge
    state: 'on'
  actions:
  - action: script.turn_on
    metadata: {}
    data:
      variables:
        user_title: '{{title}}'
        user_message: '{{message}}'
    target:
      entity_id: script.power_notification_servaar
  mode: single
- id: '1689253436663'
  alias: Lumières Extérieures - Synchroniser Hue et SONOFF
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.is_exterior_sphere_bright
    from: 'off'
    to: 'on'
    id: sphere_bright
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: state
  - entity_id:
    - binary_sensor.is_exterior_sphere_bright
    from: 'on'
    to: 'off'
    id: sphere_not_bright
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: state
  - entity_id:
    - light.plafonnier_exterieur
    from: 'off'
    to: 'on'
    id: ceiling_light_on
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: state
  - entity_id:
    - light.plafonnier_exterieur
    from: 'on'
    to: 'off'
    id: ceiling_light_off
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - sphere_bright
      - condition: state
        entity_id: light.plafonnier_exterieur
        state: 'off'
      sequence:
      - action: light.turn_on
        data: {}
        target:
          entity_id: light.plafonnier_exterieur
    - conditions:
      - condition: trigger
        id:
        - sphere_not_bright
      - condition: state
        entity_id: light.plafonnier_exterieur
        state: 'on'
      sequence:
      - action: light.turn_off
        data: {}
        target:
          entity_id: light.plafonnier_exterieur
    - conditions:
      - condition: trigger
        id:
        - ceiling_light_on
      - condition: state
        entity_id: binary_sensor.is_exterior_sphere_bright
        state: 'off'
      sequence:
      - action: light.turn_on
        data:
          brightness_pct: 100
        target:
          entity_id:
          - light.exterieur_sphere
    - conditions:
      - condition: trigger
        id:
        - ceiling_light_off
      - condition: state
        entity_id: binary_sensor.is_exterior_sphere_bright
        state: 'on'
      sequence:
      - action: light.turn_off
        data: {}
        target:
          entity_id:
          - light.exterieur_sphere
  mode: parallel
  max: 10
- id: '1691413517615'
  alias: Bureau - Notification Lumineuse Meetings
  description: ''
  triggers:
  - event: start
    offset: -0:5:0
    entity_id: calendar.jeanloic_pouffier_openhomefoundation_org
    id: personal
    trigger: calendar
  - event: start
    offset: -0:5:0
    entity_id: calendar.ohf_events
    id: social_time
    trigger: calendar
  - event: start
    offset: -0:1:0
    entity_id: calendar.jeanloic_pouffier_openhomefoundation_org
    id: personal
    trigger: calendar
  - event: start
    offset: -0:1:0
    entity_id: calendar.ohf_events
    id: social_time
    trigger: calendar
  conditions:
  - condition: state
    entity_id: input_boolean.automation_meetings
    state: 'on'
  - condition: state
    entity_id: person.jenova70
    state: home
  - condition: state
    entity_id: binary_sensor.capteur_presence_bureau_occupancy
    state: 'on'
  - condition: state
    entity_id: binary_sensor.jean_loics_macbook_pro_active
    state: 'on'
  - condition: state
    entity_id: device_tracker.jean_loics_macbook_pro
    state: home
  actions:
  - action: scene.create
    data:
      scene_id: dynamic_scene_before_meeting_notification
      snapshot_entities:
      - light.hue_play_bars
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - choose:
    - conditions:
      - condition: trigger
        id:
        - personal
      sequence:
      - action: light.turn_on
        data:
          brightness_pct: 100
          rgb_color:
          - 0
          - 76
          - 255
          transition: 1
        target:
          entity_id:
          - light.hue_play_bars
    - conditions:
      - condition: trigger
        id:
        - social_time
      sequence:
      - action: light.turn_on
        data:
          brightness_pct: 100
          rgb_color:
          - 68
          - 255
          - 0
          transition: 1
        target:
          entity_id:
          - light.hue_play_bars
    default:
    - action: light.turn_on
      data:
        brightness_pct: 100
        rgb_color:
        - 0
        - 76
        - 255
        transition: 1
      target:
        entity_id:
        - light.hue_play_bars
  - delay:
      hours: 0
      minutes: 0
      seconds: 2
      milliseconds: 0
  - action: scene.turn_on
    data: {}
    target:
      entity_id: scene.dynamic_scene_before_meeting_notification
  - action: scene.delete
    metadata: {}
    data: {}
    target:
      entity_id: scene.dynamic_scene_before_meeting_notification
  mode: single
- id: '1691566363432'
  alias: "Simulation de présence - \U0001F6CE️ Notifier Éloignement domicile sans
    simulation de présence"
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.far_away
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_presence_simulator
    state: 'off'
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_simulation_de_presence_et_eloignement_du_domicile
  mode: single
- id: '1691758172267'
  alias: "Pont Chaban Delmas - \U0001F6CE️ Notifier fermeture demain"
  description: ''
  triggers:
  - at: '20:00:00'
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.automation_notify_chaban_delmas_bridge
    state: 'on'
  - condition: template
    value_template: '{{as_datetime(states("sensor.chaban_delmas_next_closing_start_date"))
      - now() > timedelta(hours = 4)}}'
  - condition: template
    value_template: '{{as_datetime(states("sensor.chaban_delmas_next_closing_start_date"))
      - now() < timedelta(days = 1, hours = 4)}}'
  actions:
  - variables:
      human_redeable_closing_time: '{{as_timestamp(states("sensor.chaban_delmas_next_closing_start_date"))
        | timestamp_custom(''%H:%M'')}}

        '
  - if:
    - condition: numeric_state
      entity_id: sensor.distance_jlo_maison
      below: 20000
    then:
    - action: script.turn_on
      metadata: {}
      data:
        variables:
          user_message: Le pont Chaban Delmas fermera demain à {{human_redeable_closing_time}}
      target:
        entity_id: script.power_notification_pont_chaban_delmas
  mode: single
- id: '1692118004694'
  alias: Simulation de présence - Arrêter lors du retour
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Occupée
  conditions:
  - condition: state
    entity_id: input_boolean.automation_presence_simulator
    state: 'on'
  actions:
  - action: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.automation_presence_simulator
  mode: single
- id: '1693509234441'
  alias: "Tesla - \U0001F514 Rappel charge "
  description: ''
  triggers:
  - entity_id:
    - schedule.heures_pleines
    from: 'on'
    to: 'off'
    trigger: state
  - entity_id:
    - device_tracker.meme_emplacement
    to: home
    for:
      hours: 0
      minutes: 1
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_tesla
    state: 'on'
  - condition: state
    entity_id: device_tracker.meme_emplacement
    state: home
  - condition: state
    entity_id: binary_sensor.meme_cable_de_charge
    state: 'off'
  - condition: numeric_state
    entity_id: sensor.meme_niveau_de_la_batterie
    below: 65
  - condition: state
    entity_id: person.jenova70
    state: home
  - condition: state
    entity_id: schedule.heures_pleines
    state: 'off'
  actions:
  - action: script.turn_on
    metadata: {}
    data:
      variables:
        user_message: Pense à charger la voiture. Niveau de charge actuelle {{states('sensor.meme_niveau_de_la_batterie')}}%
    target:
      entity_id: script.power_notification_rappel_charge_tesla
  mode: single
- id: '1699868538036'
  alias: Routine du sommeil Marilou - Arrêter
  description: ''
  triggers:
  - event: start
    id: restart
    trigger: homeassistant
  - at: input_datetime.marilou_bedtime_routine_end
    id: end
    trigger: time
  conditions:
  - condition: state
    entity_id: media_player.vpe_chambre_marilou_music_assistant
    state: playing
  - condition: template
    value_template: '{{now() >= as_local(as_datetime(states("input_datetime.marilou_bedtime_routine_end")))}}'
  actions:
  - action: media_player.media_pause
    data: {}
    target:
      entity_id:
      - media_player.vpe_chambre_marilou_music_assistant
  - action: light.turn_off
    data: {}
    target:
      area_id: chambre_bebe
  mode: single
- id: '1700410464307'
  alias: Simulation de présence
  description: ''
  triggers:
  - trigger: calendar
    entity_id: calendar.presence_simulation
    event: start
    offset: 0:0:0
  - entity_id:
    - input_boolean.automation_presence_simulator
    trigger: state
  - entity_id:
    - input_boolean.presence_simulator_control_cover
    trigger: state
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - event: start
    trigger: homeassistant
  conditions:
  - condition: state
    entity_id: input_boolean.automation_presence_simulator
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Vide
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - action: calendar.get_events
    target:
      entity_id: calendar.presence_simulation
    data:
      duration:
        hours: 0
        minutes: 1
        seconds: 0
      start_date_time: '{{now()}}'
    response_variable: calendar_data
  - variables:
      step: '{{calendar_data["calendar.presence_simulation"].events[0].summary}}

        '
  - if:
    - condition: state
      entity_id: lock.serrure_porte_d_entree
      state: unlocked
    then:
    - wait_for_trigger:
      - trigger: state
        entity_id:
        - lock.serrure_porte_d_entree
        from: locked
      timeout:
        hours: 0
        minutes: 30
        seconds: 0
        milliseconds: 0
  - choose:
    - conditions:
      - condition: template
        value_template: '{{step == "out"}}'
      sequence:
      - action: light.turn_off
        data: {}
        target:
          floor_id:
          - rez_de_chaussee
          - premier_etage
          area_id: exterieur
      - if:
        - condition: state
          entity_id: input_boolean.presence_simulator_control_cover
          state: 'on'
        then:
        - action: cover.close_cover
          data: {}
          target:
            entity_id: cover.volets_salon
        - action: cover.close_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideaux_premier_etage
    - conditions:
      - condition: template
        value_template: '{{step == "wake_up"}}'
      sequence:
      - action: light.turn_off
        data: {}
        target:
          floor_id: rez_de_chaussee
          area_id:
          - exterieur
          - couloir
      - action: light.turn_on
        data:
          brightness_pct: 50
        target:
          area_id:
          - bureau
          - chambre
          - chambre_bebe
      - if:
        - condition: state
          entity_id: input_boolean.presence_simulator_control_cover
          state: 'on'
        then:
        - action: cover.close_cover
          data: {}
          target:
            entity_id: cover.volets_salon
        - action: cover.open_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideaux_premier_etage
    - conditions:
      - condition: template
        value_template: '{{step == "breakfast"}}'
      sequence:
      - action: light.turn_off
        data: {}
        target:
          floor_id: premier_etage
          area_id: exterieur
      - action: light.turn_on
        data:
          brightness_pct: 60
        target:
          floor_id: rez_de_chaussee
      - if:
        - condition: state
          entity_id: input_boolean.presence_simulator_control_cover
          state: 'on'
        then:
        - action: cover.open_cover
          data: {}
          target:
            entity_id: cover.volets_salon
        - action: cover.open_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideaux_premier_etage
    - conditions:
      - condition: template
        value_template: '{{step == "chill"}}'
      sequence:
      - action: light.turn_off
        data: {}
        target:
          floor_id: premier_etage
      - action: light.turn_on
        data:
          brightness_pct: 40
        target:
          floor_id: rez_de_chaussee
          entity_id: light.exterieur_guinguette
      - if:
        - condition: state
          entity_id: input_boolean.presence_simulator_control_cover
          state: 'on'
        then:
        - action: cover.open_cover
          data: {}
          target:
            entity_id: cover.volets_salon
        - action: cover.open_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideaux_premier_etage
    - conditions:
      - condition: template
        value_template: '{{step == "eating"}}'
      sequence:
      - action: light.turn_off
        data: {}
        target:
          floor_id: premier_etage
      - action: light.turn_on
        data:
          brightness_pct: 60
        target:
          floor_id: rez_de_chaussee
          entity_id: light.exterieur_guinguette
      - if:
        - condition: state
          entity_id: input_boolean.presence_simulator_control_cover
          state: 'on'
        then:
        - action: cover.open_cover
          data: {}
          target:
            entity_id: cover.volets_salon
        - action: cover.open_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideaux_premier_etage
    - conditions:
      - condition: template
        value_template: '{{step == "bedtime"}}'
      sequence:
      - action: light.turn_off
        data: {}
        target:
          floor_id: rez_de_chaussee
          area_id:
          - couloir
          - exterieur
      - action: light.turn_on
        data:
          brightness_pct: 40
        target:
          area_id:
          - bureau
          - chambre
          - chambre_bebe
      - if:
        - condition: state
          entity_id: input_boolean.presence_simulator_control_cover
          state: 'on'
        then:
        - action: cover.open_cover
          data: {}
          target:
            entity_id: cover.volets_salon
        - action: cover.open_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideaux_premier_etage
  mode: single
- id: '1702164245946'
  alias: Routine du sommeil Marilou - Changer heure fin de routine
  description: ''
  triggers:
  - entity_id:
    - input_number.marilou_bedtime_routine_duration
    trigger: state
  - entity_id:
    - script.start_marilou_bedtime_routine
    to: 'on'
    trigger: state
  conditions: []
  actions:
  - action: input_datetime.set_datetime
    data:
      datetime: '{{ now() + timedelta (minutes = states(''input_number.marilou_bedtime_routine_duration'')
        | int) }}'
    target:
      entity_id: input_datetime.marilou_bedtime_routine_end
  mode: single
- id: '1702834566659'
  alias: "Poubelles Intelligentes - \U0001F514 Notifier"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: state
    entity_id:
    - input_boolean.poubelle_noire_a_sortir
  - trigger: state
    entity_id:
    - input_boolean.poubelle_verte_a_sortir
  conditions:
  - condition: state
    entity_id: input_boolean.automation_take_out_trash
    state: 'on'
  actions:
  - if:
    - condition: state
      entity_id: input_boolean.poubelle_noire_a_sortir
      state: 'on'
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state:
      - Départ en cours
      - Arrivée en cours
    then:
    - action: script.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: script.power_notification_poubelle_noire_a_sortir
  - if:
    - condition: state
      entity_id: input_boolean.poubelle_verte_a_sortir
      state: 'on'
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state:
      - Départ en cours
      - Arrivée en cours
    then:
    - action: script.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: script.power_notification_poubelle_verte_a_sortir
  mode: single
- id: '1702835659800'
  alias: "Poubelles Intelligentes - \U0001F4F2 Poubelle verte sortie depuis notification"
  description: ''
  triggers:
  - event_type: mobile_app_notification_action
    event_data:
      action: green_trash_taken_out
    trigger: event
  conditions: []
  actions:
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.poubelle_verte_a_sortir
    data: {}
  mode: single
- id: '1702835708226'
  alias: "Poubelles Intelligentes - \U0001F4F2 Poubelle noire sortie depuis notification"
  description: ''
  triggers:
  - event_type: mobile_app_notification_action
    event_data:
      action: black_trash_taken_out
    trigger: event
  conditions: []
  actions:
  - action: input_boolean.turn_off
    target:
      entity_id:
      - input_boolean.poubelle_noire_a_sortir
    data: {}
  mode: single
- id: '1703176659308'
  alias: Bureau - Standing Desk Autonome
  description: ''
  triggers:
  - minutes: '25'
    trigger: time_pattern
  - minutes: '55'
    trigger: time_pattern
  conditions:
  - condition: state
    entity_id: input_boolean.automation_meetings
    state: 'on'
  - condition: state
    entity_id: binary_sensor.jean_loics_macbook_pro_camera_in_use
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: person.jenova70
        state: home
      - condition: state
        entity_id: binary_sensor.jean_loics_macbook_pro_active
        state: 'on'
      - condition: state
        entity_id: device_tracker.jean_loics_macbook_pro
        state: home
      - condition: state
        entity_id: binary_sensor.capteur_presence_bureau_occupancy
        state: 'on'
      - condition: state
        entity_id: binary_sensor.jour_de_travail_aujourdhui
        state: 'on'
      - condition: state
        entity_id: schedule.working_hours
        state: 'on'
      - condition: numeric_state
        entity_id: sensor.next_meeting_in
        above: 2100
      - condition: state
        entity_id: sensor.de_4_standing_desk_autonome
        state: '1'
      sequence:
      - action: script.controler_le_standing_desk
        metadata: {}
        data:
          target_position: standing
    default:
    - action: script.controler_le_standing_desk
      metadata: {}
      data:
        target_position: sitting
  mode: single
- id: '1707214155021'
  alias: "Bureau - \U0001F4E3 Contrôle du Standing Desk par la voix"
  description: ''
  triggers:
  - command:
    - (Lève|Lever|Monte|Monter) [le] bureau
    - (Mais|Mets|Mettre|Passe|Passer) [le] bureau [en] (mode|position) debout
    id: up
    trigger: conversation
  - command:
    - (descend|descends|descendre|Baisse|Baisser) [le] bureau
    - (Mais|Mets|Mettre|Passe|Passer) [le] bureau [en] (mode|position) (assis|assise)
    id: down
    trigger: conversation
  conditions:
  - condition: state
    entity_id: binary_sensor.standing_desk_moving
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - up
      sequence:
      - action: script.turn_on
        metadata: {}
        data:
          variables:
            target_position: standing
        target:
          entity_id: script.controler_le_standing_desk
      - set_conversation_response: Bureau en montée
    - conditions:
      - condition: trigger
        id:
        - down
      sequence:
      - action: script.turn_on
        metadata: {}
        data:
          variables:
            target_position: sitting
        target:
          entity_id: script.controler_le_standing_desk
      - set_conversation_response: Bureau en descente
  mode: single
- id: '1707424061311'
  alias: "Mode Sommeil Marilou - \U0001F4E3 Lancer par commande vocale "
  description: ''
  triggers:
  - command:
    - 'Au dodo '
    - (Au lit)|(Ollie)|(Holly)
    trigger: conversation
  conditions: []
  actions:
  - action: input_boolean.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.mode_sommeil_marilou
  - set_conversation_response: Bonne nuit Marilou !
  mode: single
- id: '1714134719761'
  alias: "Assist - \U0001F4E3 Réinitialiser la lumière"
  description: Cet automatisme permet de réinitialiser les lumières à leur scène par
    défaut via une commande vocale. Il vérifie si un appareil approprié est utilisé
    et s'il existe des scènes par défaut dans la zone, puis applique la scène correspondante.
  triggers:
  - command:
    - réinitialise[r] (la|les) lumière[s]
    trigger: conversation
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{ trigger.device_id != None}}'
    then:
    - variables:
        target_scene_list: "{% set default_scenes = label_entities(\"Scène par défaut\")
          %}\n{% set target_area = area_id(trigger.device_id) %}\n{% set entities_in_area
          = area_entities(target_area) %}\n\n[\n{%- for entity in entities_in_area
          -%}\n  {%- if entity in default_scenes -%}\n    \"{{entity}}\",\n  {%- endif
          -%}\n{%- endfor -%}\n]\n"
    - if:
      - condition: template
        value_template: '{{ target_scene_list | count >=1 }}'
      then:
      - action: scene.turn_on
        metadata: {}
        target:
          entity_id: '{{target_scene_list}}'
        data: {}
      - set_conversation_response: Lumière réinitialisée
      else:
      - set_conversation_response: Aucune scène par défaut trouvée
    else:
    - set_conversation_response: Cette commande ne fonctionne pas depuis cet appareil
  mode: single
- id: '1714308060749'
  alias: Réveil intelligent - Démarrer la Musique
  description: ''
  triggers:
  - at: input_datetime.wake_up_time
    trigger: time
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: state
    entity_id: input_boolean.reveil_intelligent_musical
    state: 'on'
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: state
        entity_id: input_select.reveil_intelligent
        state: Automatique
      - condition: state
        entity_id: binary_sensor.jour_de_travail_aujourdhui
        state: 'on'
    - condition: state
      entity_id: input_select.reveil_intelligent
      state: Activé
  actions:
  - action: script.lancer_playlist_de_reveil
    metadata: {}
    data: {}
    enabled: true
  mode: single
- id: '1718020295304'
  alias: Éteindre Bureau si plus de présence
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_bureau_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: bureau
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id: button.standing_desk_move_desk_to_position_2
    enabled: true
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id:
      - media_player.sonos_bureau_music_assistant
  mode: single
- id: '1718020351848'
  alias: Éteindre Chambre si plus de présence
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_chambre_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: chambre
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id:
      - media_player.vpe_chambre_music_assistant
  mode: single
- id: '1718020490708'
  alias: Éteindre Chambre Marilou si plus de présence
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_chambre_marilou_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: chambre_bebe
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id: media_player.vpe_chambre_marilou_music_assistant
  mode: single
- id: '1718707293101'
  alias: Transfert Musique Tesla vers Maison - Transférer Musique
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Occupée
    from: Arrivée en cours
  conditions:
  - condition: state
    entity_id: input_boolean.automation_tesla
    state: 'on'
  - condition: state
    entity_id: input_boolean.transfert_musique_tesla_vers_maison
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.tesla_recent_playback
        state: 'on'
      - condition: template
        value_template: '{{state_attr(''binary_sensor.tesla_recent_playback'',''title'')
          != None}}'
      - condition: template
        value_template: '{{state_attr(''binary_sensor.tesla_recent_playback'',''artist'')
          != None}}'
      sequence:
      - action: music_assistant.play_media
        metadata: {}
        data:
          media_type: track
          enqueue: replace
          radio_mode: true
          artist: '{{state_attr(''binary_sensor.tesla_recent_playback'',''artist'')}}'
          media_id: '{{state_attr(''binary_sensor.tesla_recent_playback'',''title'')}}'
        target:
          entity_id: media_player.sonos_amp_music_assistant
      - action: media_player.volume_set
        metadata: {}
        data:
          volume_level: 0.4
        target:
          entity_id:
          - media_player.sonos_amp_music_assistant
  mode: queued
  max: 10
- id: '1726171964785'
  alias: Chauffage Intelligent - Choisir Mode Rez-De-Chaussée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    from: Vide
  - trigger: state
    entity_id:
    - sensor.ratio_de_presence_rez_de_chaussee
  - entity_id:
    - binary_sensor.ouverture_salon
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
    to:
  - event: start
    trigger: homeassistant
  - entity_id:
    - input_boolean.guest_mode
    trigger: state
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
  - trigger: state
    entity_id:
    - input_boolean.mode_cinema
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.ouverture_salon
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Frost Guard
        target:
          entity_id: input_select.mode_chauffage_rez_de_chaussee
    - conditions:
      - condition: or
        conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_select.modes_de_presence_de_la_maison_v2
            state: Vide
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
        alias: Home occupied
      - alias: Room occupied
        condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.ratio_de_presence_rez_de_chaussee
          above: 50
        - condition: state
          entity_id: input_boolean.mode_cinema
          state: 'on'
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'off'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Présent
        target:
          entity_id: input_select.mode_chauffage_rez_de_chaussee
    default:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Absent
      target:
        entity_id: input_select.mode_chauffage_rez_de_chaussee
  mode: queued
  max: 10
- id: '1726172240853'
  alias: Chauffage Intelligent - Choisir Mode Bureau
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    from: Vide
  - entity_id:
    - binary_sensor.capteur_ouverture_fenetre_bureau
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - trigger: state
    entity_id:
    - sensor.capteur_de_presence_bureau_ratio_de_presence
  - event: start
    trigger: homeassistant
  - entity_id:
    - input_boolean.guest_mode
    trigger: state
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.capteur_ouverture_fenetre_bureau
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Frost Guard
        target:
          entity_id:
          - input_select.mode_chauffage_bureau
    - conditions:
      - condition: or
        conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_select.modes_de_presence_de_la_maison_v2
            state: Vide
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
        alias: Home is occupied
      - alias: Room occupied
        condition: numeric_state
        entity_id: sensor.capteur_de_presence_bureau_ratio_de_presence
        above: 50
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'off'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Présent
        target:
          entity_id: input_select.mode_chauffage_bureau
    default:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Absent
      target:
        entity_id:
        - input_select.mode_chauffage_bureau
  mode: queued
  max: 10
- id: '1726172527832'
  alias: Chauffage Intelligent - Choisir Mode Chambre
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    from: Vide
  - entity_id:
    - binary_sensor.capteur_ouverture_fenetre_chambre
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - trigger: state
    enabled: false
    entity_id:
    - sensor.capteur_de_presence_chambre_ratio_de_presence
  - event: start
    trigger: homeassistant
  - entity_id:
    - input_boolean.guest_mode
    trigger: state
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.capteur_ouverture_fenetre_chambre
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Frost Guard
        target:
          entity_id: input_select.mode_chauffage_chambre
    - conditions:
      - condition: or
        conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_select.modes_de_presence_de_la_maison_v2
            state: Vide
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
        alias: Home occupied
      - alias: Room occupied
        condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.capteur_de_presence_chambre_ratio_de_presence
          above: 50
          enabled: false
        - condition: state
          entity_id: input_boolean.mode_sommeil
          state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Présent
        target:
          entity_id:
          - input_select.mode_chauffage_chambre
    default:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Absent
      target:
        entity_id:
        - input_select.mode_chauffage_chambre
  mode: queued
  max: 10
- id: '1726172622795'
  alias: Chauffage Intelligent - Choisir Mode Chambre Marilou
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    from: Vide
  - entity_id:
    - binary_sensor.capteur_ouverture_fenetre_chambre_bebe
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - trigger: state
    entity_id:
    - sensor.capteur_de_presence_chambre_marilou_ratio_de_presence
    enabled: false
  - event: start
    trigger: homeassistant
  - entity_id:
    - input_boolean.guest_mode
    trigger: state
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil_marilou
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.capteur_ouverture_fenetre_chambre_bebe
        state: 'on'
        for:
          hours: 0
          minutes: 5
          seconds: 0
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Frost Guard
        target:
          entity_id:
          - input_select.mode_chauffage_chambre_marilou
    - conditions:
      - condition: or
        conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_select.modes_de_presence_de_la_maison_v2
            state: Vide
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
        alias: Home occupied
      - alias: Room occupied
        condition: or
        conditions:
        - condition: numeric_state
          entity_id: sensor.capteur_de_presence_chambre_marilou_ratio_de_presence
          above: 50
          enabled: false
        - condition: state
          entity_id: input_boolean.mode_sommeil_marilou
          state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Présent
        target:
          entity_id:
          - input_select.mode_chauffage_chambre_marilou
    default:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Absent
      target:
        entity_id:
        - input_select.mode_chauffage_chambre_marilou
  mode: queued
  max: 10
- id: '1726173163311'
  alias: Chauffage Intelligent - Régler Température Rez-De-Chaussée
  description: ''
  triggers:
  - entity_id:
    - input_number.temperature_cible_chauffage_rez_de_chaussee
    id: target_changed
    trigger: state
  - entity_id:
    - climate.netatmo
    attribute: temperature
    id: device_changed_1_hour_ago
    for:
      hours: 1
      minutes: 0
      seconds: 0
    trigger: state
  - minutes: '0'
    seconds: '0'
    id: tick
    trigger: time_pattern
  - event: start
    id: restart
    trigger: homeassistant
  - entity_id:
    - input_boolean.chauffage_intelligent_du_rez_de_chaussee
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.chauffage_intelligent_du_rez_de_chaussee
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - target_changed
        - device_changed_1_hour_ago
        - restart
      sequence:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{states(''input_number.temperature_cible_chauffage_rez_de_chaussee'')}}'
        target:
          entity_id: climate.netatmo
    - conditions:
      - condition: trigger
        id:
        - tick
      sequence:
      - if:
        - condition: template
          value_template: '{{states(''input_number.temperature_cible_chauffage_rez_de_chaussee'')|float(0)
            == state_attr(''climate.netatmo'',''temperature'') }}'
        then:
        - action: climate.set_temperature
          metadata: {}
          data:
            temperature: '{{states(''input_number.temperature_cible_chauffage_rez_de_chaussee'')}}'
          target:
            entity_id: climate.netatmo
  mode: queued
  max: 10
- id: '1726173315597'
  alias: Chauffage Intelligent - Régler Température Bureau
  description: ''
  triggers:
  - entity_id:
    - input_number.temperature_cible_chauffage_bureau
    id: target_changed
    trigger: state
  - entity_id:
    - climate.radiateur_bureau
    attribute: temperature
    id: device_changed_1_hour_ago
    for:
      hours: 1
      minutes: 0
      seconds: 0
    trigger: state
  - minutes: '0'
    seconds: '0'
    id: tick
    trigger: time_pattern
  - event: start
    id: restart
    trigger: homeassistant
  - entity_id:
    - input_boolean.chauffage_intelligent_du_bureau
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.chauffage_intelligent_du_bureau
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - target_changed
        - device_changed_1_hour_ago
        - restart
      sequence:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{states(''input_number.temperature_cible_chauffage_bureau'')}}'
        target:
          entity_id: climate.radiateur_bureau
    - conditions:
      - condition: trigger
        id:
        - tick
      sequence:
      - if:
        - condition: template
          value_template: '{{states(''input_number.temperature_cible_chauffage_bureau'')|float(0)
            == state_attr(''climate.radiateur_bureau'',''temperature'') }}'
        then:
        - action: climate.set_temperature
          metadata: {}
          data:
            temperature: '{{states(''input_number.temperature_cible_chauffage_bureau'')}}'
          target:
            entity_id: climate.radiateur_bureau
  mode: queued
  max: 10
- id: '1726173501857'
  alias: Chauffage Intelligent - Régler Température Chambre
  description: ''
  triggers:
  - entity_id:
    - input_number.temperature_cible_chauffage_chambre
    id: target_changed
    trigger: state
  - entity_id:
    - climate.radiateur_chambre
    attribute: temperature
    id: device_changed_1_hour_ago
    for:
      hours: 1
      minutes: 0
      seconds: 0
    trigger: state
  - minutes: '0'
    seconds: '0'
    id: tick
    trigger: time_pattern
  - event: start
    id: restart
    trigger: homeassistant
  - entity_id:
    - input_boolean.chauffage_intelligent_de_la_chambre
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.chauffage_intelligent_de_la_chambre
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - target_changed
        - device_changed_1_hour_ago
        - restart
      sequence:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{states(''input_number.temperature_cible_chauffage_chambre'')}}'
        target:
          entity_id: climate.radiateur_chambre
    - conditions:
      - condition: trigger
        id:
        - tick
      sequence:
      - if:
        - condition: template
          value_template: '{{states(''input_number.temperature_cible_chauffage_chambre'')|float(0)
            == state_attr(''climate.radiateur_chambre'',''temperature'') }}'
        then:
        - action: climate.set_temperature
          metadata: {}
          data:
            temperature: '{{states(''input_number.temperature_cible_chauffage_chambre'')}}'
          target:
            entity_id: climate.radiateur_chambre
  mode: queued
  max: 10
- id: '1726173575899'
  alias: Chauffage Intelligent - Régler Température Chambre Marilou
  description: ''
  triggers:
  - entity_id:
    - input_number.temperature_cible_chauffage_chambre_marilou
    id: target_changed
    trigger: state
  - entity_id:
    - climate.radiateur_chambre_marilou
    attribute: temperature
    id: device_changed_1_hour_ago
    for:
      hours: 1
      minutes: 0
      seconds: 0
    trigger: state
  - minutes: '0'
    seconds: '0'
    id: tick
    trigger: time_pattern
  - event: start
    id: restart
    trigger: homeassistant
  - entity_id:
    - input_boolean.chauffage_intelligent_de_la_chambre_de_marilou
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.chauffage_intelligent_de_la_chambre_de_marilou
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - target_changed
        - device_changed_1_hour_ago
        - restart
      sequence:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{states(''input_number.temperature_cible_chauffage_chambre_marilou'')}}'
        target:
          entity_id: climate.radiateur_chambre_marilou
    - conditions:
      - condition: trigger
        id:
        - tick
      sequence:
      - if:
        - condition: template
          value_template: '{{states(''input_number.temperature_cible_chauffage_chambre_marilou'')|float(0)
            == state_attr(''climate.radiateur_chambre_marilou'',''temperature'') }}'
        then:
        - action: climate.set_temperature
          metadata: {}
          data:
            temperature: '{{states(''input_number.temperature_cible_chauffage_chambre_marilou'')}}'
          target:
            entity_id: climate.radiateur_chambre_marilou
  mode: queued
  max: 10
- id: '1726663233965'
  alias: "Chauffage intelligent - \U0001F6CE️ Notifier Température anormale Salon"
  description: ''
  use_blueprint:
    path: perso/notify_abnormal_temperature_v2.yaml
    input:
      room_name: Le salon
      room_temperature: sensor.capteur_temperature_salon_temperature
      room_openings:
      - binary_sensor.ouverture_salon
      room_openings_duration: 00:05:00
      outside_temperature: sensor.wittboy_outdoor_temperature
      power_notification_script: script.power_notification_temperature_anormale_dans_le_salon
- id: '1726663270597'
  alias: "Chauffage intelligent - \U0001F6CE️ Notifier Température anormale Chambre"
  description: ''
  use_blueprint:
    path: perso/notify_abnormal_temperature_v2.yaml
    input:
      room_name: La chambre
      room_temperature: sensor.radiateur_chambre_current_temperature
      room_openings:
      - binary_sensor.capteur_ouverture_fenetre_chambre
      room_openings_duration: 00:05:00
      outside_temperature: sensor.wittboy_outdoor_temperature
      power_notification_script: script.power_notification_temperature_anormale_dans_la_chambre
- id: '1726663301942'
  alias: "Chauffage intelligent - \U0001F6CE️ Notifier Température anormale Chambre
    Marilou"
  description: ''
  use_blueprint:
    path: perso/notify_abnormal_temperature_v2.yaml
    input:
      room_name: La chambre de Marilou
      room_temperature: sensor.radiateur_chambre_marilou_current_temperature
      room_openings:
      - binary_sensor.capteur_ouverture_fenetre_chambre_bebe
      room_openings_duration: 00:05:00
      outside_temperature: sensor.wittboy_outdoor_temperature
      power_notification_script: script.power_notification_temperature_anormale_dans_la_chambre_de_marilou
- id: '1726663330892'
  alias: "Chauffage intelligent - \U0001F6CE️ Notifier Température anormale Bureau"
  description: ''
  use_blueprint:
    path: perso/notify_abnormal_temperature_v2.yaml
    input:
      room_name: Le bureau
      room_temperature: sensor.capteur_temperature_bureau_temperature
      room_openings:
      - binary_sensor.capteur_ouverture_fenetre_bureau
      room_openings_duration: 00:05:00
      outside_temperature: sensor.wittboy_outdoor_temperature
      power_notification_script: script.power_notification_temperature_anormale_dans_le_bureau
- id: '1726666291089'
  alias: Pulse - Allumer / Éteindre
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_bureau_occupancy
    - input_boolean.automation_matrix_2d
    - input_datetime.pulse_end_schedule
    - input_datetime.pulse_start_schedule
    trigger: state
  - at: input_datetime.pulse_start_schedule
    trigger: time
  - at: input_datetime.pulse_end_schedule
    trigger: time
  - event: start
    trigger: homeassistant
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
  - trigger: state
    entity_id:
    - input_boolean.guest_mode
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.capteur_presence_bureau_occupancy
      state: 'on'
    - condition: time
      after: input_datetime.pulse_start_schedule
      before: input_datetime.pulse_end_schedule
    - condition: state
      entity_id: input_boolean.automation_matrix_2d
      state: 'on'
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state: Occupée
    - condition: state
      entity_id: input_boolean.mode_sommeil
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    then:
    - action: light.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: light.2d_matrix
    - action: select.random
      target:
        entity_id:
        - select.2d_matrix_preset
      data: {}
    else:
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: light.2d_matrix
  mode: restart
- id: '1727025004524'
  alias: "Mode Invité - \U0001F514 Notifier mode invité lors de l'arrivée"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Occupée
  conditions:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'on'
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_desactiver_mode_invite_lors_de_l_arrivee
  mode: single
- id: '1727807421914'
  alias: "\U0001F514 Notifier porte d'entrée ouverte"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.capteur_ouverture_porte_entree
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_porte_d_entree_restee_ouverte
  - action: assist_satellite.announce
    metadata: {}
    data:
      message: La porte d'entrée est restée ouverte!
      preannounce: true
      preannounce_media_id: media-source://media_source/local/error.mp3
    target:
      entity_id:
      - assist_satellite.vpe_salon_satellite_assist
  mode: single
- id: '1727807641536'
  alias: Éteindre Couloir automatiquement
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - light.couloir
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: couloir
  mode: single
- id: '1727985869387'
  alias: Modes de presence de la maison - Occupée au démarrage
  description: ''
  triggers:
  - trigger: homeassistant
    event: start
  conditions:
  - condition: state
    entity_id: binary_sensor.home_occupied
    state: 'on'
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Occupée
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727985928425'
  alias: Modes de presence de la maison - Occupée lors de l'ouverture de la porte
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.capteur_ouverture_porte_entree
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Arrivée en cours
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Occupée
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727985974297'
  alias: Modes de presence de la maison - Occupée si porte déjà ouverte lors de l'arrivée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Arrivée en cours
  conditions:
  - condition: state
    entity_id: binary_sensor.capteur_ouverture_porte_entree
    state: 'on'
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Occupée
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727986078836'
  alias: Modes de presence de la maison - Occupée via le Dial Hue
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.hue_tap_dial_switch_1_bouton_1
    attribute: event_type
    to: long_release
    for:
      hours: 0
      minutes: 0
      seconds: 0
  - trigger: state
    entity_id:
    - event.hue_tap_dial_switch_1_bouton_2
    attribute: event_type
    to: long_release
    for:
      hours: 0
      minutes: 0
      seconds: 0
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Arrivée en cours
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Occupée
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727986554484'
  alias: Modes de presence de la maison - Départ en cours via Occupation de la maison
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.home_occupied
    to: 'off'
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state: Occupée
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state: Arrivée en cours
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Départ en cours
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727986656573'
  alias: Modes de presence de la maison - Vide lors de l'ouverture de la porte
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.capteur_ouverture_porte_entree
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Départ en cours
  actions:
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.capteur_ouverture_porte_entree
      to: 'off'
    timeout:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - action: input_select.select_option
    metadata: {}
    data:
      option: Vide
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727986721466'
  alias: Modes de presence de la maison - Vide si porte déjà ouverte lors du départ
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Départ en cours
  conditions:
  - condition: state
    entity_id: binary_sensor.capteur_ouverture_porte_entree
    state: 'on'
  actions:
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.capteur_ouverture_porte_entree
      to: 'off'
    timeout:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - action: input_select.select_option
    metadata: {}
    data:
      option: Vide
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727986811171'
  alias: Modes de presence de la maison - Vide si Occupation de la maison déjà vide
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Départ en cours
  conditions:
  - condition: state
    entity_id: binary_sensor.home_occupied
    state: 'off'
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Vide
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727986902983'
  alias: Modes de presence de la maison - Départ en cours via le Dial Hue
  description: ''
  triggers:
  - entity_id:
    - event.hue_tap_dial_switch_1_bouton_3
    attribute: event_type
    to: repeat
    id: 'on'
    trigger: state
  - entity_id:
    - event.hue_tap_dial_switch_1_bouton_4
    attribute: event_type
    to: repeat
    id: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: state
    entity_id: input_boolean.automation_presence_simulator
    state: 'off'
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Départ en cours
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  - if:
    - condition: state
      entity_id: lock.serrure_porte_d_entree
      state: locked
    then:
    - action: lock.unlock
      metadata: {}
      data: {}
      target:
        entity_id: lock.serrure_porte_d_entree
    - action: script.power_notification_serrure_deverrouillee
      metadata: {}
      data:
        user_importance: false
  - action: assist_satellite.announce
    metadata: {}
    data:
      message: '{% set time = now().hour %} {% if (time >= 18) %} Bonne soirée {%
        elif (time >= 12) %} Bonne après-midi {% elif (time >= 5) %} Bonne journée
        {% else %} Bonne nuit {% endif %}'
      preannounce: false
    target:
      entity_id: assist_satellite.vpe_salon_satellite_assist
  mode: single
- id: '1727986956298'
  alias: Modes de presence de la maison - Départ en cours via la voix
  description: ''
  triggers:
  - command:
    - Je pars [faire un tour]
    - Je m'en vais [faire un tour]
    - On part [faire un tour]
    - On s'en va [faire un tour]
    trigger: conversation
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state: Occupée
    then:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Départ en cours
      target:
        entity_id: input_select.modes_de_presence_de_la_maison_v2
    - set_conversation_response: '{% set time = now().hour %}

        {% if (time >= 18) %}

        Bonne soirée

        {% elif (time >= 12) %}

        Bonne après-midi

        {% elif (time >= 5) %}

        Bonne journée

        {% else %}

        Bonne nuit

        {% endif %}'
    - if:
      - condition: template
        value_template: '{{ trigger.device_id != None}}'
      - condition: template
        value_template: '{{area_id(trigger.device_id) in ["salon","cuisine"]}}'
      - condition: state
        entity_id: lock.serrure_porte_d_entree
        state: locked
      then:
      - action: lock.unlock
        metadata: {}
        data: {}
        target:
          entity_id: lock.serrure_porte_d_entree
      - action: script.power_notification_serrure_deverrouillee
        metadata: {}
        data:
          user_importance: false
    else:
    - set_conversation_response: La maison n'est pas occupée actuellement. Départ
        annulé
  mode: single
- id: '1727987133642'
  alias: Modes de presence de la maison - Vide au démarrage
  description: ''
  triggers:
  - trigger: homeassistant
    event: start
  conditions:
  - condition: state
    entity_id: binary_sensor.home_occupied
    state: 'off'
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Vide
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727987264453'
  alias: 'Modes de presence de la maison - Arrivée en cours via Occupation de la maison '
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.home_occupied
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Vide
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Arrivée en cours
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727987389149'
  alias: Modes de presence de la maison - Arrivée en cours via le Dial Hue
  description: ''
  triggers:
  - entity_id:
    - event.hue_tap_dial_switch_1_bouton_1
    attribute: event_type
    to: repeat
    id: 'on'
    trigger: state
  - entity_id:
    - event.hue_tap_dial_switch_1_bouton_2
    attribute: event_type
    to: repeat
    id: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: state
    entity_id: input_boolean.automation_presence_simulator
    state: 'off'
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Arrivée en cours
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727989830960'
  alias: Surveillance de la maison - Notifier appareils allumé lors du départ
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Départ en cours
    from: Occupée
  conditions:
  - condition: state
    entity_id: input_boolean.depart_intelligent
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - action: script.preparer_depart_maison
    data: {}
  mode: queued
  max: 10
- id: '1728137727182'
  alias: Modes de presence de la maison / Fallback modes temporaires
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    for:
      hours: 0
      minutes: 15
      seconds: 0
    to: Départ en cours
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    for:
      hours: 0
      minutes: 15
      seconds: 0
    to: Arrivée en cours
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.home_occupied
        state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Occupée
        target:
          entity_id: input_select.modes_de_presence_de_la_maison_v2
    - conditions:
      - condition: state
        entity_id: binary_sensor.home_occupied
        state: 'off'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Vide
        target:
          entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1728146766901'
  alias: "Boîte aux Lettres Intelligente - \U0001F514 Notifier"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.courrier_a_relever
    id: mail
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Départ en cours
    id: arriving_leaving
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Arrivée en cours
    id: arriving_leaving
  conditions:
  - condition: state
    entity_id: input_boolean.automation_monitor_mailbox
    state: 'on'
  - condition: state
    entity_id: input_boolean.courrier_a_relever
    state: 'on'
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state: Vide
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - mail
      - condition: not
        conditions:
        - condition: state
          entity_id: input_select.modes_de_presence_de_la_maison_v2
          state: Vide
      sequence:
      - action: script.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: script.power_notification_courrier_a_relever
    - conditions:
      - condition: trigger
        id:
        - arriving_leaving
      - condition: state
        entity_id: input_boolean.courrier_a_relever
        state: 'on'
      sequence:
      - action: script.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: script.power_notification_courrier_a_relever
  mode: single
- id: '1728147111105'
  alias: "Machine a Laver - \U0001F514 Notifier cycle terminé"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.etat_machine_a_laver
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  conditions:
  - condition: state
    entity_id: input_boolean.automation_monitor_washing_machine
    state: 'on'
  - condition: state
    entity_id: input_select.etat_machine_a_laver
    state: À vider
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_machine_a_laver_terminee
  mode: single
- id: '1728584203675'
  alias: Chauffage intelligent - Arrêter Boost Salle de Bains
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.chauffage_salle_de_bains_boost
    to: 'on'
    for:
      hours: 0
      minutes: 20
      seconds: 0
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.chauffage_salle_de_bains_boost
  mode: queued
  max: 10
- id: '1728584273169'
  alias: Chauffage intelligent - Arrêter Boost Salle de Douche
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.chauffage_salle_de_douche_boost
    to: 'on'
    for:
      hours: 0
      minutes: 20
      seconds: 0
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.chauffage_salle_de_douche_boost
  mode: queued
  max: 10
- id: '1728584405832'
  alias: Chauffage Intelligent - Choisir Mode Salle De Douche
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    from: Vide
  - event: start
    trigger: homeassistant
  - entity_id:
    - input_boolean.guest_mode
    trigger: state
  - trigger: state
    entity_id:
    - input_boolean.chauffage_salle_de_douche_boost
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.chauffage_salle_de_douche_boost
        state: 'on'
      - condition: or
        conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_select.modes_de_presence_de_la_maison_v2
            state: Vide
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Boost
        target:
          entity_id: input_select.mode_chauffage_salle_de_douche
    default:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Normal
      target:
        entity_id: input_select.mode_chauffage_salle_de_douche
  mode: queued
  max: 10
- id: '1728584599375'
  alias: Chauffage Intelligent - Choisir Mode Salle De Bains
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    from: Vide
  - entity_id:
    - binary_sensor.capteur_ouverture_fenetre_salle_de_bain
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - event: start
    trigger: homeassistant
  - entity_id:
    - input_boolean.guest_mode
    trigger: state
  - trigger: state
    entity_id:
    - input_boolean.chauffage_salle_de_bains_boost
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.capteur_ouverture_fenetre_salle_de_bain
        state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Frost Guard
        target:
          entity_id: input_select.mode_chauffage_salle_de_bains
    - conditions:
      - condition: state
        entity_id: input_boolean.chauffage_salle_de_bains_boost
        state: 'on'
      - condition: or
        conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_select.modes_de_presence_de_la_maison_v2
            state: Vide
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Boost
        target:
          entity_id: input_select.mode_chauffage_salle_de_bains
    default:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Normal
      target:
        entity_id: input_select.mode_chauffage_salle_de_bains
  mode: queued
  max: 10
- id: '1728584808902'
  alias: Chauffage Intelligent - Régler Température Salle De Bains
  description: ''
  triggers:
  - entity_id:
    - input_number.temperature_cible_chauffage_salle_de_bains
    id: target_changed
    trigger: state
  - entity_id:
    - climate.radiateur_salle_de_bains
    attribute: temperature
    id: device_changed_1_hour_ago
    for:
      hours: 1
      minutes: 0
      seconds: 0
    trigger: state
  - minutes: '0'
    seconds: '0'
    id: tick
    trigger: time_pattern
  - event: start
    id: restart
    trigger: homeassistant
  - entity_id:
    - input_boolean.chauffage_intelligent_de_la_salle_de_bains
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.chauffage_intelligent_de_la_salle_de_bains
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - target_changed
        - device_changed_1_hour_ago
        - restart
      sequence:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{states(''input_number.temperature_cible_chauffage_salle_de_bains'')}}'
        target:
          entity_id: climate.radiateur_salle_de_bains
    - conditions:
      - condition: trigger
        id:
        - tick
      sequence:
      - if:
        - condition: template
          value_template: '{{states(''input_number.temperature_cible_chauffage_salle_de_bains'')|float(0)
            == state_attr(''climate.radiateur_salle_de_bains'',''temperature'') }}'
        then:
        - action: climate.set_temperature
          metadata: {}
          data:
            temperature: '{{states(''input_number.temperature_cible_chauffage_salle_de_bains'')}}'
          target:
            entity_id: climate.radiateur_salle_de_bains
  mode: queued
  max: 10
- id: '1728584851841'
  alias: Chauffage Intelligent - Régler Température Salle De Douche
  description: ''
  triggers:
  - entity_id:
    - input_number.temperature_cible_chauffage_salle_de_douche
    id: target_changed
    trigger: state
  - entity_id:
    - climate.radiateur_salle_de_douche
    attribute: temperature
    id: device_changed_1_hour_ago
    for:
      hours: 1
      minutes: 0
      seconds: 0
    trigger: state
  - minutes: '0'
    seconds: '0'
    id: tick
    trigger: time_pattern
  - event: start
    id: restart
    trigger: homeassistant
  - entity_id:
    - input_boolean.chauffage_intelligent_de_la_salle_de_douche
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.chauffage_intelligent_de_la_salle_de_douche
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - target_changed
        - device_changed_1_hour_ago
        - restart
      sequence:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{states(''input_number.temperature_cible_chauffage_salle_de_douche'')}}'
        target:
          entity_id: climate.radiateur_salle_de_douche
    - conditions:
      - condition: trigger
        id:
        - tick
      sequence:
      - if:
        - condition: template
          value_template: '{{states(''input_number.temperature_cible_chauffage_salle_de_douche'')|float(0)
            == state_attr(''climate.radiateur_salle_de_douche'',''temperature'') }}'
        then:
        - action: climate.set_temperature
          metadata: {}
          data:
            temperature: '{{states(''input_number.temperature_cible_chauffage_salle_de_douche'')}}'
          target:
            entity_id: climate.radiateur_salle_de_douche
  mode: queued
  max: 10
- id: '1729016436406'
  alias: 'Voicekit Rez-de-Chaussée - Afficher corvées '
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.corvees
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: state
    entity_id:
    - input_boolean.mode_cinema
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state: Occupée
    - condition: state
      entity_id: input_boolean.mode_cinema
      state: 'off'
    - condition: state
      entity_id: input_boolean.mode_sommeil
      state: 'off'
    then:
    - if:
      - condition: state
        entity_id: binary_sensor.corvees
        state: 'on'
      then:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 66
          rgb_color:
          - 255
          - 176
          - 140
        target:
          entity_id: light.vpe_salon_led_ring
      else:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 50
          rgb_color:
          - 209
          - 229
          - 255
        target:
          entity_id: light.vpe_salon_led_ring
    else:
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - light.vpe_salon_led_ring
  mode: queued
  max: 10
- id: '1729028729486'
  alias: 'Assist - Poubelles sorties par la voix '
  description: ''
  triggers:
  - trigger: conversation
    command:
    - '[La] Poubelle [est] sortie'
    - '[Les] Poubelles [sont] sorties'
    - J'ai sorti la poubelle
    - J'ai sorti les poubelles
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.poubelle_noire_a_sortir
        state: 'on'
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.poubelle_noire_a_sortir
      - set_conversation_response: C'est noté
    - conditions:
      - condition: state
        entity_id: input_boolean.poubelle_verte_a_sortir
        state: 'on'
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.poubelle_verte_a_sortir
      - set_conversation_response: C'est noté
    default:
    - set_conversation_response: 'Aucune poubelle n''est actuellement à sortir. '
  mode: single
- id: '1729029546444'
  alias: Assist - Litière nettoyée par la voix
  description: ''
  triggers:
  - trigger: conversation
    command:
    - '[La] litière [est] nettoyée'
    - J'ai nettoyé la litière
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: counter.passages_litiere
        above: 0
      sequence:
      - action: counter.reset
        metadata: {}
        data: {}
        target:
          entity_id: counter.passages_litiere
      - set_conversation_response: C'est noté
    default:
    - set_conversation_response: La litière est déja propre
  mode: single
- id: '1729029879020'
  alias: Assist - Courrier relevé par la voix
  description: ''
  triggers:
  - trigger: conversation
    command:
    - '[Le] courrier [est] récupéré'
    - Le courrier a été récupéré
    - J'ai récupéré le courrier
    - J'ai été récupérer le courrier
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.courrier_a_relever
        state: 'on'
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - input_boolean.courrier_a_relever
      - set_conversation_response: C'est noté
    default:
    - set_conversation_response: La boite aux lettres était déjà vide
  mode: single
- id: '1729586042273'
  alias: Mode Sommeil - Bascule par VoiceKit Chambre
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.vpe_chambre_button_press
    not_from:
    - unavailable
  conditions:
  - condition: state
    entity_id: event.vpe_chambre_button_press
    attribute: event_type
    state: long_press
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'off'
      sequence:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.mode_sommeil
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: Mode Sommeil Activé. {% if is_state('binary_sensor.reveil_demain','on')
            -%} Réveil prévu pour {{states('input_datetime.wake_up_time')}} {% else
            -%} Pas de réveil prévu pour demain {%- endif -%}
          preannounce: false
        target:
          entity_id: assist_satellite.vpe_chambre_satellite_assist
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'on'
      sequence:
      - action: input_boolean.turn_off
        target:
          entity_id:
          - input_boolean.mode_sommeil
        data: {}
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: "Mode Sommeil désactivé. \n{% if is_state('input_select.etat_machine_a_laver','À
            vider')%}\nN'oublie pas de vider la machine à laver.\n{% endif %}\nBonne
            journée."
          preannounce: false
        target:
          entity_id:
          - assist_satellite.vpe_chambre_satellite_assist
  mode: single
- id: '1729586824286'
  alias: Mode Sommeil - Actions
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'off'
      sequence:
      - if:
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'off'
        then:
        - action: light.turn_on
          metadata: {}
          data:
            brightness_pct: 10
          target:
            area_id:
            - couloir
          enabled: true
        - action: cover.open_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.volets_salon
          enabled: true
        - if:
          - condition: state
            entity_id: binary_sensor.exterieur_lumineux
            state: 'off'
          then:
          - action: light.turn_on
            metadata: {}
            data:
              brightness_pct: 10
            target:
              area_id:
              - cuisine
              - salon
            enabled: true
          enabled: true
      - action: media_player.media_pause
        metadata: {}
        data: {}
        target:
          entity_id:
          - media_player.vpe_chambre_music_assistant
      - if:
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_fenetre_chambre
          state: 'off'
        then:
        - action: cover.open_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideau_chambre
          enabled: true
        - if:
          - condition: state
            entity_id: binary_sensor.exterieur_lumineux
            state: 'on'
          then:
          - action: light.turn_off
            metadata: {}
            data:
              transition: 15
            target:
              area_id: chambre
            enabled: true
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'on'
      sequence:
      - if:
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'off'
        then:
        - action: cover.close_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.volets_salon
          enabled: true
        - action: script.eteindre_tous_les_lecteur_multimedia
          metadata: {}
          data: {}
          enabled: true
        - action: light.turn_off
          metadata: {}
          data: {}
          target:
            floor_id:
            - rez_de_chaussee
            - premier_etage
            area_id: exterieur
          enabled: true
        - if:
          - condition: state
            entity_id: binary_sensor.capteur_ouverture_porte_entree
            state: 'off'
          then:
          - action: lock.lock
            metadata: {}
            data: {}
            target:
              entity_id: lock.serrure_porte_d_entree
            enabled: true
          else:
          - action: script.turn_on
            metadata: {}
            data: {}
            target:
              entity_id: script.power_notification_porte_d_entree_ouverte_lors_du_coucher
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          area_id: chambre
        enabled: true
      - action: media_player.media_pause
        metadata: {}
        data: {}
        target:
          entity_id: media_player.vpe_chambre_music_assistant
      - if:
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_fenetre_chambre
          state: 'off'
        then:
        - action: cover.close_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideau_chambre
          enabled: true
  mode: single
- id: '1730275787349'
  alias: Chauffage Intelligent - Choisir Temperature Cible Bureau
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_bureau
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_bureau_absent
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_bureau_present
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_fenetres_ouvertes
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_bureau
        state: Présent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_bureau_present'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_bureau
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_bureau
        state: Absent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_bureau_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_bureau
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_bureau
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_fenetres_ouvertes'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_bureau
  mode: queued
  max: 10
- id: '1730275937269'
  alias: Chauffage Intelligent - Choisir Temperature Cible Chambre Marilou
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_chambre_marilou
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_chambre_marilou_absent
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_chambre_marilou_present
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_fenetres_ouvertes
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre_marilou
        state: Présent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_chambre_marilou_present'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_chambre_marilou
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre_marilou
        state: Absent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_chambre_marilou_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_chambre_marilou
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre_marilou
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_fenetres_ouvertes'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_chambre_marilou
  mode: queued
  max: 10
- id: '1730275992160'
  alias: Chauffage Intelligent - Choisir Temperature Cible Chambre
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_chambre
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_chambre_absent
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_chambre_present
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_fenetres_ouvertes
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre
        state: Présent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_chambre_present'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_chambre
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre
        state: Absent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_chambre_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_chambre
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_fenetres_ouvertes'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_chambre
  mode: queued
  max: 10
- id: '1730276011770'
  alias: Chauffage Intelligent - Choisir Temperature Cible Rez-De-Chaussée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_rez_de_chaussee
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_rez_de_chaussee_absent
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_rez_de_chaussee_present
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_fenetres_ouvertes
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_rez_de_chaussee
        state: Présent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_rez_de_chaussee_present'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_rez_de_chaussee
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_rez_de_chaussee
        state: Absent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_rez_de_chaussee_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_rez_de_chaussee
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_rez_de_chaussee
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_fenetres_ouvertes'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_rez_de_chaussee
  mode: queued
  max: 10
- id: '1730276096280'
  alias: Chauffage Intelligent - Choisir Temperature Cible Salle De Bains
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_salle_de_bains
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_salle_de_bains_boost
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_salle_de_bains_normal
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_fenetres_ouvertes
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_salle_de_bains
        state: Normal
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_salle_de_bains_normal'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_salle_de_bains
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_salle_de_bains
        state: Boost
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_salle_de_bains_boost'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_salle_de_bains
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_salle_de_bains
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_fenetres_ouvertes'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_salle_de_bains
  mode: queued
  max: 10
- id: '1730276134273'
  alias: Chauffage Intelligent - Choisir Temperature Cible Salle De Douche
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_salle_de_douche
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_salle_de_douche_boost
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_salle_de_douche_normal
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_salle_de_douche
        state: Normal
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_salle_de_douche_normal'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_salle_de_douche
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_salle_de_douche
        state: Boost
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_salle_de_douche_boost'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_salle_de_douche
  mode: queued
  max: 10
- id: '1730752664557'
  alias: VPE RdC - Allumer / Éteindre automatiquement
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.presence_rez_de_chaussee
    to: 'on'
    trigger: state
  - trigger: state
    entity_id:
    - binary_sensor.presence_rez_de_chaussee
    to: 'off'
    for:
      hours: 0
      minutes: 15
      seconds: 0
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: homeassistant
    event: start
  - trigger: state
    entity_id:
    - input_boolean.mode_cinema
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: input_select.modes_de_presence_de_la_maison_v2
          state: Vide
      - condition: state
        entity_id: binary_sensor.presence_rez_de_chaussee
        state: 'on'
      - condition: state
        entity_id: input_boolean.mode_cinema
        state: 'off'
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - switch.micros_rez_de_chaussee
    default:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - switch.micros_rez_de_chaussee
  mode: single
- id: '1730753017143'
  alias: VoiceKit Chambre - Controller Volume
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil_marilou
    for:
      hours: 0
      minutes: 0
      seconds: 10
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'on'
      sequence:
      - action: media_player.volume_set
        metadata: {}
        data:
          volume_level: 0.2
        target:
          entity_id: media_player.vpe_chambre_media_player
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'on'
      sequence:
      - action: media_player.volume_set
        metadata: {}
        data:
          volume_level: 0.4
        target:
          entity_id: media_player.vpe_chambre_media_player
    default:
    - action: media_player.volume_set
      metadata: {}
      data:
        volume_level: 0.8
      target:
        entity_id: media_player.vpe_chambre_media_player
  mode: single
- id: '1731176393383'
  alias: VPE Chambre - Allumer / Éteindre automatiquement
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_chambre_occupancy
    to: 'on'
    trigger: state
  - trigger: state
    entity_id:
    - binary_sensor.capteur_presence_chambre_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: homeassistant
    event: start
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: input_select.modes_de_presence_de_la_maison_v2
          state: Vide
      - condition: state
        entity_id: binary_sensor.capteur_presence_chambre_occupancy
        state: 'on'
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - switch.vpe_chambre_microphone
    default:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - switch.vpe_chambre_microphone
  mode: single
- id: '1731176431172'
  alias: VPE Chambre Marilou - Allumer / Éteindre automatiquement
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_chambre_marilou_occupancy
    to: 'on'
    trigger: state
  - trigger: state
    entity_id:
    - binary_sensor.capteur_presence_chambre_marilou_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: homeassistant
    event: start
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: input_select.modes_de_presence_de_la_maison_v2
          state: Vide
      - condition: state
        entity_id: binary_sensor.capteur_presence_chambre_marilou_occupancy
        state: 'on'
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - switch.vpe_chambre_marilou_microphone
    default:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - switch.vpe_chambre_marilou_microphone
  mode: single
- id: '1731176473847'
  alias: VPE Bureau - Allumer / Éteindre automatiquement
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_bureau_occupancy
    to: 'on'
    trigger: state
  - trigger: state
    entity_id:
    - binary_sensor.capteur_presence_bureau_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: homeassistant
    event: start
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: input_select.modes_de_presence_de_la_maison_v2
          state: Vide
      - condition: state
        entity_id: binary_sensor.capteur_presence_bureau_occupancy
        state: 'on'
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - switch.vpe_bureau_microphone
    default:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - switch.vpe_bureau_microphone
  mode: single
- id: '1731706815901'
  alias: Réduire volume lorsque assistant vocal en écoute (Bureau)
  description: ''
  use_blueprint:
    path: perso/reduce_volume_of_media_player_when_voice_assistant_listening_v2.yaml
    input:
      assist_satellite_entity: assist_satellite.vpe_bureau_satellite_assist
      custom_target:
        entity_id: media_player.sonos_bureau_music_assistant
- id: '1731706885951'
  alias: Réduire volume lorsque assistant vocal en écoute (Cuisine)
  description: ''
  use_blueprint:
    path: perso/reduce_volume_of_media_player_when_voice_assistant_listening_v2.yaml
    input:
      assist_satellite_entity: assist_satellite.vpe_cuisine_satellite_assist
      custom_target:
        entity_id: media_player.sonos_amp_music_assistant
- id: '1731706904863'
  alias: Réduire volume lorsque assistant vocal en écoute (Salon)
  description: ''
  use_blueprint:
    path: perso/reduce_volume_of_media_player_when_voice_assistant_listening_v2.yaml
    input:
      assist_satellite_entity: assist_satellite.vpe_salon_satellite_assist
      custom_target:
        entity_id: media_player.sonos_amp_music_assistant
- id: '1731762231230'
  alias: VPE - Transferer la musique
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.vpe_salon_button_press
    - event.vpe_bureau_button_press
    - event.vpe_chambre_button_press
    - event.vpe_cuisine_button_press
    - event.vpe_chambre_marilou_button_press
    - event.vpe_dvt_salle_de_douche_button_press
    not_from:
    - unavailable
  conditions:
  - condition: template
    value_template: '{{trigger.to_state.attributes.event_type == ''double_press''}}'
    alias: It's a double press
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - variables:
      player: "{% set room_audio_players = label_entities('Lecteur audio de la pièce')
        %}\n{% for player in room_audio_players %}\n  {% if area_id(player) == area_id(trigger.entity_id)
        %}\n    {{player}}\n  {% endif %}\n{% endfor %}\n"
    enabled: true
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.lecteurs_music_assistant_en_lecture
        state: 'on'
      sequence:
      - action: music_assistant.transfer_queue
        metadata: {}
        data: {}
        target:
          entity_id: '{{player}}'
    default:
    - action: music_assistant.play_media
      target:
        entity_id: '{{player}}'
      data:
        media_id: All Favorited Tracks
        media_type: playlist
        enqueue: replace
    enabled: true
  - alias: Fallback in case audio does not start
    sequence:
    - delay:
        hours: 0
        minutes: 0
        seconds: 10
        milliseconds: 0
    - if:
      - condition: template
        value_template: '{{ states(player) != ''playing'' }}'
      then:
      - action: media_player.media_play
        metadata: {}
        data: {}
        target:
          entity_id: '{{player}}'
      - delay:
          hours: 0
          minutes: 0
          seconds: 10
          milliseconds: 0
      - if:
        - condition: template
          value_template: '{{ states(player) != ''playing'' }}'
        then:
        - action: media_player.media_next_track
          metadata: {}
          data: {}
          target:
            entity_id: '{{player}}'
  mode: single
- id: '1731941056494'
  alias: Vacances - Générer texte de bonne fête
  description: ''
  triggers:
  - trigger: calendar
    entity_id: calendar.vacances_france
    event: start
    offset: '-2:0:0'
  conditions: []
  actions:
  - action: ai_task.generate_data
    metadata: {}
    data:
      task_name: Holiday Greeting
      instructions: "Instructions:\nGenerate a text to wish me a happy holiday based
        on an input holiday.\nMy Name is JLo.\nKeep the text short.\nKeep everyhing
        in French.\nAdd an emoji at the start.\n\nInput: \n{{trigger.calendar_event.summary}}"
      entity_id: ai_task.openai_ai_task
      structure:
        greeting:
          selector:
            text:
    response_variable: ai_response
  - action: input_text.set_value
    metadata: {}
    data:
      value: '{{ai_response.data.greeting}}'
    target:
      entity_id: input_text.holiday_greeting
  mode: single
- id: '1732054434382'
  alias: Mode Cinéma - Activer
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - media_player.apple_tv_salon
    to: playing
    id: tv
    for:
      seconds: 1
  - trigger: state
    entity_id:
    - binary_sensor.is_ps5_used
    to: 'on'
    id: ps5
    for:
      hours: 0
      minutes: 0
      seconds: 1
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - tv
      sequence:
      - variables:
          supported_apps: '{{["Netflix", "Plex", "Prime Video"]}}'
      - condition: template
        value_template: '{{ trigger.to_state.attributes.app_name in supported_apps
          }}'
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.mode_cinema
    - conditions:
      - condition: trigger
        id:
        - ps5
      sequence:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.mode_cinema
  mode: restart
- id: '1732054630408'
  alias: Mode Cinéma - Désactiver
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - media_player.apple_tv_salon
    to:
    - 'off'
    - 'on'
    - idle
    - standby
  - trigger: homeassistant
    event: start
  - trigger: state
    entity_id:
    - media_player.apple_tv_salon
    attribute: app_name
    from:
    - Netflix
    - Plex
    - Prime Video
  - trigger: state
    entity_id:
    - binary_sensor.is_ps5_used
    to: 'off'
  conditions: []
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.mode_cinema
  mode: queued
  max: 10
- id: '1732055799796'
  alias: Mode Cinéma - Controller Lumières et Volets
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_cinema
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_boolean.automation_watch_tv
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: state
    entity_id: binary_sensor.presence_rez_de_chaussee
    state: 'on'
  actions:
  - action: scene.create
    metadata: {}
    data:
      scene_id: dynamic_scene_before_movie_mode
      snapshot_entities:
      - light.cuisine_suspension
      - light.cuisine_comptoir
      - light.salon_trepied
      - light.hue_aurelle_panel_1
      - light.salon_suspension_tv
      - light.salon_buffet_droit
      - light.salon_buffet_gauche
      - light.entree_suspension
      - light.exterieur_sphere
      - light.exterieur_guinguette
      - light.plafonnier_exterieur
      - light.couloir_applique_escalier
      - cover.volets_salon
      - light.hue_white_candle_2
      - light.hue_white_candle_1
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - light.couloir_applique_escalier
      area_id: exterieur
      floor_id: rez_de_chaussee
  - action: hue.activate_scene
    target:
      entity_id: scene.salon_salon_tv_playing
    data: {}
  - if:
    - condition: state
      entity_id: binary_sensor.exterieur_lumineux
      state: 'on'
    then:
    - action: cover.close_cover
      metadata: {}
      data: {}
      target:
        entity_id: cover.volets_salon
  - if:
    - condition: state
      entity_id: input_boolean.mode_cinema
      state: 'on'
    then:
    - wait_for_trigger:
      - trigger: state
        entity_id:
        - input_boolean.mode_cinema
        to: 'off'
      continue_on_timeout: false
  - action: scene.turn_on
    data: {}
    target:
      entity_id: scene.dynamic_scene_before_movie_mode
  - action: scene.delete
    metadata: {}
    data: {}
    target:
      entity_id: scene.dynamic_scene_before_movie_mode
  mode: restart
- id: '1732056960522'
  alias: Mode Cinéma - Play / Pause
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - media_player.apple_tv_salon
    to: paused
    id: paused
  - trigger: state
    entity_id:
    - media_player.apple_tv_salon
    to: playing
    id: playing
  conditions:
  - condition: state
    entity_id: input_boolean.automation_watch_tv
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: state
    entity_id: input_boolean.mode_cinema
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: state
    entity_id: binary_sensor.presence_rez_de_chaussee
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - paused
      sequence:
      - action: hue.activate_scene
        metadata: {}
        data: {}
        target:
          entity_id:
          - scene.salon_salon_tv_paused
          - scene.entree_entree_tv_paused
          - scene.cuisine_cuisine_tv_paused
    - conditions:
      - condition: trigger
        id:
        - playing
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.couloir_applique_escalier
          area_id: exterieur
          floor_id: rez_de_chaussee
      - action: hue.activate_scene
        target:
          entity_id: scene.salon_salon_tv_playing
        data: {}
  mode: restart
- id: '1734703658294'
  alias: Réduire volume lorsque assistant vocal en écoute (Salle de Douche)
  description: ''
  use_blueprint:
    path: perso/reduce_volume_of_media_player_when_voice_assistant_listening_v2.yaml
    input:
      assist_satellite_entity: assist_satellite.vpe_dvt_salle_de_douche_satellite_assist
      custom_target:
        entity_id: media_player.sonos_salle_de_douche_music_assistant
- id: '1736027398142'
  alias: Jouer de la Musique par la Voix (Music Assistant)
  description: Cette automatisation permet de jouer de la musique en utilisant des
    commandes vocales, en fonction de l'artiste, de l'album ou de la piste spécifiés.
    Les utilisateurs peuvent simplement demander à écouter leur musique préférée depuis
    n'importe quel appareil compatible.
  triggers:
  - command:
    - (Jouer|Joue|Écouter|Écoutez|Ecouter|Ecoutez) {query}
    trigger: conversation
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{ trigger.device_id != None}}'
    then:
    - action: script.jouer_de_la_musique_music_assistant
      metadata: {}
      data:
        query: '{{trigger.slots.query}}'
        area: '{{area_id(trigger.device_id)}}'
      response_variable: media_data
    - set_conversation_response: '{% if media_data.media_type == ''artist'' %}

        Lecture de l''artiste {{media_data.media_id}}

        {% elif media_data.media_type == ''album'' %}

        Lecture de l''album {{media_data.media_id}} {% if ''artist'' in media_data
        %} par {{media_data.artist}} {% endif %}

        {% elif media_data.media_type == ''track'' %}

        Lecture de {{media_data.media_id}} {% if ''artist'' in media_data %} par {{media_data.artist}}
        {% endif %}

        {% endif %}'
    else:
    - set_conversation_response: Cette commande ne fonctionne pas depuis cet appareil
      enabled: true
  mode: single
- id: '1736352269100'
  alias: End of the World
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sun.sun
    to: unavailable
  conditions: []
  actions:
  - action: notify.mobile_app_jean_loics_iphone
    metadata: {}
    data:
      title: Well.
      message: Fuck.
  mode: single
- id: '1736868943182'
  alias: Éteindre Rez-de-Chaussée si plus de présence
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.presence_rez_de_chaussee
    to: 'off'
    for:
      hours: 0
      minutes: 30
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      floor_id: rez_de_chaussee
  - action: media_player.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: media_player.apple_tv_salon
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id:
      - media_player.sonos_amp_music_assistant
  mode: single
- id: '1737233418257'
  alias: Boost Salle de Bain - Activer par le VPE
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.vpe_dvt_salle_de_douche_button_press
    not_from:
    - unavailable
    not_to:
    - unavailable
    - unknown
  conditions:
  - condition: state
    entity_id: event.vpe_dvt_salle_de_douche_button_press
    attribute: event_type
    state: long_press
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: state
        state: 'off'
        entity_id: input_boolean.chauffage_salle_de_douche_boost
      sequence:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.chauffage_salle_de_douche_boost
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: Boost Chauffage Activé
          preannounce: false
        target:
          entity_id: assist_satellite.vpe_dvt_salle_de_douche_satellite_assist
    - conditions:
      - condition: state
        state: 'on'
        entity_id: input_boolean.chauffage_salle_de_douche_boost
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.chauffage_salle_de_douche_boost
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: Boost Chauffage Désactivé
          preannounce: false
        target:
          entity_id: assist_satellite.vpe_dvt_salle_de_douche_satellite_assist
  mode: single
- id: '1737975480794'
  alias: Rappels - Notifier rappel calendrier
  description: ''
  triggers:
  - trigger: calendar
    entity_id: calendar.rappels
    event: start
    offset: 0:0:0
  conditions: []
  actions:
  - action: script.power_notification_rappel
    metadata: {}
    data:
      user_message: '{{trigger.calendar_event.summary}}'
  mode: single
- id: '1737976480635'
  alias: Rappels - Notifier rappel maison vide
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Départ en cours
  conditions:
  - condition: numeric_state
    entity_id: todo.rappels_maison_vide
    above: 0
  actions:
  - action: todo.get_items
    target:
      entity_id: todo.rappels_maison_vide
    data:
      status: needs_action
    metadata: {}
    response_variable: reminders
  - variables:
      reminder_list: "[\n{% for item in reminders['todo.rappels_maison_vide'][\"items\"]
        %}\n  \"{{item.summary}}\",\n{% endfor %}\n]\n"
  - repeat:
      sequence:
      - action: script.power_notification_rappel_maison_vide
        metadata: {}
        data:
          user_message: '{{repeat.item}}'
      for_each: '{{reminder_list}}'
  mode: single
- id: '1737976815103'
  alias: Rappels - Notifier rappel maison occupée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Arrivée en cours
  conditions:
  - condition: numeric_state
    entity_id: todo.rappels_maison_occupee
    above: 0
  actions:
  - action: todo.get_items
    target:
      entity_id:
      - todo.rappels_maison_occupee
    data:
      status: needs_action
    metadata: {}
    response_variable: reminders
  - variables:
      reminder_list: "[\n{% for item in reminders['todo.rappels_maison_occupee'][\"items\"]
        %}\n  \"{{item.summary}}\",\n{% endfor %}\n]\n"
  - repeat:
      sequence:
      - action: script.power_notification_rappel_maison_occupee
        metadata: {}
        data:
          user_message: '{{repeat.item}}'
      for_each: '{{reminder_list}}'
  mode: single
- id: '1738676615343'
  alias: Bureau - Notification Lumineuse Qualité de l'air
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.qualite_de_l_air_bureau
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: state
    entity_id: binary_sensor.capteur_presence_bureau_occupancy
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: state
    entity_id: input_boolean.mode_sommeil
    state: 'off'
  actions:
  - action: scene.create
    data:
      scene_id: dynamic_scene_before_bad_air_notification
      snapshot_entities:
      - light.hue_play_bars
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - action: light.turn_on
    metadata: {}
    data:
      rgb_color:
      - 255
      - 0
      - 0
      brightness_pct: 100
    target:
      entity_id: light.hue_play_bars
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - action: scene.turn_on
    data: {}
    target:
      entity_id: scene.dynamic_scene_before_bad_air_notification
  - action: scene.delete
    metadata: {}
    data: {}
    target:
      entity_id: scene.dynamic_scene_before_bad_air_notification
  mode: single
- id: '1739568563693'
  alias: Assist - Assistant de secours lors d'une panne d'internet
  description: Cette automatisation sélectionne un assistant local lors d'une panne
    d'internet et revient à l'assistant préféré une fois la connexion rétablie. Elle
    permet de maintenir les commandes vocales fonctionnelles même lors de coupures
    de réseau.
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.internet
    from: 'on'
    to: 'off'
    id: no_internet
  - trigger: state
    entity_id:
    - binary_sensor.internet
    from: 'off'
    to: 'on'
    id: internet
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - no_internet
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: Local
        target:
          label_id: choix_d_assistant
    - conditions:
      - condition: trigger
        id:
        - internet
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: preferred
        target:
          label_id: choix_d_assistant
  mode: single
- id: '1740752651459'
  alias: Mode Sommeil Marilou - Activer par VPE
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.vpe_chambre_marilou_button_press
    not_from:
    - unavailable
  conditions:
  - condition: state
    entity_id: event.vpe_chambre_marilou_button_press
    state: long_press
    attribute: event_type
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'off'
      sequence:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.mode_sommeil_marilou
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: Bonne nuit Marilou!
          preannounce: false
        target:
          entity_id: assist_satellite.vpe_chambre_marilou_satellite_assist
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'on'
      sequence:
      - action: input_boolean.turn_off
        target:
          entity_id:
          - input_boolean.mode_sommeil_marilou
        data: {}
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: Bonjour Marilou!
          preannounce: false
        target:
          entity_id:
          - assist_satellite.vpe_chambre_marilou_satellite_assist
  mode: single
- id: '1740752921943'
  alias: Mode Sommeil Marilou - Actions
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil_marilou
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'on'
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          area_id: couloir
      - action: scene.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: scene.scenes_hue_chambre_marilou_lecture
      - if:
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_fenetre_chambre_bebe
          state: 'off'
        then:
        - action: cover.close_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideau_chambre_marilou
          enabled: true
      - action: script.start_marilou_bedtime_routine
        metadata: {}
        data: {}
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          area_id: chambre_bebe
      - action: media_player.media_pause
        data: {}
        target:
          entity_id:
          - media_player.vpe_chambre_marilou_music_assistant
      - if:
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_fenetre_chambre_bebe
          state: 'off'
        then:
        - action: cover.open_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideau_chambre_marilou
          enabled: true
      - if:
        - condition: state
          entity_id: binary_sensor.exterieur_lumineux
          state: 'off'
        then:
        - action: scene.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: scene.scenes_hue_chambre_marilou_lecture
  mode: single
- id: '1740753985952'
  alias: VoiceKit Chambre Marilou - Controller Volume
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil_marilou
    for:
      hours: 0
      minutes: 0
      seconds: 10
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'on'
      sequence:
      - action: media_player.volume_set
        metadata: {}
        data:
          volume_level: 0.1
        target:
          entity_id: media_player.vpe_chambre_marilou_media_player
    default:
    - action: media_player.volume_set
      metadata: {}
      data:
        volume_level: 0.6
      target:
        entity_id: media_player.vpe_chambre_marilou_media_player
  mode: single
- id: '1741603027915'
  alias: Mode Chien - Actions
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_chien
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: state
    entity_id:
    - input_boolean.guest_mode
  - trigger: state
    entity_id:
    - input_boolean.automation_presence_simulator
  - trigger: state
    entity_id:
    - binary_sensor.exterieur_lumineux
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Vide
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: state
    entity_id: input_boolean.automation_presence_simulator
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_chien
        state: 'on'
      sequence:
      - if:
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_fenetre_bureau
          state: 'off'
        then:
        - action: cover.open_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideau_bureau
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          floor_id:
          - rez_de_chaussee
          - premier_etage
          area_id: exterieur
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.exterieur_lumineux
            state: 'on'
          sequence:
          - action: cover.set_cover_position
            metadata: {}
            data:
              position: 30
            target:
              entity_id: cover.volets_salon
        - conditions:
          - condition: state
            entity_id: binary_sensor.exterieur_lumineux
            state: 'off'
          sequence:
          - action: light.turn_on
            metadata: {}
            data:
              brightness_pct: 15
            target:
              area_id:
              - cuisine
              - salon
              - entree
              entity_id: light.bureau_suspension
          - action: cover.close_cover
            metadata: {}
            data: {}
            target:
              entity_id: cover.volets_salon
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_chien
        state: 'off'
      sequence:
      - action: script.leave_home
        metadata: {}
        data: {}
  mode: single
- id: '1741603540670'
  alias: Mode chien - Désactiver lors du retour a la maison
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Occupée
  conditions: []
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.mode_chien
  mode: single
- id: '1741604729527'
  alias: Sonnette vidéo - Contrôler le volume avec les modes sommeil
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil_marilou
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - if:
    - condition: or
      conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'on'
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'on'
    then:
    - action: number.set_value
      metadata: {}
      data:
        value: '0'
      target:
        entity_id: number.carillon_entree_volume
    - action: number.set_value
      metadata: {}
      data:
        value: '50'
      target:
        entity_id: number.sonnette_volume
    else:
    - action: number.set_value
      metadata: {}
      data:
        value: '4'
      target:
        entity_id: number.carillon_entree_volume
    - action: number.set_value
      metadata: {}
      data:
        value: '100'
      target:
        entity_id: number.sonnette_volume
  mode: single
- id: '1742072094434'
  alias: VPE Douche - Affichage Boost Chauffage
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.chauffage_salle_de_douche_boost
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.chauffage_salle_de_douche_boost
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.vpe_dvt_salle_de_douche_led_ring
    - conditions:
      - condition: state
        entity_id: input_boolean.chauffage_salle_de_douche_boost
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.vpe_dvt_salle_de_douche_led_ring
  mode: single
- id: '1742996542028'
  alias: Serrure - Notifier si porte ouverte et serrure vérouillée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - lock.serrure_porte_d_entree
    to: locked
  conditions:
  - condition: state
    entity_id: binary_sensor.capteur_ouverture_porte_entree
    state: 'on'
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_serrure_verouillee_sur_porte_ouverte
  mode: single
- id: '1744746499776'
  alias: Slack Status
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.face_du_cube
    id: cube_change
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - cube_change
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: input_select.face_du_cube
            state: Pause repas
          sequence:
          - action: slack_user.set_status
            metadata: {}
            data:
              entity_id: sensor.jlo_slack
              status_text: Lunch Break
              status_emoji: ':hamburger:'
          - action: slack_user.set_presence
            metadata: {}
            data:
              presence: away
              entity_id: sensor.jlo_slack
          - action: slack_user.set_dnd
            metadata: {}
            data:
              entity_id: sensor.jlo_slack
              num_minutes: 120
          - action: assist_satellite.announce
            metadata: {}
            data:
              preannounce: false
              message: Statut Slack modifié en Pause repas
            target:
              entity_id: assist_satellite.vpe_bureau_satellite_assist
        - conditions:
          - condition: state
            entity_id: input_select.face_du_cube
            state: Absent
          sequence:
          - action: slack_user.set_status
            metadata: {}
            data:
              entity_id: sensor.jlo_slack
              status_text: Away
              status_emoji: ':satellite_antenna:'
          - action: slack_user.set_presence
            metadata: {}
            data:
              presence: away
              entity_id: sensor.jlo_slack
          - action: slack_user.set_dnd
            metadata: {}
            data:
              num_minutes: 4320
              entity_id: sensor.jlo_slack
          - action: assist_satellite.announce
            metadata: {}
            data:
              preannounce: false
              message: Statut Slack modifié en Absent
            target:
              entity_id: assist_satellite.vpe_bureau_satellite_assist
        - conditions:
          - condition: state
            entity_id: input_select.face_du_cube
            state: Ne pas déranger
          sequence:
          - action: slack_user.set_status
            metadata: {}
            data:
              entity_id: sensor.jlo_slack
              status_text: Do Not Disturb
              status_emoji: ':octagonal_sign:'
          - action: slack_user.set_presence
            metadata: {}
            data:
              presence: auto
              entity_id: sensor.jlo_slack
          - action: slack_user.set_dnd
            metadata: {}
            data:
              num_minutes: 60
              entity_id: sensor.jlo_slack
          - action: assist_satellite.announce
            metadata: {}
            data:
              preannounce: false
              message: Statut Slack modifié en Ne pas déranger
            target:
              entity_id: assist_satellite.vpe_bureau_satellite_assist
        - conditions:
          - condition: state
            entity_id: input_select.face_du_cube
            state: Réunion
          sequence:
          - action: slack_user.set_status
            metadata: {}
            data:
              entity_id: sensor.jlo_slack
              status_text: In a meeting
              status_emoji: ':calendar:'
          - action: slack_user.set_presence
            metadata: {}
            data:
              presence: auto
              entity_id: sensor.jlo_slack
          - action: slack_user.set_dnd
            metadata: {}
            data:
              entity_id: sensor.jlo_slack
              num_minutes: 60
          - action: assist_satellite.announce
            metadata: {}
            data:
              preannounce: false
              message: Statut Slack modifié en Réunion
            target:
              entity_id: assist_satellite.vpe_bureau_satellite_assist
        - conditions:
          - condition: state
            entity_id: input_select.face_du_cube
            state: Disponible
          sequence:
          - action: slack_user.set_status
            metadata: {}
            data:
              entity_id: sensor.jlo_slack
              status_text: Available
              status_emoji: ':ha: '
          - action: slack_user.set_presence
            metadata: {}
            data:
              presence: auto
              entity_id: sensor.jlo_slack
          - action: slack_user.end_dnd
            metadata: {}
            data:
              entity_id: sensor.jlo_slack
          - action: assist_satellite.announce
            metadata: {}
            data:
              preannounce: false
              message: Statut Slack modifié en Disponible
            target:
              entity_id: assist_satellite.vpe_bureau_satellite_assist
        - conditions:
          - condition: state
            entity_id: input_select.face_du_cube
            state: Pause café
          sequence:
          - action: slack_user.set_status
            metadata: {}
            data:
              entity_id: sensor.jlo_slack
              status_text: Coffee Break
              status_emoji: ':coffee:'
          - action: slack_user.set_presence
            metadata: {}
            data:
              entity_id: sensor.jlo_slack
              presence: auto
          - action: slack_user.set_dnd
            metadata: {}
            data:
              num_minutes: 15
              entity_id: sensor.jlo_slack
          - action: assist_satellite.announce
            metadata: {}
            data:
              preannounce: false
              message: Statut Slack modifié en Pause café
            target:
              entity_id: assist_satellite.vpe_bureau_satellite_assist
  mode: single
- id: '1745063365367'
  alias: "Serrure - \U0001F514 Notifier déverrouillage non planifié"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - lock.serrure_porte_d_entree
    to: unlocked
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Vide
  actions:
  - action: script.power_notification_serrure_deverrouillee
    metadata: {}
    data: {}
  mode: single
- id: '1745416951501'
  alias: Changer face du cube
  description: ''
  triggers:
  - device_id: 842a8a2fd53d642664eda0fc1b756849
    domain: zha
    type: device_flipped
    subtype: face_1
    trigger: device
    id: eating
  - device_id: 842a8a2fd53d642664eda0fc1b756849
    domain: zha
    type: device_flipped
    subtype: face_2
    trigger: device
    id: away
  - device_id: 842a8a2fd53d642664eda0fc1b756849
    domain: zha
    type: device_flipped
    subtype: face_3
    trigger: device
    id: dnd
  - device_id: 842a8a2fd53d642664eda0fc1b756849
    domain: zha
    type: device_flipped
    subtype: face_4
    trigger: device
    id: meeting
  - device_id: 842a8a2fd53d642664eda0fc1b756849
    domain: zha
    type: device_flipped
    subtype: face_5
    trigger: device
    id: available
  - device_id: 842a8a2fd53d642664eda0fc1b756849
    domain: zha
    type: device_flipped
    subtype: face_6
    trigger: device
    id: coffee
  - device_id: 842a8a2fd53d642664eda0fc1b756849
    domain: zha
    type: device_slid
    subtype: face_1
    trigger: device
    id: eating
  - device_id: 842a8a2fd53d642664eda0fc1b756849
    domain: zha
    type: device_slid
    subtype: face_2
    trigger: device
    id: away
  - device_id: 842a8a2fd53d642664eda0fc1b756849
    domain: zha
    type: device_slid
    subtype: face_3
    trigger: device
    id: dnd
  - device_id: 842a8a2fd53d642664eda0fc1b756849
    domain: zha
    type: device_slid
    subtype: face_4
    trigger: device
    id: meeting
  - device_id: 842a8a2fd53d642664eda0fc1b756849
    domain: zha
    type: device_slid
    subtype: face_5
    trigger: device
    id: available
  - device_id: 842a8a2fd53d642664eda0fc1b756849
    domain: zha
    type: device_slid
    subtype: face_6
    trigger: device
    id: coffee
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - eating
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Pause repas
        target:
          entity_id: input_select.face_du_cube
    - conditions:
      - condition: trigger
        id:
        - away
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Absent
        target:
          entity_id: input_select.face_du_cube
    - conditions:
      - condition: trigger
        id:
        - dnd
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Ne pas déranger
        target:
          entity_id: input_select.face_du_cube
    - conditions:
      - condition: trigger
        id:
        - meeting
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Réunion
        target:
          entity_id: input_select.face_du_cube
    - conditions:
      - condition: trigger
        id:
        - available
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Disponible
        target:
          entity_id: input_select.face_du_cube
    - conditions:
      - condition: trigger
        id:
        - coffee
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Pause café
        target:
          entity_id: input_select.face_du_cube
  mode: single
- id: '1745693675176'
  alias: Machine à laver - Lancer à 1:30
  description: ''
  triggers:
  - trigger: time
    at: 01:30:00
  conditions:
  - condition: state
    entity_id: input_select.etat_machine_a_laver
    state: Plannifiée
  - condition: state
    entity_id: binary_sensor.machine_a_laver_remote_control
    state: 'on'
  actions:
  - action: select.select_option
    metadata: {}
    data:
      option: run
    target:
      entity_id: select.machine_a_laver
  mode: single
- id: '1745693960031'
  alias: "Machine à laver - \U0001F514 Notifier démarrage prévu"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.etat_machine_a_laver
    to: Plannifiée
  conditions: []
  actions:
  - action: script.power_notification_lancement_machine_a_laver_prevu
    metadata: {}
    data: {}
  mode: single
- id: '1745787390051'
  alias: 'Machine à laver - Alimentation écran companion '
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.machine_a_laver_puissance
  - trigger: homeassistant
    event: start
  - trigger: state
    entity_id:
    - input_select.etat_machine_a_laver
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.machine_a_laver_puissance
          state: 'on'
        - condition: not
          conditions:
          - condition: state
            entity_id: input_select.etat_machine_a_laver
            state: Inactive
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.ecran_companion_de_la_machine_a_laver_screen
    default:
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: light.ecran_companion_de_la_machine_a_laver_screen
  mode: single
- id: '1745952054053'
  alias: Mode sommeil Marilou - Bouton
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.hue_dimmer_switch_1_bouton_1
    id: 'on'
  - trigger: state
    entity_id:
    - event.hue_dimmer_switch_1_bouton_2
    id: 'on'
  - trigger: state
    entity_id:
    - event.hue_dimmer_switch_1_bouton_3
    id: 'off'
  - trigger: state
    entity_id:
    - event.hue_dimmer_switch_1_bouton_4
    id: 'off'
  conditions:
  - condition: template
    value_template: '{{trigger.to_state.attributes.event_type in [''initial_press'']}}'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - 'on'
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.mode_sommeil_marilou
    - conditions:
      - condition: trigger
        id:
        - 'off'
      sequence:
      - if:
        - condition: state
          entity_id: input_boolean.mode_sommeil_marilou
          state: 'off'
        then:
        - action: input_boolean.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: input_boolean.mode_sommeil_marilou
        else:
        - action: script.start_marilou_bedtime_routine
          metadata: {}
          data: {}
  mode: single
- id: '1746466029976'
  alias: Appareils personnels - Attacher/Détacher Montre
  description: Cette automatisation attache ou détache le suivi d'appareil pour la
    montre en fonction de son port.
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.montre_portee
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: input_boolean.montre_portee
      state: 'on'
    then:
    - action: person.add_device_tracker
      metadata: {}
      data:
        entity_id: person.jenova70
        device_tracker:
        - device_tracker.jlo_s_apple_watch_bluetooth
    else:
    - action: person.remove_device_tracker
      metadata: {}
      data:
        entity_id: person.jenova70
        device_tracker:
        - device_tracker.jlo_s_apple_watch_bluetooth
  mode: single
- id: '1746466094247'
  alias: Appareils personnels - Attacher/Détacher téléphone
  description: Cette automatisation permet d'attacher ou de détacher le téléphone
    de l'utilisateur lorsque l'état du boolean 'telephone_porte' change. En ajoutant
    les téléphones à la personne, cela permet un suivi précis de leur présence.
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.telephone_porte
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: input_boolean.telephone_porte
      state: 'on'
    then:
    - action: person.add_device_tracker
      metadata: {}
      data:
        entity_id: person.jenova70
        device_tracker:
        - device_tracker.jlo_s_iphone_bluetooth
        - device_tracker.jean_loics_iphone
    else:
    - action: person.remove_device_tracker
      metadata: {}
      data:
        entity_id: person.jenova70
        device_tracker:
        - device_tracker.jlo_s_iphone_bluetooth
        - device_tracker.jean_loics_iphone
  mode: single
- id: '1746466554887'
  alias: "Appareils personnels - \U0001F514 Notifier appareil oublié"
  description: Cette automatisation vérifie si l'iPhone ou la montre est oublié lors
    d'un déplacement. Si l'un est à la maison et l'autre est en dehors, une notification
    est envoyée pour rappeler l'objet laissé derrière.
  triggers:
  - trigger: state
    entity_id:
    - device_tracker.jlo_s_iphone_bluetooth
    - device_tracker.jlo_s_apple_watch_bluetooth
    for:
      hours: 0
      minutes: 15
      seconds: 0
    to:
  conditions:
  - condition: state
    entity_id: input_boolean.telephone_porte
    state: 'on'
  - condition: state
    entity_id: input_boolean.montre_portee
    state: 'on'
  actions:
  - if:
    - condition: state
      entity_id: device_tracker.jlo_s_iphone_bluetooth
      state: home
    - condition: state
      entity_id: device_tracker.jlo_s_apple_watch_bluetooth
      state: not_home
    then:
    - action: script.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: script.power_notification_telephone_oublie
  - if:
    - condition: state
      entity_id: device_tracker.jlo_s_iphone_bluetooth
      state: not_home
    - condition: state
      entity_id: device_tracker.jlo_s_apple_watch_bluetooth
      state: home
    then:
    - action: script.turn_on
      metadata: {}
      data: {}
      target:
        entity_id:
        - script.power_notification_montre_oubliee
  mode: single
- id: '1746467143497'
  alias: Appareils personnels - Réattacher automatiquement
  description: Lorsque l'iPhone ou l'Apple Watch revient à la maison, cette automatisation
    va vérifier si l'appareil est correctement porté. Si ce n'est pas le cas, il réactivera
    l'état de port pour chaque appareil et enverra une notification.
  triggers:
  - trigger: state
    entity_id:
    - device_tracker.jlo_s_iphone_bluetooth
    to: home
    id: phone_back_home
  - trigger: state
    entity_id:
    - device_tracker.jlo_s_apple_watch_bluetooth
    to: home
    id: watch_back_home
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - phone_back_home
    - condition: state
      entity_id: input_boolean.montre_portee
      state: 'off'
    - condition: state
      entity_id: device_tracker.jlo_s_apple_watch_bluetooth
      state: home
    then:
    - action: input_boolean.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: input_boolean.montre_portee
    - action: script.turn_on
      metadata: {}
      data:
        variables:
          user_title: ⌚ Montre
          user_message: Montre réattachée automatiquement
      target:
        entity_id:
        - script.power_notification_appareil_reattache_automatiquement
  - if:
    - condition: trigger
      id:
      - watch_back_home
    - condition: state
      entity_id: input_boolean.telephone_porte
      state: 'off'
    - condition: state
      entity_id: device_tracker.jlo_s_iphone_bluetooth
      state: home
    then:
    - action: input_boolean.turn_on
      metadata: {}
      data: {}
      target:
        entity_id:
        - input_boolean.telephone_porte
    - action: script.turn_on
      metadata: {}
      data:
        variables:
          user_title: "\U0001F4F1 Téléphone"
          user_message: Téléphone réattaché automatiquement
      target:
        entity_id:
        - script.power_notification_appareil_reattache_automatiquement
  mode: single
- id: '1748330056295'
  alias: 'Machine à laver - Essorage par défaut '
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.machine_a_laver_puissance
    to: 'on'
  conditions: []
  actions:
  - action: select.select_option
    metadata: {}
    data:
      option: '1000'
    target:
      entity_id: select.machine_a_laver_spin_level
  mode: single
- id: '1748633499979'
  alias: Guirlande Jardin - Éteindre automatiquement
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.exterieur_lumineux
    from: 'on'
    to: 'off'
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: state
    entity_id: input_boolean.automation_presence_simulator
    state: 'off'
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: light.exterieur_guinguette
  mode: single
- id: '1748838147046'
  alias: "Serrure - \U0001F514 Notifier verrouillage non planifié"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - lock.serrure_porte_d_entree
    to: locked
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Vide
    for:
      hours: 0
      minutes: 1
      seconds: 0
  actions:
  - action: script.power_notification_serrure_verrouillee
    metadata: {}
    data: {}
  mode: single
- id: '1750076179296'
  alias: Climatisation Intelligente - Choisir Temperature Cible Bureau
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_bureau
  - trigger: state
    entity_id:
    - input_number.temperature_cible_climatisation_bureau_absent
  - trigger: state
    entity_id:
    - input_number.temperature_cible_climatisation_bureau_present
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_bureau
        state: Présent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_climatisation_bureau_present'')}}'
        target:
          entity_id: input_number.temperature_cible_climatisation_bureau
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_bureau
        state: Absent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_climatisation_bureau_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_climatisation_bureau
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_bureau
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_climatisation_bureau_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_climatisation_bureau
  mode: queued
  max: 10
- id: '1750076318127'
  alias: Climatisation Intelligente - Choisir Temperature Cible Rez-de-Chaussée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_rez_de_chaussee
  - trigger: state
    entity_id:
    - input_number.temperature_cible_climatisation_rez_de_chaussee_absent
  - trigger: state
    entity_id:
    - input_number.temperature_cible_climatisation_rez_de_chaussee_present
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_rez_de_chaussee
        state: Présent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_climatisation_rez_de_chaussee_present'')}}'
        target:
          entity_id: input_number.temperature_cible_climatisation_rez_de_chaussee
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_rez_de_chaussee
        state: Absent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_climatisation_rez_de_chaussee_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_climatisation_rez_de_chaussee
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_rez_de_chaussee
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_climatisation_rez_de_chaussee_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_climatisation_rez_de_chaussee
  mode: queued
  max: 10
- id: '1750076347458'
  alias: Climatisation Intelligente - Choisir Temperature Cible Chambre
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_chambre
  - trigger: state
    entity_id:
    - input_number.temperature_cible_climatisation_chambre_absent
  - trigger: state
    entity_id:
    - input_number.temperature_cible_climatisation_chambre_present
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre
        state: Présent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_climatisation_chambre_present'')}}'
        target:
          entity_id: input_number.temperature_cible_climatisation_chambre
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre
        state: Absent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_climatisation_chambre_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_climatisation_chambre
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_climatisation_chambre_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_climatisation_chambre
  mode: queued
  max: 10
- id: '1750076377317'
  alias: Climatisation Intelligente - Choisir Temperature Cible Chambre Marilou
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_chambre_marilou
  - trigger: state
    entity_id:
    - input_number.temperature_cible_climatisation_chambre_marilou_absent
  - trigger: state
    entity_id:
    - input_number.temperature_cible_climatisation_chambre_marilou_present
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre_marilou
        state: Présent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_climatisation_chambre_marilou_present'')}}'
        target:
          entity_id: input_number.temperature_cible_climatisation_chambre_marilou
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre_marilou
        state: Absent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_climatisation_chambre_marilou_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_climatisation_chambre_marilou
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre_marilou
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_climatisation_chambre_marilou_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_climatisation_chambre_marilou
  mode: queued
  max: 10
- id: '1750080067995'
  alias: Climatisation Intelligente - Bureau
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.climatisation_bureau_autorisee
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_bureau
  - trigger: state
    entity_id:
    - input_number.temperature_cible_climatisation_bureau
  - trigger: state
    entity_id:
    - input_select.mode_climatisation_intelligente
  - trigger: homeassistant
    event: start
  - trigger: state
    entity_id:
    - input_boolean.climatisation_intelligent_du_bureau
  conditions:
  - condition: state
    entity_id: input_boolean.climatisation_intelligent_du_bureau
    state: 'on'
  actions:
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - if:
    - condition: state
      entity_id: binary_sensor.climatisation_bureau_autorisee
      state: 'on'
    then:
    - choose:
      - conditions:
        - condition: state
          entity_id: input_select.mode_climatisation_intelligente
          state: Froid
        sequence:
        - if:
          - condition: not
            conditions:
            - condition: state
              entity_id: climate.climatisation_bureau
              state: cool
          then:
          - action: climate.set_hvac_mode
            metadata: {}
            data:
              hvac_mode: cool
            target:
              entity_id: climate.climatisation_bureau
          - delay:
              hours: 0
              minutes: 0
              seconds: 1
              milliseconds: 0
        - if:
          - condition: template
            value_template: '{{states(''input_number.temperature_cible_climatisation_bureau'')
              | float(0) != state_attr(''climate.climatisation_bureau'',''temperature'')
              | float(0)}}'
          then:
          - action: climate.set_temperature
            metadata: {}
            data:
              temperature: '{{states(''input_number.temperature_cible_climatisation_bureau'')}}'
            target:
              entity_id: climate.climatisation_bureau
      - conditions:
        - condition: state
          entity_id: input_select.mode_climatisation_intelligente
          state: Chaud
        sequence:
        - if:
          - condition: not
            conditions:
            - condition: state
              entity_id: climate.climatisation_bureau
              state: heat
          then:
          - action: climate.set_hvac_mode
            metadata: {}
            data:
              hvac_mode: heat
            target:
              entity_id: climate.climatisation_bureau
          - delay:
              hours: 0
              minutes: 0
              seconds: 1
              milliseconds: 0
        - if:
          - condition: template
            value_template: '{{states(''input_number.temperature_cible_chauffage_bureau'')
              | float(0) != state_attr(''climate.climatisation_bureau'',''temperature'')
              | float(0)}}'
          then:
          - action: climate.set_temperature
            metadata: {}
            data:
              temperature: '{{states(''input_number.temperature_cible_chauffage_bureau'')}}'
            target:
              entity_id: climate.climatisation_bureau
    else:
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.climatisation_bureau
          state: 'off'
      then:
      - action: climate.set_hvac_mode
        metadata: {}
        data:
          hvac_mode: 'off'
        target:
          entity_id: climate.climatisation_bureau
  mode: restart
- id: '1750081036212'
  alias: Climatisation Intelligente - Chambre
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.climatisation_chambre_autorisee
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_chambre
  - trigger: state
    entity_id:
    - input_number.temperature_cible_climatisation_chambre
  - trigger: state
    entity_id:
    - input_select.mode_climatisation_intelligente
  - trigger: homeassistant
    event: start
  - trigger: state
    entity_id:
    - input_boolean.climatisation_intelligent_de_la_chambre
  conditions:
  - condition: state
    entity_id: input_boolean.climatisation_intelligent_de_la_chambre
    state: 'on'
  actions:
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - if:
    - condition: state
      entity_id: binary_sensor.climatisation_chambre_autorisee
      state: 'on'
    then:
    - choose:
      - conditions:
        - condition: state
          entity_id: input_select.mode_climatisation_intelligente
          state: Froid
        sequence:
        - if:
          - condition: not
            conditions:
            - condition: state
              entity_id: climate.climatisation_chambre
              state: cool
          then:
          - action: climate.set_hvac_mode
            metadata: {}
            data:
              hvac_mode: cool
            target:
              entity_id: climate.climatisation_chambre
          - delay:
              hours: 0
              minutes: 0
              seconds: 1
              milliseconds: 0
        - if:
          - condition: template
            value_template: '{{states(''input_number.temperature_cible_climatisation_chambre'')
              | float(0) != state_attr(''climate.climatisation_chambre'',''temperature'')
              | float(0)}}'
          then:
          - action: climate.set_temperature
            metadata: {}
            data:
              temperature: '{{states(''input_number.temperature_cible_climatisation_chambre'')}}'
            target:
              entity_id: climate.climatisation_chambre
      - conditions:
        - condition: state
          entity_id: input_select.mode_climatisation_intelligente
          state: Chaud
        sequence:
        - if:
          - condition: not
            conditions:
            - condition: state
              entity_id: climate.climatisation_chambre
              state: heat
          then:
          - action: climate.set_hvac_mode
            metadata: {}
            data:
              hvac_mode: heat
            target:
              entity_id: climate.climatisation_chambre
          - delay:
              hours: 0
              minutes: 0
              seconds: 1
              milliseconds: 0
        - if:
          - condition: template
            value_template: '{{states(''input_number.temperature_cible_chauffage_chambre'')
              | float(0) != state_attr(''climate.climatisation_chambre'',''temperature'')
              | float(0)}}'
          then:
          - action: climate.set_temperature
            metadata: {}
            data:
              temperature: '{{states(''input_number.temperature_cible_chauffage_chambre'')}}'
            target:
              entity_id: climate.climatisation_chambre
    else:
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.climatisation_chambre
          state: 'off'
      then:
      - action: climate.set_hvac_mode
        metadata: {}
        data:
          hvac_mode: 'off'
        target:
          entity_id: climate.climatisation_chambre
  mode: restart
- id: '1750081171295'
  alias: Climatisation Intelligente - Chambre Marilou
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.climatisation_chambre_marilou_autorisee
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_chambre_marilou
  - trigger: state
    entity_id:
    - input_number.temperature_cible_climatisation_chambre_marilou
  - trigger: state
    entity_id:
    - input_select.mode_climatisation_intelligente
  - trigger: homeassistant
    event: start
  - trigger: state
    entity_id:
    - input_boolean.climatisation_intelligent_de_la_chambre_de_marilou
  conditions:
  - condition: state
    entity_id: input_boolean.climatisation_intelligent_de_la_chambre_de_marilou
    state: 'on'
  actions:
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - if:
    - condition: state
      entity_id: binary_sensor.climatisation_chambre_marilou_autorisee
      state: 'on'
    then:
    - choose:
      - conditions:
        - condition: state
          entity_id: input_select.mode_climatisation_intelligente
          state: Froid
        sequence:
        - if:
          - condition: not
            conditions:
            - condition: state
              entity_id: climate.climatisation_chambre_marilou
              state: cool
          then:
          - action: climate.set_hvac_mode
            metadata: {}
            data:
              hvac_mode: cool
            target:
              entity_id: climate.climatisation_chambre_marilou
          - delay:
              hours: 0
              minutes: 0
              seconds: 1
              milliseconds: 0
        - if:
          - condition: template
            value_template: '{{states(''input_number.temperature_cible_climatisation_chambre_marilou'')
              | float(0) != state_attr(''climate.climatisation_chambre_marilou'',''temperature'')
              | float(0)}}'
          then:
          - action: climate.set_temperature
            metadata: {}
            data:
              temperature: '{{states(''input_number.temperature_cible_climatisation_chambre_marilou'')}}'
            target:
              entity_id: climate.climatisation_chambre_marilou
      - conditions:
        - condition: state
          entity_id: input_select.mode_climatisation_intelligente
          state: Chaud
        sequence:
        - if:
          - condition: not
            conditions:
            - condition: state
              entity_id: climate.climatisation_chambre_marilou
              state: heat
          then:
          - action: climate.set_hvac_mode
            metadata: {}
            data:
              hvac_mode: heat
            target:
              entity_id: climate.climatisation_chambre_marilou
          - delay:
              hours: 0
              minutes: 0
              seconds: 1
              milliseconds: 0
        - if:
          - condition: template
            value_template: '{{states(''input_number.temperature_cible_chauffage_chambre_marilou'')
              | float(0) != state_attr(''climate.climatisation_chambre_marilou'',''temperature'')
              | float(0)}}'
          then:
          - action: climate.set_temperature
            metadata: {}
            data:
              temperature: '{{states(''input_number.temperature_cible_chauffage_chambre_marilou'')}}'
            target:
              entity_id: climate.climatisation_chambre_marilou
    else:
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.climatisation_chambre_marilou
          state: 'off'
      then:
      - action: climate.set_hvac_mode
        metadata: {}
        data:
          hvac_mode: 'off'
        target:
          entity_id: climate.climatisation_chambre_marilou
  mode: restart
- id: '1750081335140'
  alias: Climatisation Intelligente - Rez-de-chaussée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.climatisation_salon_autorisation
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_rez_de_chaussee
  - trigger: state
    entity_id:
    - input_number.temperature_cible_climatisation_rez_de_chaussee
  - trigger: state
    entity_id:
    - input_select.mode_climatisation_intelligente
  - trigger: homeassistant
    event: start
  - trigger: state
    entity_id:
    - input_boolean.climatisation_intelligent_du_rez_de_chaussee
  conditions:
  - condition: state
    entity_id: input_boolean.climatisation_intelligent_du_rez_de_chaussee
    state: 'on'
  actions:
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - if:
    - condition: state
      entity_id: binary_sensor.climatisation_salon_autorisation
      state: 'on'
    then:
    - choose:
      - conditions:
        - condition: state
          entity_id: input_select.mode_climatisation_intelligente
          state: Froid
        sequence:
        - if:
          - condition: not
            conditions:
            - condition: state
              entity_id: climate.climatisation_salon
              state: cool
          then:
          - action: climate.set_hvac_mode
            metadata: {}
            data:
              hvac_mode: cool
            target:
              entity_id: climate.climatisation_salon
          - delay:
              hours: 0
              minutes: 0
              seconds: 1
              milliseconds: 0
        - if:
          - condition: template
            value_template: '{{states(''input_number.temperature_cible_climatisation_rez_de_chaussee'')
              | float(0) != state_attr(''climate.climatisation_salon'',''temperature'')
              | float(0)}}'
          then:
          - action: climate.set_temperature
            metadata: {}
            data:
              temperature: '{{states(''input_number.temperature_cible_climatisation_rez_de_chaussee'')}}'
            target:
              entity_id: climate.climatisation_salon
          - delay:
              hours: 0
              minutes: 0
              seconds: 1
              milliseconds: 0
      - conditions:
        - condition: state
          entity_id: input_select.mode_climatisation_intelligente
          state: Chaud
        sequence:
        - if:
          - condition: not
            conditions:
            - condition: state
              entity_id: climate.climatisation_salon
              state: heat
          then:
          - action: climate.set_hvac_mode
            metadata: {}
            data:
              hvac_mode: heat
            target:
              entity_id: climate.climatisation_salon
          - delay:
              hours: 0
              minutes: 0
              seconds: 1
              milliseconds: 0
        - if:
          - condition: template
            value_template: '{{states(''input_number.temperature_cible_chauffage_rez_de_chaussee'')
              | float(0) != state_attr(''climate.climatisation_salon'',''temperature'')
              | float(0)}}'
          then:
          - action: climate.set_temperature
            metadata: {}
            data:
              temperature: '{{states(''input_number.temperature_cible_chauffage_rez_de_chaussee'')}}'
            target:
              entity_id: climate.climatisation_salon
          - delay:
              hours: 0
              minutes: 0
              seconds: 1
              milliseconds: 0
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.climatisation_salon
          attribute: fan_mode
          state: auto
      then:
      - action: climate.set_fan_mode
        metadata: {}
        data:
          fan_mode: auto
        target:
          entity_id: climate.climatisation_salon
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.climatisation_salon
          attribute: swing_mode
          state: 'off'
      then:
      - action: climate.set_swing_mode
        metadata: {}
        data:
          swing_mode: 'off'
        target:
          entity_id: climate.climatisation_salon
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: select.climatisation_salon_oscillation_verticale
          state: ↑↑
      then:
      - action: select.select_option
        metadata: {}
        data:
          option: ↑↑
        target:
          entity_id: select.climatisation_salon_oscillation_verticale
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: select.climatisation_salon_oscillation_horizontale
          state: ←
      then:
      - action: select.select_option
        metadata: {}
        data:
          option: ←
        target:
          entity_id: select.climatisation_salon_oscillation_horizontale
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
    else:
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: climate.climatisation_salon
          state: 'off'
      then:
      - action: climate.set_hvac_mode
        metadata: {}
        data:
          hvac_mode: 'off'
        target:
          entity_id: climate.climatisation_salon
  mode: restart
- id: '1750749535386'
  alias: Guirlande Jardin - Allumer
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.hue_tap_dial_switch_9_bouton_2
  conditions:
  - condition: state
    entity_id: event.hue_tap_dial_switch_9_bouton_2
    attribute: event_type
    state: initial_press
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.exterieur_lumineux
      state: 'on'
    then:
    - action: light.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: light.exterieur_guinguette
  - action: light.turn_on
    metadata: {}
    data:
      brightness_pct: 40
    target:
      entity_id: light.exterieur_sphere
  mode: single
- id: '1751811618609'
  alias: "Fuite d'eau - \U0001F514 Notifier"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.capteur_de_fuite_cellier
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.capteur_de_fuite_cuisine
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.capteur_de_fuite_salle_de_bains
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.capteur_de_fuite_salle_de_douche
    to: 'on'
  conditions: []
  actions:
  - action: script.power_notification_fuite_d_eau
    metadata: {}
    data:
      user_message: "{%- from 'unique_area_names.jinja' import unique_area_names -%}
        \     \n\nFuite d'eau détectée ! ({{unique_area_names([trigger.entity_id])}})"
  mode: queued
  max: 10
- id: '1752843691325'
  alias: Sonnette vidéo - Notifications importante
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.sonnette_personne
    id: person
    to: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.sonnette_colis
    id: parcel
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Vide
    for:
      hours: 0
      minutes: 2
      seconds: 0
    enabled: true
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - person
      sequence:
      - variables:
          user_message: Personne détectée près de la porte d'entrée
    - conditions:
      - condition: trigger
        id:
        - parcel
      sequence:
      - variables:
          user_message: Colis détecté près de la porte d'entrée
  - action: script.turn_on
    metadata: {}
    data:
      variables:
        user_message: '{{user_message}}'
    target:
      entity_id: script.power_notification_sonnette_video
  - delay:
      hours: 0
      minutes: 0
      seconds: 30
      milliseconds: 0
  mode: single
- id: '1752934059438'
  alias: Sonnette vidéo - Ne pas enregistrer lors du départ/arrivée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Départ en cours
    id: departure
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Arrivée en cours
    id: arrival
  conditions: []
  actions:
  - action: switch.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - switch.sonnette_enregistrement_ftp
      - switch.sonnette_enregistrer
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - input_select.modes_de_presence_de_la_maison_v2
      to: Vide
      for:
        hours: 0
        minutes: 2
        seconds: 0
    - trigger: state
      entity_id:
      - input_select.modes_de_presence_de_la_maison_v2
      to: Occupée
      for:
        hours: 0
        minutes: 2
        seconds: 0
    timeout:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - action: switch.turn_on
    metadata: {}
    data: {}
    target:
      entity_id:
      - switch.sonnette_enregistrement_ftp
      - switch.sonnette_enregistrer
  mode: single
- id: '1754241277625'
  alias: Réduire volume lorsque assistant vocal en écoute (Bureau Téléphone)
  description: ''
  use_blueprint:
    path: perso/reduce_volume_of_media_player_when_voice_assistant_listening_v2.yaml
    input:
      assist_satellite_entity: assist_satellite.telephone_analogique
      custom_target:
        entity_id: media_player.sonos_bureau_music_assistant
- id: '1755354215867'
  alias: 'Lave vaisselle - Planifier lors du démarrage '
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - switch.lave_vaisselle_etat
    to: 'on'
  conditions: []
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Inactif
    target:
      entity_id: input_select.etat_lave_vaisselle
  - if:
    - condition: state
      entity_id: sensor.lave_vaisselle_porte
      state: open
    then:
    - wait_for_trigger:
      - trigger: state
        entity_id:
        - sensor.lave_vaisselle_porte
        to: closed
      continue_on_timeout: false
    alias: Make sure door is closed
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - alias: Make sure dishwasher is ready (Not already started)
    if:
    - condition: state
      entity_id: sensor.lave_vaisselle_etat
      state: ready
    - condition: state
      entity_id: switch.lave_vaisselle_etat
      state: 'on'
    then:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Planifié
      target:
        entity_id: input_select.etat_lave_vaisselle
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: switch.lave_vaisselle_etat
  mode: single
- id: '1755354500368'
  alias: Lave vaisselle - Lavage en cours
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.lave_vaisselle_etat
    to: run
  conditions: []
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Lavage en cours
    target:
      entity_id: input_select.etat_lave_vaisselle
  mode: single
- id: '1755354559606'
  alias: Lave vaisselle - À vider
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.lave_vaisselle_etat
    to: finished
  conditions: []
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: À vider
    target:
      entity_id: input_select.etat_lave_vaisselle
  mode: single
- id: '1755354642082'
  alias: Lave vaisselle - Lave vaisselle vidé
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.lave_vaisselle_porte
    to: closed
  conditions:
  - condition: state
    entity_id: input_select.etat_lave_vaisselle
    state: À vider
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Inactif
    target:
      entity_id: input_select.etat_lave_vaisselle
  mode: single
- id: '1755354977183'
  alias: "Lave vaisselle - \U0001F514 Notifier démarrage prévu"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.etat_lave_vaisselle
    to: Planifié
  conditions: []
  actions:
  - action: script.power_notification_lancement_lave_vaisselle_prevu
    metadata: {}
    data: {}
  mode: single
- id: '1755355197104'
  alias: "Lave vaisselle - \U0001F514 Notifier cycle terminé"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.etat_lave_vaisselle
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  conditions:
  - condition: state
    entity_id: input_boolean.recevoir_notification_lave_vaisselle_termine
    state: 'on'
  - condition: state
    entity_id: input_select.etat_lave_vaisselle
    state: À vider
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_lave_vaisselle_termine
  mode: single
- id: '1755355447475'
  alias: Lave vaisselle - Lancer à 1:00
  description: ''
  triggers:
  - trigger: time
    at: 01:00:00
  conditions:
  - condition: state
    entity_id: input_select.etat_lave_vaisselle
    state: Planifié
  actions:
  - action: select.select_option
    metadata: {}
    data:
      option: dishcare_dishwasher_program_auto_2
    target:
      entity_id: select.lave_vaisselle_programme_actif
  mode: single
- id: '1755356382074'
  alias: Lave vaisselle - Annulation du lavage
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.lave_vaisselle_etat
    to: aborting
  conditions: []
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Inactif
    target:
      entity_id: input_select.etat_lave_vaisselle
  mode: single
- id: '1755694081224'
  alias: Démo Start convo
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.presence_rez_de_chaussee
    to: 'on'
  conditions: []
  actions:
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - action: assist_satellite.start_conversation
    metadata: {}
    data:
      start_message: Hey JLo, hey Home assistant community! I'm Nabu, what do you
        want me to do?
      preannounce: true
    target:
      entity_id: assist_satellite.vpe_salon_satellite_assist
  mode: single
- id: '1755871156066'
  alias: Frigo - Porte réfrigérateur restée ouverte
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.porte_refrigerateur
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  conditions: []
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_porte_refrigerateur_restee_ouverte
  - action: assist_satellite.announce
    metadata: {}
    data:
      preannounce: true
      preannounce_media_id:
        media_content_id: media-source://media_source/local/error.mp3
        media_content_type: audio/mpeg
        metadata:
          title: error.mp3
          thumbnail:
          media_class: music
          children_media_class:
          navigateIds:
          - {}
          - media_content_type: app
            media_content_id: media-source://media_source
      message: La porte du réfrigérateur est restée ouverte
    target:
      entity_id: assist_satellite.vpe_cuisine_satellite_assist
  mode: single
- id: '1755871368040'
  alias: Frigo - Porte congélateur restée ouverte
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.porte_congelateur
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  conditions: []
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_porte_congelateur_restee_ouverte
  - action: assist_satellite.announce
    metadata: {}
    data:
      preannounce: true
      preannounce_media_id:
        media_content_id: media-source://media_source/local/error.mp3
        media_content_type: audio/mpeg
        metadata:
          title: error.mp3
          thumbnail:
          media_class: music
          children_media_class:
          navigateIds:
          - {}
          - media_content_type: app
            media_content_id: media-source://media_source
      message: La porte du congélateur est restée ouverte
    target:
      entity_id: assist_satellite.vpe_cuisine_satellite_assist
  mode: single
- id: '1756643667821'
  alias: Machine à laver - État "Lavage en cours"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.machine_a_laver_job_state
    to:
    - wash
    - spin
    - rinse
  conditions: []
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Lavage en cours
    target:
      entity_id: input_select.etat_machine_a_laver
  mode: single
- id: '1756643763031'
  alias: Machine à laver - État "À vider"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.machine_a_laver_job_state
    to: finish
  conditions: []
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: À vider
    target:
      entity_id: input_select.etat_machine_a_laver
  mode: single
- id: '1756643842396'
  alias: Machine à laver - État "Planifiée"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.machine_a_laver_remote_control
    to: 'on'
  conditions: []
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Plannifiée
    target:
      entity_id: input_select.etat_machine_a_laver
  mode: single
- id: '1756643921523'
  alias: Machine à laver - État "Inactive"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.porte_machine_a_laver_ouverture
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_select.etat_machine_a_laver
    state: À vider
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Inactive
    target:
      entity_id: input_select.etat_machine_a_laver
  mode: single
