- id: '1688111538910'
  alias: Litière Intelligente - Incrementer passages litière
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_mouvement_litiere
    to: 'on'
    from: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_clean_cat_litter_box
    state: 'on'
  actions:
  - action: input_number.increment
    data: {}
    target:
      entity_id: input_number.litter_tracking
  mode: single
- id: '1688112377959'
  alias: "Litière Intelligente - \U0001F514 Notifier litière pleine"
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.is_litter_full
    trigger: state
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  conditions:
  - condition: state
    entity_id: input_boolean.automation_clean_cat_litter_box
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: state
    entity_id: binary_sensor.is_litter_full
    state: 'on'
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_litiere_pleine
  mode: single
- id: '1688114260897'
  alias: Poubelles Intelligentes - Poubelle noire à sortir
  description: ''
  triggers:
  - entity_id:
    - schedule.planning_poubelle_noire
    to: 'on'
    from: 'off'
    trigger: state
  conditions: []
  actions:
  - action: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.poubelle_noire_a_sortir
  mode: single
- id: '1688114327500'
  alias: Poubelles Intelligentes - Poubelle verte à sortir
  description: ''
  triggers:
  - entity_id:
    - schedule.planning_poubelle_verte
    to: 'on'
    from: 'off'
    trigger: state
  conditions: []
  actions:
  - action: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.poubelle_verte_a_sortir
  mode: single
- id: '1688114732811'
  alias: "Poubelles Intelligentes - \U0001F514 Poubelle noire non sortie à temps"
  description: ''
  triggers:
  - entity_id:
    - schedule.planning_poubelle_noire
    to: 'off'
    from: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_take_out_trash
    state: 'on'
  - condition: state
    entity_id: input_boolean.poubelle_noire_a_sortir
    state: 'on'
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_poubelle_noire_non_sortie_a_temps
  - action: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.poubelle_noire_a_sortir
  mode: single
- id: '1688114808231'
  alias: "Poubelles Intelligentes - \U0001F514 Poubelle verte non sortie à temps"
  description: ''
  triggers:
  - entity_id:
    - schedule.planning_poubelle_verte
    to: 'off'
    from: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_take_out_trash
    state: 'on'
  - condition: state
    entity_id: input_boolean.poubelle_verte_a_sortir
    state: 'on'
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_poubelle_verte_non_sortie_a_temps
  - action: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.poubelle_verte_a_sortir
  mode: single
- id: '1688116237944'
  alias: Boîte aux Lettres Intelligente - Courrier à relever
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_mouvement_boite_aux_lettres
    to: 'on'
    from: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.is_front_door_recently_open
    state: 'off'
  actions:
  - action: input_boolean.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.courrier_a_relever
  mode: single
- id: '1688116301973'
  alias: Boîte aux Lettres Intelligente - Courrier relevé
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_mouvement_boite_aux_lettres
    to: 'on'
    from: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.is_front_door_recently_open
    state: 'on'
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.courrier_a_relever
  mode: single
- id: '1688118075093'
  alias: Machine a Laver Intelligente - Machine à laver a vider
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.is_washing_machine_running
    to: 'off'
    from: 'on'
    trigger: state
  conditions: []
  actions:
  - action: input_boolean.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.machine_a_laver_a_vider
  mode: single
- id: '1688139412657'
  alias: Réveil intelligent - Régler heures de déclenchement
  description: ''
  triggers:
  - entity_id:
    - input_datetime.wake_up_time
    trigger: state
  conditions: []
  actions:
  - action: input_datetime.set_datetime
    data:
      datetime: '{{today_at(states(''input_datetime.wake_up_time'')) - timedelta(minutes
        = 5)}}'
    target:
      entity_id: input_datetime.wake_up_time_lights
  mode: single
- id: '1688139621896'
  alias: Réveil intelligent - Allumer Lumières
  description: ''
  triggers:
  - at: input_datetime.wake_up_time_lights
    trigger: time
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: state
        entity_id: input_select.reveil_intelligent
        state: Automatique
      - condition: state
        entity_id: binary_sensor.jour_de_travail_aujourdhui
        state: 'on'
    - condition: state
      entity_id: input_select.reveil_intelligent
      state: Activé
  actions:
  - action: script.wake_up
    data: {}
  mode: single
- id: '1688301259694'
  alias: TV intelligente - Allumer / Éteindre KEF
  description: ''
  triggers:
  - entity_id:
    - remote.jl_s_tv
    to: 'on'
    id: 'on'
    trigger: state
  - entity_id:
    - remote.jl_s_tv
    to: 'off'
    id: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_watch_tv
    state: 'on'
  - condition: not
    conditions:
    - condition: state
      entity_id: media_player.kef_salon_music_assistant
      state: playing
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - 'on'
      sequence:
      - action: media_player.media_pause
        metadata: {}
        data: {}
        target:
          entity_id: media_player.kef_salon_music_assistant
      - action: media_player.turn_on
        data: {}
        target:
          entity_id: media_player.kef
      - action: media_player.select_source
        data:
          source: Opt
        target:
          entity_id: media_player.kef
    - conditions:
      - condition: trigger
        id:
        - 'off'
      sequence:
      - action: media_player.turn_off
        data: {}
        target:
          entity_id: media_player.kef
  mode: single
- id: '1688364991944'
  alias: Bureau - Meetings VR
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.quest_in_use
    to: 'on'
    from: 'off'
    trigger: state
    for:
      hours: 0
      minutes: 0
      seconds: 5
  conditions:
  - condition: state
    entity_id: input_boolean.automation_meetings
    state: 'on'
  - condition: state
    entity_id: person.jenova70
    state: home
  - condition: state
    state: 'on'
    entity_id: binary_sensor.capteur_presence_bureau_occupancy
  - condition: state
    entity_id: binary_sensor.jean_loics_macbook_pro_active
    state: 'on'
  - condition: state
    entity_id: device_tracker.jean_loics_macbook_pro
    state: home
  actions:
  - action: scene.create
    data:
      scene_id: office_previous_light_state
      snapshot_entities:
      - light.bureau_suspension
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - action: light.turn_on
    data:
      brightness_pct: 100
      kelvin: 3521
    target:
      area_id: bureau
  - action: switch.turn_off
    data: {}
    target:
      entity_id: switch.vpe_bureau_microphone
  - if:
    - condition: state
      entity_id: binary_sensor.quest_in_use
      state: 'on'
    then:
    - wait_for_trigger:
      - entity_id:
        - binary_sensor.quest_in_use
        to: 'off'
        from: 'on'
        trigger: state
      continue_on_timeout: false
  - action: light.turn_off
    data: {}
    target:
      entity_id: light.hue_play_bars
  - action: scene.turn_on
    data: {}
    target:
      entity_id: scene.office_previous_light_state
  - action: switch.turn_on
    data: {}
    target:
      entity_id: switch.vpe_bureau_microphone
  mode: restart
- id: '1688368387161'
  alias: Bureau - Meetings
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.jean_loics_macbook_pro_camera_in_use
    to: 'on'
    from: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 5
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_meetings
    state: 'on'
  - condition: state
    entity_id: person.jenova70
    state: home
  - condition: state
    state: 'on'
    entity_id: binary_sensor.capteur_presence_bureau_occupancy
  - condition: state
    entity_id: binary_sensor.jean_loics_macbook_pro_active
    state: 'on'
  - condition: state
    entity_id: device_tracker.jean_loics_macbook_pro
    state: home
  actions:
  - data:
      scene_id: office_previous_light_state
      snapshot_entities:
      - light.bureau_suspension
    action: scene.create
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - data:
      brightness_pct: 100
      kelvin: 3521
    target:
      entity_id:
      - light.bureau_suspension
    action: light.turn_on
  - data:
      brightness_pct: 60
      kelvin: 3521
    target:
      entity_id:
      - light.hue_play_bars
    action: light.turn_on
  - data: {}
    target:
      entity_id: switch.vpe_bureau_microphone
    action: switch.turn_off
  - if:
    - condition: state
      entity_id: binary_sensor.jean_loics_macbook_pro_camera_in_use
      state: 'on'
    then:
    - wait_for_trigger:
      - entity_id:
        - binary_sensor.jean_loics_macbook_pro_camera_in_use
        to: 'off'
        from: 'on'
        trigger: state
      continue_on_timeout: false
  - data: {}
    target:
      entity_id: light.hue_play_bars
    action: light.turn_off
  - data: {}
    target:
      entity_id: scene.office_previous_light_state
    action: scene.turn_on
  - data: {}
    target:
      entity_id: switch.vpe_bureau_microphone
    action: switch.turn_on
  mode: restart
- id: '1688371620889'
  alias: Surveillance de la maison - Éteindre appareils lors du départ
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  conditions:
  - condition: state
    entity_id: input_boolean.depart_intelligent
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - action: script.leave_home
    data: {}
  mode: queued
  max: 10
- id: '1688373819985'
  alias: Surveillance de la maison - Allumer appareils lors de l'arrivée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Occupée
    from: Arrivée en cours
  conditions:
  - condition: state
    entity_id: input_boolean.arrivee_intelligente
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - action: cover.open_cover
    data: {}
    target:
      entity_id: cover.volets_salon
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: exterieur
      floor_id:
      - premier_etage
      - rez_de_chaussee
  - if:
    - condition: state
      entity_id: binary_sensor.exterieur_lumineux
      state: 'off'
    then:
    - action: script.turn_on
      data: {}
      target:
        entity_id: script.welcome_home
  mode: queued
  max: 10
- id: '1688375110167'
  alias: "Surveillance de la maison - \U0001F514 Notifier pluie et portes/fenêtres
    ouvertes "
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.wittboy_rain_rate_piezo
    above: 0
  conditions:
  - condition: state
    entity_id: input_boolean.recevoir_notification_fenetre_ouverte_et_pluie
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: state
    entity_id: binary_sensor.all_openings
    state: 'on'
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.all_doors
      state: 'on'
    then:
    - variables:
        open_doors: "{{ \n  expand(states.binary_sensor.all_doors.attributes.entity_id)\n
          \   | selectattr('state', 'eq', 'on')\n    | map(attribute='attributes.friendly_name')
          \n    | list\n    | join(\", \")\n}}"
    - action: script.turn_on
      data:
        variables:
          user_message: 'Les portes suivantes sont ouvertes et il commence a pleuvoir:
            {{open_doors}}'
      target:
        entity_id: script.power_notification_pluie_et_portes_ouvertes
  - if:
    - condition: state
      entity_id: binary_sensor.all_windows
      state: 'on'
    then:
    - variables:
        open_windows: "{{ \n  expand(states.binary_sensor.all_windows.attributes.entity_id)\n
          \   | selectattr('state', 'eq', 'on')\n    | map(attribute='attributes.friendly_name')
          \n    | list\n    | join(\", \")\n}}"
    - action: script.turn_on
      data:
        variables:
          user_message: 'Les fenêtres suivantes sont ouvertes et il commence a pleuvoir:
            {{open_windows}}'
      target:
        entity_id: script.power_notification_pluie_et_fenetres_ouvertes
  mode: single
- id: '1688386134462'
  alias: "Surveillance du système - \U0001F514 Notifier mise a jour dispo"
  description: ''
  triggers:
  - entity_id:
    - sensor.pending_updates
    attribute: entities
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_monitor_system
    state: 'on'
  - condition: template
    value_template: '{{trigger.to_state.state | int(0) > 0}}'
  actions:
  - action: script.turn_on
    metadata: {}
    data:
      variables:
        user_message: '{{trigger.to_state.attributes.entities | join('', '')}}'
    target:
      entity_id: script.power_notification_mise_a_jour_dispo
  mode: queued
  max: 10
- id: '1688390987276'
  alias: "Surveillance du système - \U0001F514 Notifier batteries faibles"
  description: ''
  triggers:
  - at: '21:00:00'
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.automation_monitor_system
    state: 'on'
  - condition: state
    entity_id: person.jenova70
    state: home
  - condition: numeric_state
    entity_id: sensor.low_batteries
    above: 0
  actions:
  - action: script.turn_on
    metadata: {}
    data:
      variables:
        user_message: '{{state_attr(''sensor.low_batteries'',''entities'') | join('',
          '')}}'
    target:
      entity_id: script.power_notification_batteries_faibles
  mode: single
- id: '1688537182551'
  alias: "Servarr - \U0001F514 Notification "
  description: ''
  triggers:
  - allowed_methods:
    - POST
    local_only: true
    webhook_id: sonarr-grab--KqTQ4vReuFd_as1xTR_hPqk2
    id: sonarr-grab
    variables:
      title: "\U0001F4FA Épisode en télechargement ..."
      message: '{{trigger.json.series.title}} - {{trigger.json.episodes[0].seasonNumber}}x{{trigger.json.episodes[0].episodeNumber}}
        - {{trigger.json.episodes[0].title}}'
      tag: '{{trigger.json.downloadId}}'
    trigger: webhook
  - allowed_methods:
    - POST
    local_only: true
    webhook_id: sonarr-download--KqTQ4vReuFd_as1xTR_hPqk2
    id: sonarr-download
    variables:
      title: ✅ Épisode téléchargé !
      message: '{{trigger.json.series.title}} - {{trigger.json.episodes[0].seasonNumber}}x{{trigger.json.episodes[0].episodeNumber}}
        - {{trigger.json.episodes[0].title}}'
      tag: '{{trigger.json.downloadId}}'
    trigger: webhook
  - allowed_methods:
    - POST
    local_only: true
    webhook_id: radarr-grab-ugUFeiF1HF_WK_-jpm1aFMCQ
    id: radarr-grab
    variables:
      title: "\U0001F3A5 Film en télechargement ..."
      message: '{{trigger.json.movie.title}} ({{trigger.json.movie.year}})'
      tag: '{{trigger.json.downloadId}}'
    trigger: webhook
  - allowed_methods:
    - POST
    local_only: true
    webhook_id: radarr-download-grab-ugUFeiF1HF_WK_-jpm1aFMCQ
    id: radarr-download
    variables:
      title: ✅ Film téléchargé !
      message: '{{trigger.json.movie.title}} ({{trigger.json.movie.year}})'
      tag: '{{trigger.json.downloadId}}'
    trigger: webhook
  conditions:
  - condition: state
    entity_id: input_boolean.recevoir_notification_media_telecharge
    state: 'on'
  actions:
  - action: script.turn_on
    metadata: {}
    data:
      variables:
        user_title: '{{title}}'
        user_message: '{{message}}'
        user_tag: '{{tag}}'
    target:
      entity_id: script.power_notification_servaar
  mode: single
- id: '1689253436663'
  alias: Lumières Extérieures - Synchroniser Hue et SONOFF
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.is_exterior_sphere_bright
    from: 'off'
    to: 'on'
    id: sphere_bright
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: state
  - entity_id:
    - binary_sensor.is_exterior_sphere_bright
    from: 'on'
    to: 'off'
    id: sphere_not_bright
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: state
  - entity_id:
    - light.plafonnier_exterieur
    from: 'off'
    to: 'on'
    id: ceiling_light_on
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: state
  - entity_id:
    - light.plafonnier_exterieur
    from: 'on'
    to: 'off'
    id: ceiling_light_off
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - sphere_bright
      - condition: state
        entity_id: light.plafonnier_exterieur
        state: 'off'
      sequence:
      - action: light.turn_on
        data: {}
        target:
          entity_id: light.plafonnier_exterieur
    - conditions:
      - condition: trigger
        id:
        - sphere_not_bright
      - condition: state
        entity_id: light.plafonnier_exterieur
        state: 'on'
      sequence:
      - action: light.turn_off
        data: {}
        target:
          entity_id: light.plafonnier_exterieur
    - conditions:
      - condition: trigger
        id:
        - ceiling_light_on
      - condition: state
        entity_id: binary_sensor.is_exterior_sphere_bright
        state: 'off'
      sequence:
      - action: light.turn_on
        data:
          brightness_pct: 100
        target:
          entity_id:
          - light.exterieur_sphere
    - conditions:
      - condition: trigger
        id:
        - ceiling_light_off
      - condition: state
        entity_id: binary_sensor.is_exterior_sphere_bright
        state: 'on'
      sequence:
      - action: light.turn_off
        data: {}
        target:
          entity_id:
          - light.exterieur_sphere
  mode: parallel
  max: 10
- id: '1691413517615'
  alias: Bureau - Notification Lumineuse Meetings
  description: ''
  triggers:
  - event: start
    offset: -0:5:0
    entity_id: calendar.nabucasa_calendar_personal
    id: personal
    trigger: calendar
  - event: start
    offset: -0:5:0
    entity_id: calendar.nabucasa_calendar_social_time
    id: social_time
    trigger: calendar
  - event: start
    offset: -0:1:0
    entity_id: calendar.nabucasa_calendar_personal
    id: personal
    trigger: calendar
  - event: start
    offset: -0:1:0
    entity_id: calendar.nabucasa_calendar_social_time
    id: social_time
    trigger: calendar
  conditions:
  - condition: state
    entity_id: input_boolean.automation_meetings
    state: 'on'
  - condition: state
    entity_id: person.jenova70
    state: home
  - condition: state
    entity_id: binary_sensor.capteur_presence_bureau_occupancy
    state: 'on'
  - condition: state
    entity_id: binary_sensor.jean_loics_macbook_pro_active
    state: 'on'
  - condition: state
    entity_id: device_tracker.jean_loics_macbook_pro
    state: home
  actions:
  - action: scene.create
    data:
      scene_id: office_webcam_previous_light_state
      snapshot_entities:
      - light.hue_play_bars
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - choose:
    - conditions:
      - condition: trigger
        id:
        - personal
      sequence:
      - action: light.turn_on
        data:
          brightness_pct: 100
          rgb_color:
          - 0
          - 76
          - 255
          transition: 1
        target:
          entity_id:
          - light.hue_play_bars
    - conditions:
      - condition: trigger
        id:
        - social_time
      sequence:
      - action: light.turn_on
        data:
          brightness_pct: 100
          rgb_color:
          - 68
          - 255
          - 0
          transition: 1
        target:
          entity_id:
          - light.hue_play_bars
    default:
    - action: light.turn_on
      data:
        brightness_pct: 100
        rgb_color:
        - 0
        - 76
        - 255
        transition: 1
      target:
        entity_id:
        - light.hue_play_bars
  - delay:
      hours: 0
      minutes: 0
      seconds: 2
      milliseconds: 0
  - action: scene.turn_on
    data: {}
    target:
      entity_id: scene.office_webcam_previous_light_state
  mode: single
- id: '1691566363432'
  alias: "Simulation de présence - \U0001F6CE️ Notifier Éloignement domicile sans
    simulation de présence"
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.far_away
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_presence_simulator
    state: 'off'
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_simulation_de_presence_et_eloignement_du_domicile
  mode: single
- id: '1691758172267'
  alias: "Pont Chaban Delmas - \U0001F6CE️ Notifier fermeture demain"
  description: ''
  triggers:
  - at: '20:00:00'
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.automation_notify_chaban_delmas_bridge
    state: 'on'
  - condition: template
    value_template: '{{as_datetime(states("sensor.chaban_delmas_next_closing_start_date"))
      - now() > timedelta(hours = 4)}}'
  - condition: template
    value_template: '{{as_datetime(states("sensor.chaban_delmas_next_closing_start_date"))
      - now() < timedelta(days = 1, hours = 4)}}'
  actions:
  - variables:
      human_redeable_closing_time: '{{as_timestamp(states("sensor.chaban_delmas_next_closing_start_date"))
        | timestamp_custom(''%H:%M'')}}

        '
  - if:
    - condition: numeric_state
      entity_id: sensor.distance_jlo_maison
      below: 20000
    then:
    - action: script.turn_on
      metadata: {}
      data:
        variables:
          user_message: Le pont Chaban Delmas fermera demain à {{human_redeable_closing_time}}
      target:
        entity_id: script.power_notification_pont_chaban_delmas
  mode: single
- id: '1692118004694'
  alias: Simulation de présence - Arrêter lors du retour
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Occupée
  conditions:
  - condition: state
    entity_id: input_boolean.automation_presence_simulator
    state: 'on'
  actions:
  - action: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.automation_presence_simulator
  mode: single
- id: '1693509234441'
  alias: "Tesla - \U0001F514 Rappel charge "
  description: ''
  triggers:
  - entity_id:
    - schedule.heures_pleines
    from: 'on'
    to: 'off'
    trigger: state
  - entity_id:
    - device_tracker.meme_emplacement
    to: home
    for:
      hours: 0
      minutes: 1
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_tesla
    state: 'on'
  - condition: state
    entity_id: device_tracker.meme_emplacement
    state: home
  - condition: state
    entity_id: binary_sensor.meme_cable_de_charge
    state: 'off'
  - condition: numeric_state
    entity_id: sensor.meme_niveau_de_la_batterie
    below: 65
  - condition: state
    entity_id: person.jenova70
    state: home
  - condition: state
    entity_id: schedule.heures_pleines
    state: 'off'
  actions:
  - action: script.turn_on
    metadata: {}
    data:
      variables:
        user_message: Pense à charger la voiture. Niveau de charge actuelle {{states('sensor.meme_niveau_de_la_batterie')}}%
    target:
      entity_id: script.power_notification_rappel_charge_tesla
  mode: single
- id: '1695458967964'
  alias: Tesla - Attacher Tesla à JL en début de conduite
  description: ''
  triggers:
  - entity_id:
    - input_boolean.jl_connected_to_tesla
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_tesla
    state: 'on'
  - condition: not
    conditions:
    - condition: state
      entity_id: device_tracker.meme_emplacement
      state: unavailable
  actions:
  - action: person.add_device_tracker
    data:
      entity_id: person.jenova70
      device_tracker:
      - device_tracker.meme_emplacement
  - action: person.remove_device_tracker
    data:
      entity_id: person.jenova70
      device_tracker:
      - device_tracker.jean_loics_iphone
  mode: single
- id: '1695459020679'
  alias: Tesla - Détacher Tesla à JL en fin de conduite
  description: ''
  triggers:
  - entity_id:
    - input_boolean.jl_connected_to_tesla
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_tesla
    state: 'on'
  actions:
  - action: notify.mobile_app_jean_loics_iphone
    data:
      message: request_location_update
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - action: person.add_device_tracker
    data:
      entity_id: person.jenova70
      device_tracker:
      - device_tracker.jean_loics_iphone
  - action: person.remove_device_tracker
    data:
      entity_id: person.jenova70
      device_tracker:
      - device_tracker.meme_emplacement
  mode: queued
  max: 10
- id: '1699131143084'
  alias: 'Music Assistant - Éteindre MASS lorsque KEF éteint '
  description: ''
  triggers:
  - entity_id:
    - media_player.kef
    to: 'off'
    from: 'on'
    trigger: state
  conditions:
  - condition: not
    conditions:
    - condition: state
      state: 'off'
      entity_id: media_player.kef_salon_music_assistant
  actions:
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id: media_player.kef_salon_music_assistant
  mode: single
- id: '1699131464359'
  alias: TV intelligente - Changer Source quand Lecture en cours sur TV
  description: ''
  triggers:
  - entity_id:
    - media_player.media_center
    to: playing
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_watch_tv
    state: 'on'
  - condition: not
    conditions:
    - condition: state
      entity_id: media_player.kef
      attribute: source
      state: Opt
  actions:
  - action: media_player.select_source
    data:
      source: Opt
    target:
      entity_id: media_player.kef
  mode: single
- id: '1699868538036'
  alias: Routine du sommeil Marilou - Arrêter
  description: ''
  triggers:
  - event: start
    id: restart
    trigger: homeassistant
  - at: input_datetime.marilou_bedtime_routine_end
    id: end
    trigger: time
  conditions:
  - condition: state
    entity_id: media_player.vpe_chambre_marilou_music_assistant
    state: playing
  - condition: template
    value_template: '{{now() >= as_local(as_datetime(states("input_datetime.marilou_bedtime_routine_end")))}}'
  actions:
  - action: media_player.media_pause
    data: {}
    target:
      entity_id:
      - media_player.vpe_chambre_marilou_music_assistant
  - action: light.turn_off
    data: {}
    target:
      area_id: chambre_bebe
  mode: single
- id: '1700410464307'
  alias: Simulation de présence
  description: ''
  triggers:
  - entity_id:
    - sensor.presence_simulator_current_step
    trigger: state
  - entity_id:
    - input_boolean.automation_presence_simulator
    trigger: state
  - entity_id:
    - input_boolean.presence_simulator_control_cover
    trigger: state
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - event: start
    trigger: homeassistant
  conditions:
  - condition: state
    entity_id: input_boolean.automation_presence_simulator
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Vide
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: sensor.presence_simulator_current_step
        state: out
      sequence:
      - action: light.turn_off
        data: {}
        target:
          floor_id:
          - rez_de_chaussee
          - premier_etage
          area_id: exterieur
      - if:
        - condition: state
          entity_id: input_boolean.presence_simulator_control_cover
          state: 'on'
        then:
        - action: cover.close_cover
          data: {}
          target:
            entity_id: cover.volets_salon
    - conditions:
      - condition: state
        entity_id: sensor.presence_simulator_current_step
        state: wake_up
      sequence:
      - action: light.turn_off
        data: {}
        target:
          floor_id: rez_de_chaussee
          area_id:
          - exterieur
          - couloir
      - action: light.turn_on
        data:
          brightness_pct: 50
        target:
          area_id:
          - bureau
          - chambre
          - chambre_bebe
      - if:
        - condition: state
          entity_id: input_boolean.presence_simulator_control_cover
          state: 'on'
        then:
        - action: cover.close_cover
          data: {}
          target:
            entity_id: cover.volets_salon
    - conditions:
      - condition: state
        entity_id: sensor.presence_simulator_current_step
        state: breakfast
      sequence:
      - action: light.turn_off
        data: {}
        target:
          floor_id: premier_etage
          area_id: exterieur
      - action: light.turn_on
        data:
          brightness_pct: 60
        target:
          floor_id: rez_de_chaussee
      - if:
        - condition: state
          entity_id: input_boolean.presence_simulator_control_cover
          state: 'on'
        then:
        - action: cover.open_cover
          data: {}
          target:
            entity_id: cover.volets_salon
    - conditions:
      - condition: state
        entity_id: sensor.presence_simulator_current_step
        state: chill
      sequence:
      - action: light.turn_off
        data: {}
        target:
          floor_id: premier_etage
      - action: light.turn_on
        data:
          brightness_pct: 40
        target:
          floor_id: rez_de_chaussee
          entity_id: light.exterieur_guinguette
      - if:
        - condition: state
          entity_id: input_boolean.presence_simulator_control_cover
          state: 'on'
        then:
        - action: cover.open_cover
          data: {}
          target:
            entity_id: cover.volets_salon
    - conditions:
      - condition: state
        entity_id: sensor.presence_simulator_current_step
        state: eating
      sequence:
      - action: light.turn_off
        data: {}
        target:
          floor_id: premier_etage
      - action: light.turn_on
        data:
          brightness_pct: 60
        target:
          floor_id: rez_de_chaussee
          entity_id: light.exterieur_guinguette
      - if:
        - condition: state
          entity_id: input_boolean.presence_simulator_control_cover
          state: 'on'
        then:
        - action: cover.open_cover
          data: {}
          target:
            entity_id: cover.volets_salon
    - conditions:
      - condition: state
        entity_id: sensor.presence_simulator_current_step
        state: bedtime
      sequence:
      - action: light.turn_off
        data: {}
        target:
          floor_id: rez_de_chaussee
          area_id:
          - couloir
          - exterieur
      - action: light.turn_on
        data:
          brightness_pct: 40
        target:
          area_id:
          - bureau
          - chambre
          - chambre_bebe
      - if:
        - condition: state
          entity_id: input_boolean.presence_simulator_control_cover
          state: 'on'
        then:
        - action: cover.open_cover
          data: {}
          target:
            entity_id: cover.volets_salon
  mode: single
- id: '1702164245946'
  alias: Routine du sommeil Marilou - Changer heure fin de routine
  description: ''
  triggers:
  - entity_id:
    - input_number.marilou_bedtime_routine_duration
    trigger: state
  - entity_id:
    - script.start_marilou_bedtime_routine
    to: 'on'
    trigger: state
  conditions: []
  actions:
  - action: input_datetime.set_datetime
    data:
      datetime: '{{ now() + timedelta (minutes = states(''input_number.marilou_bedtime_routine_duration'')
        | int) }}'
    target:
      entity_id: input_datetime.marilou_bedtime_routine_end
  mode: single
- id: '1702834566659'
  alias: "Poubelles Intelligentes - \U0001F514 Notifier"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: state
    entity_id:
    - input_boolean.poubelle_noire_a_sortir
  - trigger: state
    entity_id:
    - input_boolean.poubelle_verte_a_sortir
  conditions:
  - condition: state
    entity_id: input_boolean.automation_take_out_trash
    state: 'on'
  actions:
  - if:
    - condition: state
      entity_id: input_boolean.poubelle_noire_a_sortir
      state: 'on'
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state:
      - Départ en cours
      - Arrivée en cours
    then:
    - action: script.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: script.power_notification_poubelle_noire_a_sortir
  - if:
    - condition: state
      entity_id: input_boolean.poubelle_verte_a_sortir
      state: 'on'
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state:
      - Départ en cours
      - Arrivée en cours
    then:
    - action: script.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: script.power_notification_poubelle_verte_a_sortir
  mode: single
- id: '1702835659800'
  alias: "Poubelles Intelligentes - \U0001F4F2 Poubelle verte sortie depuis notification"
  description: ''
  triggers:
  - event_type: mobile_app_notification_action
    event_data:
      action: green_trash_taken_out
    trigger: event
  conditions: []
  actions:
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.poubelle_verte_a_sortir
    data: {}
  mode: single
- id: '1702835708226'
  alias: "Poubelles Intelligentes - \U0001F4F2 Poubelle noire sortie depuis notification"
  description: ''
  triggers:
  - event_type: mobile_app_notification_action
    event_data:
      action: black_trash_taken_out
    trigger: event
  conditions: []
  actions:
  - action: input_boolean.turn_off
    target:
      entity_id:
      - input_boolean.poubelle_noire_a_sortir
    data: {}
  mode: single
- id: '1703176659308'
  alias: Bureau - Standing Desk Autonome
  description: ''
  triggers:
  - minutes: '25'
    trigger: time_pattern
  - minutes: '55'
    trigger: time_pattern
  conditions:
  - condition: state
    entity_id: input_boolean.automation_meetings
    state: 'on'
  - condition: state
    entity_id: binary_sensor.jean_loics_macbook_pro_camera_in_use
    state: 'off'
  - condition: state
    entity_id: binary_sensor.quest_in_use
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: person.jenova70
        state: home
      - condition: state
        entity_id: binary_sensor.jean_loics_macbook_pro_active
        state: 'on'
      - condition: state
        entity_id: device_tracker.jean_loics_macbook_pro
        state: home
      - condition: state
        entity_id: binary_sensor.capteur_presence_bureau_occupancy
        state: 'on'
      - condition: state
        entity_id: binary_sensor.jour_de_travail_aujourdhui
        state: 'on'
      - condition: state
        entity_id: schedule.working_hours
        state: 'on'
      - condition: numeric_state
        entity_id: sensor.next_meeting_in
        above: 2100
      - condition: state
        entity_id: sensor.de_4_standing_desk_autonome
        state: '1'
      sequence:
      - action: script.controler_le_standing_desk
        metadata: {}
        data:
          target_position: standing
    default:
    - action: script.controler_le_standing_desk
      metadata: {}
      data:
        target_position: sitting
  mode: single
- id: '1707214155021'
  alias: "Bureau - \U0001F4E3 Contrôle du Standing Desk par la voix"
  description: ''
  triggers:
  - command:
    - (Lève|Lever|Monte|Monter) [le] bureau
    - (Mais|Mets|Mettre|Passe|Passer) [le] bureau [en] (mode|position) debout
    id: up
    trigger: conversation
  - command:
    - (descend|descends|descendre|Baisse|Baisser) [le] bureau
    - (Mais|Mets|Mettre|Passe|Passer) [le] bureau [en] (mode|position) (assis|assise)
    id: down
    trigger: conversation
  conditions:
  - condition: state
    entity_id: binary_sensor.standing_desk_moving
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - up
      sequence:
      - action: script.turn_on
        metadata: {}
        data:
          variables:
            target_position: standing
        target:
          entity_id: script.controler_le_standing_desk
      - set_conversation_response: Bureau en montée
    - conditions:
      - condition: trigger
        id:
        - down
      sequence:
      - action: script.turn_on
        metadata: {}
        data:
          variables:
            target_position: sitting
        target:
          entity_id: script.controler_le_standing_desk
      - set_conversation_response: Bureau en descente
  mode: single
- id: '1707424061311'
  alias: "Mode Sommeil Marilou - \U0001F4E3 Lancer par commande vocale "
  description: ''
  triggers:
  - command:
    - 'Au dodo '
    - (Au lit)|(Ollie)|(Holly)
    trigger: conversation
  conditions: []
  actions:
  - action: input_boolean.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.mode_sommeil_marilou
  - set_conversation_response: Bonne nuit Marilou !
  mode: single
- id: '1707728356919'
  alias: "Meta Quest - \U0001F6CE️ Notification batterie faible."
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.quest_in_use
    to: 'off'
    from: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.recevoir_notification_batterie_meta_quest
    state: 'on'
  - condition: numeric_state
    entity_id: sensor.quest_battery_level
    below: 60
  actions:
  - action: script.turn_on
    metadata: {}
    data:
      variables:
        user_message: "La batterie du Quest est actuellement à {{states(\"sensor.quest_battery_level\")}}%.
          Pense à le recharger. \n"
    target:
      entity_id: script.power_notification_charger_meta_quest
  - if:
    - condition: state
      entity_id: binary_sensor.capteur_presence_bureau_occupancy
      state: 'on'
    - condition: state
      entity_id: person.jenova70
      state: home
    then:
    - action: assist_satellite.announce
      metadata: {}
      data:
        message: La batterie du Quest est actuellement à       {{states("sensor.quest_battery_level")}}%.
          Pense à le recharger.
      target:
        entity_id: assist_satellite.vpe_bureau_satellite_assist
  mode: single
- id: '1714134719761'
  alias: "Assist - \U0001F4E3 Réinitialiser la lumière"
  description: ''
  triggers:
  - command:
    - réinitialise[r] (la|les) lumière[s]
    trigger: conversation
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{ trigger.device_id != None}}'
    then:
    - variables:
        target_scene_list: "{% set default_scenes = label_entities(\"Scène par défaut\")
          %}\n{% set target_area = area_id(trigger.device_id) %}\n{% set entities_in_area
          = area_entities(target_area) %}\n\n[\n{%- for entity in entities_in_area
          -%}\n  {%- if entity in default_scenes -%}\n    \"{{entity}}\",\n  {%- endif
          -%}\n{%- endfor -%}\n]\n"
    - if:
      - condition: template
        value_template: '{{ target_scene_list | count >=1 }}'
      then:
      - action: scene.turn_on
        metadata: {}
        target:
          entity_id: '{{target_scene_list}}'
      - set_conversation_response: Lumière réinitialisée
      else:
      - set_conversation_response: Aucune scene par defaut trouvée
    else:
    - set_conversation_response: Cette commande ne fonctionne pas depuis cet appareil
  mode: single
- id: '1714308060749'
  alias: Réveil intelligent - Démarrer la Musique
  description: ''
  triggers:
  - at: input_datetime.wake_up_time
    trigger: time
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: state
    entity_id: input_boolean.reveil_intelligent_musical
    state: 'on'
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: state
        entity_id: input_select.reveil_intelligent
        state: Automatique
      - condition: state
        entity_id: binary_sensor.jour_de_travail_aujourdhui
        state: 'on'
    - condition: state
      entity_id: input_select.reveil_intelligent
      state: Activé
  actions:
  - action: script.lancer_playlist_de_reveil
    metadata: {}
    data: {}
    enabled: true
  mode: single
- id: '1718020295304'
  alias: Éteindre Bureau si plus de présence
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_bureau_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: bureau
  - action: button.press
    metadata: {}
    data: {}
    target:
      entity_id: button.standing_desk_move_desk_to_position_2
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id: media_player.sonos_bureau
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id:
      - media_player.sonos_bureau_music_assistant
  mode: single
- id: '1718020351848'
  alias: Éteindre Chambre si plus de présence
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_chambre_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: chambre
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id:
      - media_player.vpe_chambre_music_assistant
  mode: single
- id: '1718020490708'
  alias: Éteindre Chambre Marilou si plus de présence
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_chambre_marilou_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 10
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: chambre_bebe
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id: media_player.vpe_chambre_marilou_music_assistant
  mode: single
- id: '1718706928319'
  alias: Transfert Musique Tesla vers Maison - Allumer Enceintes
  description: ''
  triggers:
  - entity_id:
    - device_tracker.meme_emplacement
    trigger: state
    not_from: unavailable
  conditions:
  - condition: state
    entity_id: input_boolean.automation_tesla
    state: 'on'
  - condition: state
    entity_id: input_boolean.transfert_musique_tesla_vers_maison
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: not
    conditions:
    - condition: state
      entity_id: device_tracker.meme_emplacement
      state: unavailable
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: device_tracker.meme_emplacement
        state: home
      - condition: state
        entity_id: media_player.meme_lecteur_multimedia
        state: playing
      sequence:
      - action: media_player.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - media_player.kef
      - action: media_player.select_source
        metadata: {}
        data:
          source: Wifi
        target:
          entity_id: media_player.kef
      - action: media_player.volume_set
        metadata: {}
        data:
          volume_level: 0.5
        target:
          entity_id:
          - media_player.kef
          - media_player.kef_salon_music_assistant
    default:
    - action: media_player.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - media_player.kef
  mode: single
- id: '1718707293101'
  alias: Transfert Musique Tesla vers Maison - Transférer Musique
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Occupée
    from: Arrivée en cours
  conditions:
  - condition: state
    entity_id: input_boolean.automation_tesla
    state: 'on'
  - condition: state
    entity_id: input_boolean.transfert_musique_tesla_vers_maison
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.tesla_recent_playback
        state: 'on'
      - condition: template
        value_template: '{{state_attr(''binary_sensor.tesla_recent_playback'',''title'')
          != None}}'
      - condition: template
        value_template: '{{state_attr(''binary_sensor.tesla_recent_playback'',''artist'')
          != None}}'
      - condition: not
        conditions:
        - condition: state
          entity_id: media_player.kef_salon_music_assistant
          state: 'off'
      - condition: not
        conditions:
        - condition: state
          entity_id: media_player.kef
          state: 'off'
      sequence:
      - action: music_assistant.play_media
        metadata: {}
        data:
          media_type: track
          enqueue: replace
          radio_mode: true
          artist: '{{state_attr(''binary_sensor.tesla_recent_playback'',''artist'')}}'
          media_id: '{{state_attr(''binary_sensor.tesla_recent_playback'',''title'')}}'
        target:
          entity_id: media_player.kef_salon_music_assistant
      - action: media_player.volume_set
        metadata: {}
        data:
          volume_level: 0.5
        target:
          entity_id:
          - media_player.kef
          - media_player.kef_salon_music_assistant
    default:
    - action: media_player.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - media_player.kef
  mode: queued
  max: 10
- id: '1719771128107'
  alias: Tesla - Détacher Tesla à JL en fin de conduite (Backup)
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.meme_conducteur
    to: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_tesla
    state: 'on'
  - condition: state
    entity_id: input_boolean.jl_connected_to_tesla
    state: 'on'
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.jl_connected_to_tesla
  mode: queued
  max: 10
- id: '1726171964785'
  alias: Chauffage Intelligent - Choisir Mode Rez-De-Chaussée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    from: Vide
  - trigger: state
    entity_id:
    - binary_sensor.presence_rez_de_chaussee
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - entity_id:
    - binary_sensor.capteur_ouverture_fenetre_cuisine
    - binary_sensor.capteur_ouverture_porte_entree
    - binary_sensor.capteur_ouverture_porte_fenetre_salon
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - event: start
    trigger: homeassistant
  - entity_id:
    - input_boolean.guest_mode
    trigger: state
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_fenetre_cuisine
          state: 'on'
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_porte_entree
          state: 'on'
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_porte_fenetre_salon
          state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Frost Guard
        target:
          entity_id: input_select.mode_chauffage_rez_de_chaussee
    - conditions:
      - condition: state
        entity_id: binary_sensor.presence_rez_de_chaussee
        state: 'on'
      - condition: or
        conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_select.modes_de_presence_de_la_maison_v2
            state: Vide
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'off'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Présent
        target:
          entity_id: input_select.mode_chauffage_rez_de_chaussee
    default:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Absent
      target:
        entity_id: input_select.mode_chauffage_rez_de_chaussee
  mode: queued
  max: 10
- id: '1726172240853'
  alias: Chauffage Intelligent - Choisir Mode Bureau
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    from: Vide
  - entity_id:
    - binary_sensor.capteur_ouverture_fenetre_bureau
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - entity_id:
    - binary_sensor.capteur_presence_bureau_occupancy
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - event: start
    trigger: homeassistant
  - entity_id:
    - input_boolean.guest_mode
    trigger: state
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.capteur_ouverture_fenetre_bureau
        state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Frost Guard
        target:
          entity_id:
          - input_select.mode_chauffage_bureau
    - conditions:
      - condition: state
        entity_id: binary_sensor.capteur_presence_bureau_occupancy
        state: 'on'
      - condition: or
        conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_select.modes_de_presence_de_la_maison_v2
            state: Vide
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'off'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Présent
        target:
          entity_id: input_select.mode_chauffage_bureau
    default:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Absent
      target:
        entity_id:
        - input_select.mode_chauffage_bureau
  mode: queued
  max: 10
- id: '1726172527832'
  alias: Chauffage Intelligent - Choisir Mode Chambre
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    from: Vide
  - entity_id:
    - binary_sensor.capteur_ouverture_fenetre_chambre
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - entity_id:
    - binary_sensor.capteur_presence_chambre_occupancy
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - event: start
    trigger: homeassistant
  - entity_id:
    - input_boolean.guest_mode
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.capteur_ouverture_fenetre_chambre
        state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Frost Guard
        target:
          entity_id: input_select.mode_chauffage_chambre
    - conditions:
      - condition: state
        entity_id: binary_sensor.capteur_presence_chambre_occupancy
        state: 'on'
        for:
          hours: 0
          minutes: 0
          seconds: 0
      - condition: or
        conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_select.modes_de_presence_de_la_maison_v2
            state: Vide
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Présent
        target:
          entity_id:
          - input_select.mode_chauffage_chambre
    default:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Absent
      target:
        entity_id:
        - input_select.mode_chauffage_chambre
  mode: queued
  max: 10
- id: '1726172622795'
  alias: Chauffage Intelligent - Choisir Mode Chambre Marilou
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    from: Vide
  - entity_id:
    - binary_sensor.capteur_ouverture_fenetre_chambre_bebe
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - entity_id:
    - binary_sensor.capteur_presence_chambre_marilou_occupancy
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - event: start
    trigger: homeassistant
  - entity_id:
    - input_boolean.guest_mode
    trigger: state
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.capteur_ouverture_fenetre_chambre_bebe
        state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Frost Guard
        target:
          entity_id:
          - input_select.mode_chauffage_chambre_marilou
    - conditions:
      - condition: state
        entity_id: binary_sensor.capteur_presence_chambre_marilou_occupancy
        state: 'on'
        for:
          hours: 0
          minutes: 0
          seconds: 0
      - condition: or
        conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_select.modes_de_presence_de_la_maison_v2
            state: Vide
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Présent
        target:
          entity_id:
          - input_select.mode_chauffage_chambre_marilou
    default:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Absent
      target:
        entity_id:
        - input_select.mode_chauffage_chambre_marilou
  mode: queued
  max: 10
- id: '1726173163311'
  alias: Chauffage Intelligent - Régler Température Rez-De-Chaussée
  description: ''
  triggers:
  - entity_id:
    - input_number.temperature_cible_chauffage_rez_de_chaussee
    id: target_changed
    trigger: state
  - entity_id:
    - climate.netatmo
    attribute: temperature
    id: device_changed_1_hour_ago
    for:
      hours: 1
      minutes: 0
      seconds: 0
    trigger: state
  - minutes: '0'
    seconds: '0'
    id: tick
    trigger: time_pattern
  - event: start
    id: restart
    trigger: homeassistant
  - entity_id:
    - input_boolean.automation_heat_home
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_heat_home
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - target_changed
        - device_changed_1_hour_ago
        - restart
      sequence:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{states(''input_number.temperature_cible_chauffage_rez_de_chaussee'')}}'
        target:
          entity_id: climate.netatmo
    - conditions:
      - condition: trigger
        id:
        - tick
      sequence:
      - if:
        - condition: template
          value_template: '{{states(''input_number.temperature_cible_chauffage_rez_de_chaussee'')|float(0)
            == state_attr(''climate.netatmo'',''temperature'') }}'
        then:
        - action: climate.set_temperature
          metadata: {}
          data:
            temperature: '{{states(''input_number.temperature_cible_chauffage_rez_de_chaussee'')}}'
          target:
            entity_id: climate.netatmo
  mode: queued
  max: 10
- id: '1726173315597'
  alias: Chauffage Intelligent - Régler Température Bureau
  description: ''
  triggers:
  - entity_id:
    - input_number.temperature_cible_chauffage_bureau
    id: target_changed
    trigger: state
  - entity_id:
    - climate.radiateur_bureau
    attribute: temperature
    id: device_changed_1_hour_ago
    for:
      hours: 1
      minutes: 0
      seconds: 0
    trigger: state
  - minutes: '0'
    seconds: '0'
    id: tick
    trigger: time_pattern
  - event: start
    id: restart
    trigger: homeassistant
  - entity_id:
    - input_boolean.automation_heat_home
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_heat_home
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - target_changed
        - device_changed_1_hour_ago
        - restart
      sequence:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{states(''input_number.temperature_cible_chauffage_bureau'')}}'
        target:
          entity_id: climate.radiateur_bureau
    - conditions:
      - condition: trigger
        id:
        - tick
      sequence:
      - if:
        - condition: template
          value_template: '{{states(''input_number.temperature_cible_chauffage_bureau'')|float(0)
            == state_attr(''climate.radiateur_bureau'',''temperature'') }}'
        then:
        - action: climate.set_temperature
          metadata: {}
          data:
            temperature: '{{states(''input_number.temperature_cible_chauffage_bureau'')}}'
          target:
            entity_id: climate.radiateur_bureau
  mode: queued
  max: 10
- id: '1726173501857'
  alias: Chauffage Intelligent - Régler Température Chambre
  description: ''
  triggers:
  - entity_id:
    - input_number.temperature_cible_chauffage_chambre
    id: target_changed
    trigger: state
  - entity_id:
    - climate.radiateur_chambre
    attribute: temperature
    id: device_changed_1_hour_ago
    for:
      hours: 1
      minutes: 0
      seconds: 0
    trigger: state
  - minutes: '0'
    seconds: '0'
    id: tick
    trigger: time_pattern
  - event: start
    id: restart
    trigger: homeassistant
  - entity_id:
    - input_boolean.automation_heat_home
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_heat_home
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - target_changed
        - device_changed_1_hour_ago
        - restart
      sequence:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{states(''input_number.temperature_cible_chauffage_chambre'')}}'
        target:
          entity_id: climate.radiateur_chambre
    - conditions:
      - condition: trigger
        id:
        - tick
      sequence:
      - if:
        - condition: template
          value_template: '{{states(''input_number.temperature_cible_chauffage_chambre'')|float(0)
            == state_attr(''climate.radiateur_chambre'',''temperature'') }}'
        then:
        - action: climate.set_temperature
          metadata: {}
          data:
            temperature: '{{states(''input_number.temperature_cible_chauffage_chambre'')}}'
          target:
            entity_id: climate.radiateur_chambre
  mode: queued
  max: 10
- id: '1726173575899'
  alias: Chauffage Intelligent - Régler Température Chambre Marilou
  description: ''
  triggers:
  - entity_id:
    - input_number.temperature_cible_chauffage_chambre_marilou
    id: target_changed
    trigger: state
  - entity_id:
    - climate.radiateur_chambre_marilou
    attribute: temperature
    id: device_changed_1_hour_ago
    for:
      hours: 1
      minutes: 0
      seconds: 0
    trigger: state
  - minutes: '0'
    seconds: '0'
    id: tick
    trigger: time_pattern
  - event: start
    id: restart
    trigger: homeassistant
  - entity_id:
    - input_boolean.automation_heat_home
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_heat_home
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - target_changed
        - device_changed_1_hour_ago
        - restart
      sequence:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{states(''input_number.temperature_cible_chauffage_chambre_marilou'')}}'
        target:
          entity_id: climate.radiateur_chambre_marilou
    - conditions:
      - condition: trigger
        id:
        - tick
      sequence:
      - if:
        - condition: template
          value_template: '{{states(''input_number.temperature_cible_chauffage_chambre_marilou'')|float(0)
            == state_attr(''climate.radiateur_chambre_marilou'',''temperature'') }}'
        then:
        - action: climate.set_temperature
          metadata: {}
          data:
            temperature: '{{states(''input_number.temperature_cible_chauffage_chambre_marilou'')}}'
          target:
            entity_id: climate.radiateur_chambre_marilou
  mode: queued
  max: 10
- id: '1726663233965'
  alias: "Chauffage intelligent - \U0001F6CE️ Notifier Température anormale Salon"
  description: ''
  use_blueprint:
    path: perso/notify_abnormal_temperature_v2.yaml
    input:
      room_name: Salon
      room_temperature: sensor.thermostat_netatmo_current_temperature
      room_openings:
      - binary_sensor.capteur_ouverture_fenetre_cuisine
      - binary_sensor.capteur_ouverture_porte_entree
      - binary_sensor.capteur_ouverture_porte_fenetre_salon
      room_openings_duration: 00:05:00
      outside_temperature: sensor.wittboy_outdoor_temperature
      power_notification_script: script.power_notification_temperature_anormale_dans_le_salon
- id: '1726663270597'
  alias: "Chauffage intelligent - \U0001F6CE️ Notifier Température anormale Chambre"
  description: ''
  use_blueprint:
    path: perso/notify_abnormal_temperature_v2.yaml
    input:
      room_name: Chambre
      room_temperature: sensor.radiateur_chambre_current_temperature
      room_openings:
      - binary_sensor.capteur_ouverture_fenetre_chambre
      room_openings_duration: 00:05:00
      outside_temperature: sensor.wittboy_outdoor_temperature
      power_notification_script: script.power_notification_temperature_anormale_dans_la_chambre
- id: '1726663301942'
  alias: "Chauffage intelligent - \U0001F6CE️ Notifier Température anormale Chambre
    Marilou"
  description: ''
  use_blueprint:
    path: perso/notify_abnormal_temperature_v2.yaml
    input:
      room_name: Chambre Marilou
      room_temperature: sensor.radiateur_chambre_marilou_current_temperature
      room_openings:
      - binary_sensor.capteur_ouverture_fenetre_chambre_bebe
      room_openings_duration: 00:05:00
      outside_temperature: sensor.wittboy_outdoor_temperature
      power_notification_script: script.power_notification_temperature_anormale_dans_la_chambre_de_marilou
- id: '1726663330892'
  alias: "Chauffage intelligent - \U0001F6CE️ Notifier Température anormale Bureau"
  description: ''
  use_blueprint:
    path: perso/notify_abnormal_temperature_v2.yaml
    input:
      room_name: Bureau
      room_temperature: sensor.radiateur_bureau_current_temperature
      room_openings:
      - binary_sensor.capteur_ouverture_fenetre_bureau
      room_openings_duration: 00:05:00
      outside_temperature: sensor.wittboy_outdoor_temperature
      power_notification_script: script.power_notification_temperature_anormale_dans_le_bureau
- id: '1726666291089'
  alias: Pulse - Allumer / Éteindre
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_bureau_occupancy
    - input_boolean.automation_matrix_2d
    - input_datetime.pulse_end_schedule
    - input_datetime.pulse_start_schedule
    trigger: state
  - at: input_datetime.pulse_start_schedule
    trigger: time
  - at: input_datetime.pulse_end_schedule
    trigger: time
  - event: start
    trigger: homeassistant
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
  - trigger: state
    entity_id:
    - input_boolean.guest_mode
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.capteur_presence_bureau_occupancy
      state: 'on'
    - condition: time
      after: input_datetime.pulse_start_schedule
      before: input_datetime.pulse_end_schedule
    - condition: state
      entity_id: input_boolean.automation_matrix_2d
      state: 'on'
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state: Occupée
    - condition: state
      entity_id: input_boolean.mode_sommeil
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
    then:
    - action: light.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: light.2d_matrix
    - action: select.random
      target:
        entity_id:
        - select.2d_matrix_preset
      data: {}
    else:
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: light.2d_matrix
  mode: restart
- id: '1727025004524'
  alias: "Mode Invité - \U0001F514 Notifier mode invité lors de l'arrivée"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Occupée
  conditions:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'on'
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_desactiver_mode_invite_lors_de_l_arrivee
  mode: single
- id: '1727807421914'
  alias: "\U0001F514 Notifier porte d'entrée ouverte"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.capteur_ouverture_porte_entree
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_porte_d_entree_restee_ouverte
  - action: assist_satellite.announce
    metadata: {}
    data:
      message: La porte d'entrée est restée ouverte!
    target:
      entity_id:
      - assist_satellite.vpe_salon_satellite_assist
  mode: single
- id: '1727807641536'
  alias: Éteindre Couloir automatiquement
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - light.couloir
    to: 'on'
    for:
      hours: 0
      minutes: 15
      seconds: 0
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: couloir
  mode: single
- id: '1727985869387'
  alias: Modes de presence de la maison - Occupée au démarrage
  description: ''
  triggers:
  - trigger: homeassistant
    event: start
  conditions:
  - condition: state
    entity_id: binary_sensor.home_occupied
    state: 'on'
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Occupée
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727985928425'
  alias: Modes de presence de la maison - Occupée lors de l'ouverture de la porte
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.capteur_ouverture_porte_entree
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Arrivée en cours
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Occupée
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727985974297'
  alias: Modes de presence de la maison - Occupée si porte déjà ouverte lors de l'arrivée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Arrivée en cours
  conditions:
  - condition: state
    entity_id: binary_sensor.capteur_ouverture_porte_entree
    state: 'on'
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Occupée
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727986078836'
  alias: Modes de presence de la maison - Occupée via le Dial Hue
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.hue_tap_dial_switch_1_bouton_1
    attribute: event_type
    to: long_release
    for:
      hours: 0
      minutes: 0
      seconds: 0
  - trigger: state
    entity_id:
    - event.hue_tap_dial_switch_1_bouton_2
    attribute: event_type
    to: long_release
    for:
      hours: 0
      minutes: 0
      seconds: 0
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Arrivée en cours
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Occupée
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727986554484'
  alias: Modes de presence de la maison - Départ en cours via Occupation de la maison
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.home_occupied
    to: 'off'
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state: Occupée
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state: Arrivée en cours
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Départ en cours
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727986656573'
  alias: Modes de presence de la maison - Vide lors de l'ouverture de la porte
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.capteur_ouverture_porte_entree
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Départ en cours
  actions:
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.capteur_ouverture_porte_entree
      to: 'off'
    timeout:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
  - action: input_select.select_option
    metadata: {}
    data:
      option: Vide
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727986721466'
  alias: Modes de presence de la maison - Vide si porte déjà ouverte lors du départ
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Départ en cours
  conditions:
  - condition: state
    entity_id: binary_sensor.capteur_ouverture_porte_entree
    state: 'on'
  actions:
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.capteur_ouverture_porte_entree
      to: 'off'
    timeout:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
  - action: input_select.select_option
    metadata: {}
    data:
      option: Vide
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727986811171'
  alias: Modes de presence de la maison - Vide si Occupation de la maison déjà vide
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Départ en cours
  conditions:
  - condition: state
    entity_id: binary_sensor.home_occupied
    state: 'off'
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Vide
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727986902983'
  alias: Modes de presence de la maison - Départ en cours via le Dial Hue
  description: ''
  triggers:
  - entity_id:
    - event.hue_tap_dial_switch_1_bouton_3
    attribute: event_type
    to: repeat
    id: 'on'
    trigger: state
  - entity_id:
    - event.hue_tap_dial_switch_1_bouton_4
    attribute: event_type
    to: repeat
    id: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Départ en cours
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  - action: assist_satellite.announce
    metadata: {}
    data:
      message: '{% set time = now().hour %} {% if (time >= 18) %} Bonne soirée {%
        elif (time >= 12) %} Bonne après-midi {% elif (time >= 5) %} Bonne journée
        {% else %} Bonne nuit {% endif %}'
    target:
      entity_id: assist_satellite.vpe_salon_satellite_assist
  mode: single
- id: '1727986956298'
  alias: Modes de presence de la maison - Départ en cours via la voix
  description: ''
  triggers:
  - command:
    - Je pars [faire un tour]
    - Je m'en vais [faire un tour]
    - On part [faire un tour]
    - On s'en va [faire un tour]
    - Au revoir
    - À bientôt
    - À plus
    trigger: conversation
  conditions: []
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Départ en cours
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  - set_conversation_response: '{% set time = now().hour %}

      {% if (time >= 18) %}

      Bonne soirée

      {% elif (time >= 12) %}

      Bonne après-midi

      {% elif (time >= 5) %}

      Bonne journée

      {% else %}

      Bonne nuit

      {% endif %}'
  mode: single
- id: '1727987133642'
  alias: Modes de presence de la maison - Vide au démarrage
  description: ''
  triggers:
  - trigger: homeassistant
    event: start
  conditions:
  - condition: state
    entity_id: binary_sensor.home_occupied
    state: 'off'
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Vide
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727987264453'
  alias: 'Modes de presence de la maison - Arrivée en cours via Occupation de la maison '
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.home_occupied
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Vide
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Arrivée en cours
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727987389149'
  alias: Modes de presence de la maison - Arrivée en cours via le Dial Hue
  description: ''
  triggers:
  - entity_id:
    - event.hue_tap_dial_switch_1_bouton_1
    attribute: event_type
    to: repeat
    id: 'on'
    trigger: state
  - entity_id:
    - event.hue_tap_dial_switch_1_bouton_2
    attribute: event_type
    to: repeat
    id: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - action: input_select.select_option
    metadata: {}
    data:
      option: Arrivée en cours
    target:
      entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1727989830960'
  alias: Surveillance de la maison - Notifier appareils allumé lors du départ
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Départ en cours
    from: Occupée
  conditions:
  - condition: state
    entity_id: input_boolean.depart_intelligent
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - action: script.preparer_depart_maison
    data: {}
  mode: queued
  max: 10
- id: '1728137727182'
  alias: Modes de presence de la maison / Fallback modes temporaires
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    for:
      hours: 0
      minutes: 15
      seconds: 0
    to: Départ en cours
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    for:
      hours: 0
      minutes: 15
      seconds: 0
    to: Arrivée en cours
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.home_occupied
        state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Occupée
        target:
          entity_id: input_select.modes_de_presence_de_la_maison_v2
    - conditions:
      - condition: state
        entity_id: binary_sensor.home_occupied
        state: 'off'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Vide
        target:
          entity_id: input_select.modes_de_presence_de_la_maison_v2
  mode: single
- id: '1728146766901'
  alias: "Boîte aux Lettres Intelligente - \U0001F514 Notifier"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.courrier_a_relever
    id: mail
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Départ en cours
    id: arriving_leaving
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Arrivée en cours
    id: arriving_leaving
  conditions:
  - condition: state
    entity_id: input_boolean.automation_monitor_mailbox
    state: 'on'
  - condition: state
    entity_id: input_boolean.courrier_a_relever
    state: 'on'
  - condition: not
    conditions:
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state: Vide
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - mail
      - condition: not
        conditions:
        - condition: state
          entity_id: input_select.modes_de_presence_de_la_maison_v2
          state: Vide
      sequence:
      - action: script.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: script.power_notification_courrier_a_relever
    - conditions:
      - condition: trigger
        id:
        - arriving_leaving
      - condition: state
        entity_id: input_boolean.courrier_a_relever
        state: 'on'
      sequence:
      - action: script.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: script.power_notification_courrier_a_relever
  mode: single
- id: '1728147111105'
  alias: "Machine a Laver Intelligente - \U0001F514 Notifier"
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.machine_a_laver_a_vider
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  conditions:
  - condition: state
    entity_id: input_boolean.automation_monitor_washing_machine
    state: 'on'
  - condition: state
    entity_id: input_boolean.machine_a_laver_a_vider
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_machine_a_laver_terminee
  mode: single
- id: '1728584203675'
  alias: Chauffage intelligent - Arrêter Boost Salle de Bains
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.chauffage_salle_de_bains_boost
    to: 'on'
    for:
      hours: 0
      minutes: 20
      seconds: 0
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.chauffage_salle_de_bains_boost
  mode: queued
  max: 10
- id: '1728584273169'
  alias: Chauffage intelligent - Arrêter Boost Salle de Douche
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.chauffage_salle_de_douche_boost
    to: 'on'
    for:
      hours: 0
      minutes: 20
      seconds: 0
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.chauffage_salle_de_douche_boost
  mode: queued
  max: 10
- id: '1728584405832'
  alias: Chauffage Intelligent - Choisir Mode Salle De Douche
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    from: Vide
  - event: start
    trigger: homeassistant
  - entity_id:
    - input_boolean.guest_mode
    trigger: state
  - trigger: state
    entity_id:
    - input_boolean.chauffage_salle_de_douche_boost
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.chauffage_salle_de_douche_boost
        state: 'on'
      - condition: or
        conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_select.modes_de_presence_de_la_maison_v2
            state: Vide
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Boost
        target:
          entity_id: input_select.mode_chauffage_salle_de_douche
    default:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Normal
      target:
        entity_id: input_select.mode_chauffage_salle_de_douche
  mode: queued
  max: 10
- id: '1728584599375'
  alias: Chauffage Intelligent - Choisir Mode Salle De Bains
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Vide
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    from: Vide
  - entity_id:
    - binary_sensor.capteur_ouverture_fenetre_salle_de_bain
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: state
  - event: start
    trigger: homeassistant
  - entity_id:
    - input_boolean.guest_mode
    trigger: state
  - trigger: state
    entity_id:
    - input_boolean.chauffage_salle_de_bains_boost
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.capteur_ouverture_fenetre_salle_de_bain
        state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Frost Guard
        target:
          entity_id: input_select.mode_chauffage_salle_de_bains
    - conditions:
      - condition: state
        entity_id: input_boolean.chauffage_salle_de_bains_boost
        state: 'on'
      - condition: or
        conditions:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_select.modes_de_presence_de_la_maison_v2
            state: Vide
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'on'
      sequence:
      - action: input_select.select_option
        metadata: {}
        data:
          option: Boost
        target:
          entity_id: input_select.mode_chauffage_salle_de_bains
    default:
    - action: input_select.select_option
      metadata: {}
      data:
        option: Normal
      target:
        entity_id: input_select.mode_chauffage_salle_de_bains
  mode: queued
  max: 10
- id: '1728584808902'
  alias: Chauffage Intelligent - Régler Température Salle De Bains
  description: ''
  triggers:
  - entity_id:
    - input_number.temperature_cible_chauffage_salle_de_bains
    id: target_changed
    trigger: state
  - entity_id:
    - climate.radiateur_salle_de_bains
    attribute: temperature
    id: device_changed_1_hour_ago
    for:
      hours: 1
      minutes: 0
      seconds: 0
    trigger: state
  - minutes: '0'
    seconds: '0'
    id: tick
    trigger: time_pattern
  - event: start
    id: restart
    trigger: homeassistant
  - entity_id:
    - input_boolean.automation_heat_home
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_heat_home
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - target_changed
        - device_changed_1_hour_ago
        - restart
      sequence:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{states(''input_number.temperature_cible_chauffage_salle_de_bains'')}}'
        target:
          entity_id: climate.radiateur_salle_de_bains
    - conditions:
      - condition: trigger
        id:
        - tick
      sequence:
      - if:
        - condition: template
          value_template: '{{states(''input_number.temperature_cible_chauffage_salle_de_bains'')|float(0)
            == state_attr(''climate.radiateur_salle_de_bains'',''temperature'') }}'
        then:
        - action: climate.set_temperature
          metadata: {}
          data:
            temperature: '{{states(''input_number.temperature_cible_chauffage_salle_de_bains'')}}'
          target:
            entity_id: climate.radiateur_salle_de_bains
  mode: queued
  max: 10
- id: '1728584851841'
  alias: Chauffage Intelligent - Régler Température Salle De Douche
  description: ''
  triggers:
  - entity_id:
    - input_number.temperature_cible_chauffage_salle_de_douche
    id: target_changed
    trigger: state
  - entity_id:
    - climate.radiateur_salle_de_douche
    attribute: temperature
    id: device_changed_1_hour_ago
    for:
      hours: 1
      minutes: 0
      seconds: 0
    trigger: state
  - minutes: '0'
    seconds: '0'
    id: tick
    trigger: time_pattern
  - event: start
    id: restart
    trigger: homeassistant
  - entity_id:
    - input_boolean.automation_heat_home
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.automation_heat_home
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - target_changed
        - device_changed_1_hour_ago
        - restart
      sequence:
      - action: climate.set_temperature
        metadata: {}
        data:
          temperature: '{{states(''input_number.temperature_cible_chauffage_salle_de_douche'')}}'
        target:
          entity_id: climate.radiateur_salle_de_douche
    - conditions:
      - condition: trigger
        id:
        - tick
      sequence:
      - if:
        - condition: template
          value_template: '{{states(''input_number.temperature_cible_chauffage_salle_de_douche'')|float(0)
            == state_attr(''climate.radiateur_salle_de_douche'',''temperature'') }}'
        then:
        - action: climate.set_temperature
          metadata: {}
          data:
            temperature: '{{states(''input_number.temperature_cible_chauffage_salle_de_douche'')}}'
          target:
            entity_id: climate.radiateur_salle_de_douche
  mode: queued
  max: 10
- id: '1729016436406'
  alias: 'Voicekit Rez-de-Chaussée - Afficher corvées '
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.corvees
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.corvees
      state: 'on'
    - condition: state
      entity_id: input_select.modes_de_presence_de_la_maison_v2
      state: Occupée
    then:
    - action: light.turn_on
      metadata: {}
      data: {}
      target:
        entity_id:
        - light.vpe_cuisine_led_ring
        - light.vpe_salon_led_ring
    else:
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - light.vpe_cuisine_led_ring
        - light.vpe_salon_led_ring
  mode: queued
  max: 10
- id: '1729028729486'
  alias: 'Assist - Poubelles sorties par la voix '
  description: ''
  triggers:
  - trigger: conversation
    command:
    - '[La] Poubelle [est] sortie'
    - '[Les] Poubelles [sont] sorties'
    - J'ai sorti la poubelle
    - J'ai sorti les poubelles
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.poubelle_noire_a_sortir
        state: 'on'
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.poubelle_noire_a_sortir
      - set_conversation_response: C'est noté
    - conditions:
      - condition: state
        entity_id: input_boolean.poubelle_verte_a_sortir
        state: 'on'
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.poubelle_verte_a_sortir
      - set_conversation_response: C'est noté
    default:
    - set_conversation_response: 'Aucune poubelle n''est actuellement à sortir. '
  mode: single
- id: '1729029546444'
  alias: Assist - Litière nettoyée par la voix
  description: ''
  triggers:
  - trigger: conversation
    command:
    - '[La] litière [est] nettoyée'
    - J'ai nettoyé la litière
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: input_number.litter_tracking
        above: 0
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: 0
        target:
          entity_id: input_number.litter_tracking
      - set_conversation_response: C'est noté
    default:
    - set_conversation_response: La litière est déja propre
  mode: single
- id: '1729029743503'
  alias: Assist - Machine à laver vidée par la voix
  description: ''
  triggers:
  - trigger: conversation
    command:
    - '[La] machine à laver [est] vidée'
    - J'ai vidé la machine à laver
    - La machine à laver a été vidée
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.machine_a_laver_a_vider
        state: 'on'
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.machine_a_laver_a_vider
      - set_conversation_response: C'est noté
    default:
    - set_conversation_response: La machine à laver est déjà vide
  mode: single
- id: '1729029879020'
  alias: Assist - Courrier relevé par la voix
  description: ''
  triggers:
  - trigger: conversation
    command:
    - '[Le] courrier [est] récupéré'
    - Le courrier a été récupéré
    - J'ai récupéré le courrier
    - J'ai été récupérer le courrier
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.courrier_a_relever
        state: 'on'
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - input_boolean.courrier_a_relever
      - set_conversation_response: C'est noté
    default:
    - set_conversation_response: La boite aux lettres était déjà vide
  mode: single
- id: '1729586042273'
  alias: Mode Sommeil - Bascule par VoiceKit Chambre
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.vpe_chambre_button_press
  conditions:
  - condition: not
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: event.vpe_chambre_button_press
        state: unavailable
      - condition: state
        entity_id: event.vpe_chambre_button_press
        state: unknown
  - condition: state
    entity_id: event.vpe_chambre_button_press
    attribute: event_type
    state: long_press
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'off'
      sequence:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.mode_sommeil
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: Mode Sommeil Activé. {% if is_state('binary_sensor.reveil_demain','on')
            -%} Réveil prévu pour {{states('input_datetime.wake_up_time')}} {% else
            -%} Pas de réveil prévu pour demain {%- endif -%}
        target:
          entity_id: assist_satellite.vpe_chambre_satellite_assist
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'on'
      sequence:
      - action: input_boolean.turn_off
        target:
          entity_id:
          - input_boolean.mode_sommeil
        data: {}
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: Mode Sommeil désactivé. Bonne journée
        target:
          entity_id:
          - assist_satellite.vpe_chambre_satellite_assist
  mode: single
- id: '1729586824286'
  alias: Mode Sommeil - Actions
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'off'
      sequence:
      - if:
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'off'
        then:
        - action: light.turn_on
          metadata: {}
          data:
            brightness_pct: 10
          target:
            area_id:
            - couloir
        - action: cover.open_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.volets_salon
        - if:
          - condition: state
            entity_id: binary_sensor.exterieur_lumineux
            state: 'off'
          then:
          - action: light.turn_on
            metadata: {}
            data:
              brightness_pct: 10
            target:
              area_id:
              - bd4ba6262e7a4e72b2fd740a22c70403
      - action: media_player.media_pause
        metadata: {}
        data: {}
        target:
          entity_id:
          - media_player.vpe_chambre_music_assistant
      - if:
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_fenetre_chambre
          state: 'off'
        then:
        - action: cover.open_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideau_chambre
      - if:
        - condition: state
          entity_id: binary_sensor.exterieur_lumineux
          state: 'on'
        then:
        - action: light.turn_off
          metadata: {}
          data: {}
          target:
            area_id: chambre
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'on'
      sequence:
      - if:
        - condition: state
          entity_id: input_boolean.guest_mode
          state: 'off'
        then:
        - action: cover.close_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.volets_salon
        - action: script.eteindre_tous_les_lecteur_multimedia
          metadata: {}
          data: {}
        - action: light.turn_off
          metadata: {}
          data: {}
          target:
            floor_id:
            - rez_de_chaussee
            - premier_etage
            area_id: exterieur
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          area_id: chambre
      - action: media_player.media_pause
        metadata: {}
        data: {}
        target:
          entity_id: media_player.vpe_chambre_music_assistant
      - if:
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_fenetre_chambre
          state: 'off'
        then:
        - action: cover.close_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideau_chambre
      - if:
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_porte_entree
          state: 'off'
        then:
        - action: lock.lock
          metadata: {}
          data: {}
          target:
            entity_id: lock.serrure_porte_d_entree
        else:
        - action: script.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: script.power_notification_porte_d_entree_ouverte_lors_du_coucher
  mode: single
- id: '1730275787349'
  alias: Chauffage Intelligent - Choisir Temperature Cible Bureau
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_bureau
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_bureau_absent
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_bureau_present
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_fenetres_ouvertes
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_bureau
        state: Présent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_bureau_present'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_bureau
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_bureau
        state: Absent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_bureau_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_bureau
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_bureau
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_fenetres_ouvertes'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_bureau
  mode: queued
  max: 10
- id: '1730275937269'
  alias: Chauffage Intelligent - Choisir Temperature Cible Chambre Marilou
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_chambre_marilou
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_chambre_marilou_absent
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_chambre_marilou_present
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_fenetres_ouvertes
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre_marilou
        state: Présent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_chambre_marilou_present'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_chambre_marilou
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre_marilou
        state: Absent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_chambre_marilou_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_chambre_marilou
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre_marilou
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_fenetres_ouvertes'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_chambre_marilou
  mode: queued
  max: 10
- id: '1730275992160'
  alias: Chauffage Intelligent - Choisir Temperature Cible Chambre
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_chambre
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_chambre_absent
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_chambre_present
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_fenetres_ouvertes
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre
        state: Présent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_chambre_present'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_chambre
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre
        state: Absent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_chambre_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_chambre
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_chambre
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_fenetres_ouvertes'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_chambre
  mode: queued
  max: 10
- id: '1730276011770'
  alias: Chauffage Intelligent - Choisir Temperature Cible Rez-De-Chaussée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_rez_de_chaussee
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_rez_de_chaussee_absent
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_rez_de_chaussee_present
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_fenetres_ouvertes
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_rez_de_chaussee
        state: Présent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_rez_de_chaussee_present'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_rez_de_chaussee
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_rez_de_chaussee
        state: Absent
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_rez_de_chaussee_absent'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_rez_de_chaussee
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_rez_de_chaussee
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_fenetres_ouvertes'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_rez_de_chaussee
  mode: queued
  max: 10
- id: '1730276096280'
  alias: Chauffage Intelligent - Choisir Temperature Cible Salle De Bains
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_salle_de_bains
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_salle_de_bains_boost
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_salle_de_bains_normal
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_fenetres_ouvertes
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_salle_de_bains
        state: Normal
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_salle_de_bains_normal'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_salle_de_bains
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_salle_de_bains
        state: Boost
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_salle_de_bains_boost'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_salle_de_bains
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_salle_de_bains
        state: Frost Guard
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_fenetres_ouvertes'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_salle_de_bains
  mode: queued
  max: 10
- id: '1730276134273'
  alias: Chauffage Intelligent - Choisir Temperature Cible Salle De Douche
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.mode_chauffage_salle_de_douche
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_salle_de_douche_boost
  - trigger: state
    entity_id:
    - input_number.temperature_cible_chauffage_salle_de_douche_normal
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_salle_de_douche
        state: Normal
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_salle_de_douche_normal'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_salle_de_douche
    - conditions:
      - condition: state
        entity_id: input_select.mode_chauffage_salle_de_douche
        state: Boost
      sequence:
      - action: input_number.set_value
        metadata: {}
        data:
          value: '{{states(''input_number.temperature_cible_chauffage_salle_de_douche_boost'')}}'
        target:
          entity_id: input_number.temperature_cible_chauffage_salle_de_douche
  mode: queued
  max: 10
- id: '1730752664557'
  alias: VPE RdC - Allumer / Éteindre automatiquement
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.presence_rez_de_chaussee
    to: 'on'
    trigger: state
  - trigger: state
    entity_id:
    - binary_sensor.presence_rez_de_chaussee
    to: 'off'
    for:
      hours: 0
      minutes: 15
      seconds: 0
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: homeassistant
    event: start
  - trigger: state
    entity_id:
    - input_boolean.mode_cinema
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: input_select.modes_de_presence_de_la_maison_v2
          state: Vide
      - condition: state
        entity_id: binary_sensor.presence_rez_de_chaussee
        state: 'on'
      - condition: state
        entity_id: input_boolean.mode_cinema
        state: 'off'
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - switch.micros_rez_de_chaussee
    default:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - switch.micros_rez_de_chaussee
  mode: single
- id: '1730753017143'
  alias: VoiceKit Chambre - Controller Volume
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil_marilou
    for:
      hours: 0
      minutes: 0
      seconds: 10
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'on'
      sequence:
      - action: media_player.volume_set
        metadata: {}
        data:
          volume_level: 0.2
        target:
          entity_id: media_player.vpe_chambre_media_player
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'on'
      sequence:
      - action: media_player.volume_set
        metadata: {}
        data:
          volume_level: 0.4
        target:
          entity_id: media_player.vpe_chambre_media_player
    default:
    - action: media_player.volume_set
      metadata: {}
      data:
        volume_level: 0.8
      target:
        entity_id: media_player.vpe_chambre_media_player
  mode: single
- id: '1731176393383'
  alias: VPE Chambre - Allumer / Éteindre automatiquement
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_chambre_occupancy
    to: 'on'
    trigger: state
  - trigger: state
    entity_id:
    - binary_sensor.capteur_presence_chambre_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: homeassistant
    event: start
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: input_select.modes_de_presence_de_la_maison_v2
          state: Vide
      - condition: state
        entity_id: binary_sensor.capteur_presence_chambre_occupancy
        state: 'on'
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - switch.vpe_chambre_microphone
    default:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - switch.vpe_chambre_microphone
  mode: single
- id: '1731176431172'
  alias: VPE Chambre Marilou - Allumer / Éteindre automatiquement
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_chambre_marilou_occupancy
    to: 'on'
    trigger: state
  - trigger: state
    entity_id:
    - binary_sensor.capteur_presence_chambre_marilou_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: homeassistant
    event: start
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: input_select.modes_de_presence_de_la_maison_v2
          state: Vide
      - condition: state
        entity_id: binary_sensor.capteur_presence_chambre_marilou_occupancy
        state: 'on'
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - switch.vpe_chambre_marilou_microphone
    default:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - switch.vpe_chambre_marilou_microphone
  mode: single
- id: '1731176473847'
  alias: VPE Bureau - Allumer / Éteindre automatiquement
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.capteur_presence_bureau_occupancy
    to: 'on'
    trigger: state
  - trigger: state
    entity_id:
    - binary_sensor.capteur_presence_bureau_occupancy
    to: 'off'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: homeassistant
    event: start
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: input_select.modes_de_presence_de_la_maison_v2
          state: Vide
      - condition: state
        entity_id: binary_sensor.capteur_presence_bureau_occupancy
        state: 'on'
      sequence:
      - action: switch.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - switch.vpe_bureau_microphone
    default:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - switch.vpe_bureau_microphone
  mode: single
- id: '1731706815901'
  alias: Réduire volume lorsque assistant vocal en écoute (Bureau)
  description: ''
  use_blueprint:
    path: perso/reduce_volume_of_media_player_when_voice_assistant_listening_v2.yaml
    input:
      assist_satellite_entity: assist_satellite.vpe_bureau_satellite_assist
      custom_target:
        entity_id: media_player.sonos_bureau
- id: '1731706885951'
  alias: Réduire volume lorsque assistant vocal en écoute (Cuisine)
  description: ''
  use_blueprint:
    path: perso/reduce_volume_of_media_player_when_voice_assistant_listening_v2.yaml
    input:
      assist_satellite_entity: assist_satellite.vpe_cuisine_satellite_assist
      custom_target:
        entity_id:
        - media_player.kef_salon_music_assistant
- id: '1731706904863'
  alias: Réduire volume lorsque assistant vocal en écoute (Salon)
  description: ''
  use_blueprint:
    path: perso/reduce_volume_of_media_player_when_voice_assistant_listening_v2.yaml
    input:
      assist_satellite_entity: assist_satellite.vpe_salon_satellite_assist
      custom_target:
        entity_id: media_player.kef_salon_music_assistant
- id: '1731762231230'
  alias: VPE - Transferer la musique
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.vpe_salon_button_press
    - event.vpe_bureau_button_press
    - event.vpe_chambre_button_press
    - event.vpe_cuisine_button_press
    - event.vpe_chambre_marilou_button_press
    - event.vpe_dvt_salle_de_douche_button_press
    not_to: unavailable
  conditions:
  - condition: template
    value_template: '{{trigger.to_state.attributes.event_type == ''double_press''}}'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - variables:
      area_id: '{{area_id(trigger.entity_id)}}'
    enabled: true
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.lecteurs_music_assistant_en_lecture
        state: 'on'
      sequence:
      - action: music_assistant.transfer_queue
        metadata: {}
        data: {}
        target:
          area_id: '{{area_id}}'
    default:
    - action: music_assistant.play_media
      target:
        area_id: '{{area_id}}'
      data:
        media_id: All Favorited Tracks
        media_type: playlist
        enqueue: replace
    enabled: true
  mode: single
- id: '1731941056494'
  alias: Vacances - Générer texte de bonne fête
  description: ''
  triggers:
  - trigger: calendar
    entity_id: calendar.vacances_france
    event: start
    offset: '-2:0:0'
  conditions: []
  actions:
  - action: conversation.process
    data:
      agent_id: conversation.holiday_greeting
      text: '{{trigger.calendar_event.summary}}'
    response_variable: ai_greeting_response
  - action: input_text.set_value
    metadata: {}
    data:
      value: '{{ai_greeting_response.response.speech.plain.speech}}'
    target:
      entity_id: input_text.holiday_greeting
  mode: single
- id: '1732054434382'
  alias: Mode Cinéma - Activer
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - media_player.media_center
    to:
    - playing
    id: tv
    for:
      seconds: 1
  - trigger: state
    entity_id:
    - binary_sensor.is_ps5_used
    to: 'on'
    id: ps5
    for:
      hours: 0
      minutes: 0
      seconds: 1
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - tv
      sequence:
      - variables:
          supported_apps: '{{["Netflix", "Plex", "Prime Video"]}}'
      - condition: template
        value_template: '{{ trigger.to_state.attributes.app_name in supported_apps
          }}'
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.mode_cinema
    - conditions:
      - condition: trigger
        id:
        - ps5
      sequence:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.mode_cinema
  mode: restart
- id: '1732054630408'
  alias: Mode Cinéma - Désactiver
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - media_player.media_center
    to:
    - 'off'
    - 'on'
    - idle
  - trigger: homeassistant
    event: start
  - trigger: state
    entity_id:
    - media_player.media_center
    attribute: app_name
    from:
    - Netflix
    - Plex
    - Prime Video
  - trigger: state
    entity_id:
    - binary_sensor.is_ps5_used
    to: 'off'
  conditions: []
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.mode_cinema
  mode: queued
  max: 10
- id: '1732055799796'
  alias: Mode Cinéma - Controller Lumières et Volets
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_cinema
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_boolean.automation_watch_tv
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: state
    entity_id: binary_sensor.presence_rez_de_chaussee
    state: 'on'
  actions:
  - action: scene.create
    metadata: {}
    data:
      scene_id: cinema_previous_light_state
      snapshot_entities:
      - light.cuisine_suspension
      - light.cuisine_comptoir
      - light.salon_trepied
      - light.hue_aurelle_panel_1
      - light.salon_suspension_tv
      - light.salon_buffet_droit
      - light.salon_buffet_gauche
      - light.entree_suspension
      - light.exterieur_sphere
      - light.exterieur_guinguette
      - light.plafonnier_exterieur
      - light.couloir_applique_escalier
      - cover.volets_salon
      - light.hue_white_candle_2
      - light.hue_white_candle_1
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - light.couloir_applique_escalier
      area_id: exterieur
      floor_id: rez_de_chaussee
  - action: hue.activate_scene
    target:
      entity_id: scene.salon_salon_tv_playing
    data: {}
  - if:
    - condition: state
      entity_id: binary_sensor.exterieur_lumineux
      state: 'on'
    then:
    - action: cover.close_cover
      metadata: {}
      data: {}
      target:
        entity_id: cover.volets_salon
  - if:
    - condition: state
      entity_id: input_boolean.mode_cinema
      state: 'on'
    then:
    - wait_for_trigger:
      - trigger: state
        entity_id:
        - input_boolean.mode_cinema
        to: 'off'
      continue_on_timeout: false
  - action: scene.turn_on
    data: {}
    target:
      entity_id: scene.cinema_previous_light_state
  mode: restart
- id: '1732056960522'
  alias: Mode Cinéma - Play / Pause
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - media_player.media_center
    to: paused
    id: paused
  - trigger: state
    entity_id:
    - media_player.media_center
    to: playing
    id: playing
  conditions:
  - condition: state
    entity_id: input_boolean.automation_watch_tv
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: state
    entity_id: input_boolean.mode_cinema
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: state
    entity_id: binary_sensor.presence_rez_de_chaussee
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - paused
      sequence:
      - action: hue.activate_scene
        metadata: {}
        data: {}
        target:
          entity_id:
          - scene.salon_salon_tv_paused
          - scene.entree_entree_tv_paused
          - scene.cuisine_cuisine_tv_paused
    - conditions:
      - condition: trigger
        id:
        - playing
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id:
          - light.couloir_applique_escalier
          area_id: exterieur
          floor_id: rez_de_chaussee
      - action: hue.activate_scene
        target:
          entity_id: scene.salon_salon_tv_playing
        data: {}
  mode: restart
- id: '1732718242168'
  alias: '[TMP] Location Permission Not determined'
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sensor.jean_loics_iphone_location_permission
    to: Not determined
  conditions: []
  actions:
  - action: notify.mobile_app_jean_loics_iphone
    metadata: {}
    data:
      title: ⁉️ Location Permission failed
      message: Not Determined
  mode: single
- id: '1734703658294'
  alias: Réduire volume lorsque assistant vocal en écoute (Salle de Douche)
  description: ''
  use_blueprint:
    path: perso/reduce_volume_of_media_player_when_voice_assistant_listening_v2.yaml
    input:
      assist_satellite_entity: assist_satellite.vpe_dvt_salle_de_douche_satellite_assist
      custom_target:
        entity_id: media_player.sonos_salle_de_douche
- id: '1736027398142'
  alias: Jouer de la musique par la voix (Musique Assistant)
  description: ''
  triggers:
  - command:
    - (Jouer|Joue|Écouter|Écoutez|Ecouter|Ecoutez) {query}
    trigger: conversation
  conditions: []
  actions:
  - if:
    - condition: template
      value_template: '{{ trigger.device_id != None}}'
    then:
    - action: script.jouer_de_la_musique_music_assistant
      metadata: {}
      data:
        query: '{{trigger.slots.query}}'
        area: '{{area_id(trigger.device_id)}}'
      response_variable: media_data
    - set_conversation_response: '{% if media_data.media_type == ''artist'' %}

        Lecture de l''artiste {{media_data.media_id}}

        {% elif media_data.media_type == ''album'' %}

        Lecture de l''album {{media_data.media_id}} {% if ''artist'' in media_data
        %} par {{media_data.artist}} {% endif %}

        {% elif media_data.media_type == ''track'' %}

        Lecture de {{media_data.media_id}} {% if ''artist'' in media_data %} par {{media_data.artist}}
        {% endif %}

        {% endif %}'
    else:
    - set_conversation_response: Cette commande ne fonctionne pas depuis cet appareil
  mode: single
- id: '1736352269100'
  alias: End of the World
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - sun.sun
    to: unavailable
  conditions: []
  actions:
  - action: notify.mobile_app_jean_loics_iphone
    metadata: {}
    data:
      title: Well.
      message: Fuck.
  mode: single
- id: '1736868943182'
  alias: Éteindre Rez-de-Chaussée si plus de présence
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.presence_rez_de_chaussee
    to: 'off'
    for:
      hours: 0
      minutes: 30
      seconds: 0
    trigger: state
  conditions:
  - condition: state
    entity_id: input_boolean.extinction_automatique_des_pieces
    state: 'on'
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      floor_id: rez_de_chaussee
  - action: media_player.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - media_player.media_center
  - action: media_player.media_pause
    metadata: {}
    data: {}
    target:
      entity_id: media_player.kef_salon_music_assistant
  mode: single
- id: '1737233418257'
  alias: Boost Salle de Bain - Activer par le VPE
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.vpe_dvt_salle_de_douche_button_press
  conditions:
  - condition: not
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: event.vpe_dvt_salle_de_douche_button_press
        state: unavailable
      - condition: state
        entity_id: event.vpe_dvt_salle_de_douche_button_press
        state: unknown
  - condition: state
    entity_id: event.vpe_dvt_salle_de_douche_button_press
    attribute: event_type
    state: long_press
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: state
        state: 'off'
        entity_id: input_boolean.chauffage_salle_de_douche_boost
      sequence:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.chauffage_salle_de_douche_boost
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: Boost Chauffage Activé
        target:
          entity_id: assist_satellite.vpe_dvt_salle_de_douche_satellite_assist
    - conditions:
      - condition: state
        state: 'on'
        entity_id: input_boolean.chauffage_salle_de_douche_boost
      sequence:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.chauffage_salle_de_douche_boost
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: Boost Chauffage Désactivé
        target:
          entity_id: assist_satellite.vpe_dvt_salle_de_douche_satellite_assist
  mode: single
- id: '1737975480794'
  alias: Rappels - Notifier rappel calendrier
  description: ''
  triggers:
  - trigger: calendar
    entity_id: calendar.rappels
    event: start
    offset: 0:0:0
  conditions: []
  actions:
  - action: script.power_notification_rappel
    metadata: {}
    data:
      user_message: '{{trigger.calendar_event.summary}}'
      user_tag: '{{as_timestamp(now())}}'
  mode: single
- id: '1737976480635'
  alias: Rappels - Notifier rappel maison vide
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Départ en cours
  conditions:
  - condition: numeric_state
    entity_id: todo.rappels_maison_vide
    above: 0
  actions:
  - action: todo.get_items
    target:
      entity_id: todo.rappels_maison_vide
    data:
      status: needs_action
    metadata: {}
    response_variable: reminders
  - variables:
      reminder_list: "[\n{% for item in reminders['todo.rappels_maison_vide'][\"items\"]
        %}\n  \"{{item.summary}}\",\n{% endfor %}\n]\n"
  - repeat:
      sequence:
      - action: script.power_notification_rappel_maison_vide
        metadata: {}
        data:
          user_message: '{{repeat.item}}'
          user_tag: '{{repeat.item[:64]}}'
      for_each: '{{reminder_list}}'
  mode: single
- id: '1737976815103'
  alias: Rappels - Notifier rappel maison occupée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Arrivée en cours
  conditions:
  - condition: numeric_state
    entity_id: todo.rappels_maison_occupee
    above: 0
  actions:
  - action: todo.get_items
    target:
      entity_id:
      - todo.rappels_maison_occupee
    data:
      status: needs_action
    metadata: {}
    response_variable: reminders
  - variables:
      reminder_list: "[\n{% for item in reminders['todo.rappels_maison_occupee'][\"items\"]
        %}\n  \"{{item.summary}}\",\n{% endfor %}\n]\n"
  - repeat:
      sequence:
      - action: script.power_notification_rappel_maison_occupee
        metadata: {}
        data:
          user_message: '{{repeat.item}}'
          user_tag: '{{repeat.item[:64]}}'
      for_each: '{{reminder_list}}'
  mode: single
- id: '1738676615343'
  alias: Bureau - Notification Lumineuse Qualité de l'air
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.qualite_de_l_air_bureau
    to: 'on'
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Occupée
  - condition: state
    entity_id: binary_sensor.capteur_presence_bureau_occupancy
    state: 'on'
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: state
    entity_id: input_boolean.mode_sommeil
    state: 'off'
  actions:
  - action: scene.create
    data:
      scene_id: office_webcam_previous_light_state
      snapshot_entities:
      - light.hue_play_bars
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - action: light.turn_on
    metadata: {}
    data:
      rgb_color:
      - 255
      - 0
      - 0
      brightness_pct: 100
    target:
      entity_id: light.hue_play_bars
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - action: scene.turn_on
    data: {}
    target:
      entity_id: scene.office_webcam_previous_light_state
  mode: single
- id: '1739568563693'
  alias: Assist - Fallback Assistant lors d'une panne d'internet
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.internet
    from: 'on'
    to: 'off'
    id: no_internet
  - trigger: state
    entity_id:
    - binary_sensor.internet
    from: 'off'
    to: 'on'
    id: internet
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - no_internet
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: Local
        target:
          entity_id:
          - select.vpe_salon_assistant
          - select.vpe_bureau_assistant
          - select.vpe_chambre_assistant
          - select.vpe_cuisine_assistant
          - select.vpe_chambre_marilou_assistant
          - select.vpe_dvt_salle_de_douche_assistant
    - conditions:
      - condition: trigger
        id:
        - internet
      sequence:
      - action: select.select_option
        metadata: {}
        data:
          option: preferred
        target:
          entity_id:
          - select.vpe_salon_assistant
          - select.vpe_bureau_assistant
          - select.vpe_chambre_assistant
          - select.vpe_cuisine_assistant
          - select.vpe_chambre_marilou_assistant
          - select.vpe_dvt_salle_de_douche_assistant
  mode: single
- id: '1740752651459'
  alias: Mode Sommeil Marilou - Activer par VPE
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - event.vpe_chambre_marilou_button_press
  conditions:
  - condition: not
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: event.vpe_chambre_marilou_button_press
        state: unavailable
      - condition: state
        entity_id: event.vpe_chambre_marilou_button_press
        state: unknown
  - condition: state
    entity_id: event.vpe_chambre_marilou_button_press
    state: long_press
    attribute: event_type
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'off'
      sequence:
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.mode_sommeil_marilou
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: Bonne nuit Marilou!
        target:
          entity_id: assist_satellite.vpe_chambre_marilou_satellite_assist
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'on'
      sequence:
      - action: input_boolean.turn_off
        target:
          entity_id:
          - input_boolean.mode_sommeil_marilou
        data: {}
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - action: assist_satellite.announce
        metadata: {}
        data:
          message: Bonjour Marilou!
        target:
          entity_id:
          - assist_satellite.vpe_chambre_marilou_satellite_assist
  mode: single
- id: '1740752921943'
  alias: Mode Sommeil Marilou - Actions
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil_marilou
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'on'
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          area_id: couloir
      - action: scene.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: scene.scenes_hue_chambre_marilou_lecture
      - action: script.start_marilou_bedtime_routine
        metadata: {}
        data: {}
      - if:
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_fenetre_chambre_bebe
          state: 'off'
        then:
        - action: cover.close_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideau_chambre_marilou
          enabled: true
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          area_id: chambre_bebe
      - action: media_player.media_pause
        data: {}
        target:
          entity_id:
          - media_player.vpe_chambre_marilou_music_assistant
      - if:
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_fenetre_chambre_bebe
          state: 'off'
        then:
        - action: cover.open_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideau_chambre_marilou
          enabled: true
      - if:
        - condition: state
          entity_id: binary_sensor.exterieur_lumineux
          state: 'off'
        then:
        - action: scene.turn_on
          metadata: {}
          data: {}
          target:
            entity_id: scene.scenes_hue_chambre_marilou_lecture
  mode: single
- id: '1740753985952'
  alias: VoiceKit Chambre Marilou - Controller Volume
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil_marilou
    for:
      hours: 0
      minutes: 0
      seconds: 10
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'on'
      sequence:
      - action: media_player.volume_set
        metadata: {}
        data:
          volume_level: 0.1
        target:
          entity_id: media_player.vpe_chambre_marilou_media_player
    default:
    - action: media_player.volume_set
      metadata: {}
      data:
        volume_level: 0.6
      target:
        entity_id: media_player.vpe_chambre_marilou_media_player
  mode: single
- id: '1741603027915'
  alias: Mode Chien - Actions
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_chien
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
  - trigger: state
    entity_id:
    - input_boolean.guest_mode
  - trigger: state
    entity_id:
    - input_boolean.automation_presence_simulator
  - trigger: state
    entity_id:
    - binary_sensor.exterieur_lumineux
  conditions:
  - condition: state
    entity_id: input_select.modes_de_presence_de_la_maison_v2
    state: Vide
  - condition: state
    entity_id: input_boolean.guest_mode
    state: 'off'
  - condition: state
    entity_id: input_boolean.automation_presence_simulator
    state: 'off'
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_chien
        state: 'on'
      sequence:
      - if:
        - condition: state
          entity_id: binary_sensor.capteur_ouverture_fenetre_bureau
          state: 'off'
        then:
        - action: cover.open_cover
          metadata: {}
          data: {}
          target:
            entity_id: cover.rideau_bureau
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          floor_id:
          - rez_de_chaussee
          - premier_etage
          area_id: exterieur
      - choose:
        - conditions:
          - condition: state
            entity_id: binary_sensor.exterieur_lumineux
            state: 'on'
          sequence:
          - action: cover.set_cover_position
            metadata: {}
            data:
              position: 30
            target:
              entity_id: cover.volets_salon
        - conditions:
          - condition: state
            entity_id: binary_sensor.exterieur_lumineux
            state: 'off'
          sequence:
          - action: light.turn_on
            metadata: {}
            data:
              brightness_pct: 5
            target:
              area_id:
              - bd4ba6262e7a4e72b2fd740a22c70403
              entity_id: light.bureau
          - action: cover.close_cover
            metadata: {}
            data: {}
            target:
              entity_id: cover.volets_salon
    - conditions:
      - condition: state
        entity_id: input_boolean.mode_chien
        state: 'off'
      sequence:
      - action: script.leave_home
        metadata: {}
        data: {}
  mode: single
- id: '1741603540670'
  alias: Mode chien - Désactiver lors du retour a la maison
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_select.modes_de_presence_de_la_maison_v2
    to: Occupée
  conditions: []
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.mode_chien
  mode: single
- id: '1741604729527'
  alias: Contrôler la sonnette avec les modes sommeil
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil
  - trigger: state
    entity_id:
    - input_boolean.mode_sommeil_marilou
  - trigger: homeassistant
    event: start
  conditions: []
  actions:
  - if:
    - condition: or
      conditions:
      - condition: state
        entity_id: input_boolean.mode_sommeil
        state: 'on'
      - condition: state
        entity_id: input_boolean.mode_sommeil_marilou
        state: 'on'
    then:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: switch.doorbell
    else:
    - action: switch.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: switch.doorbell
  mode: single
- id: '1742072094434'
  alias: VPE Douche - Affichage Boost Chauffage
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.chauffage_salle_de_douche_boost
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.chauffage_salle_de_douche_boost
        state: 'on'
      sequence:
      - action: light.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: light.vpe_dvt_salle_de_douche_led_ring
    - conditions:
      - condition: state
        entity_id: input_boolean.chauffage_salle_de_douche_boost
        state: 'off'
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: light.vpe_dvt_salle_de_douche_led_ring
  mode: single
- id: '1742996542028'
  alias: Serrure - Notifier si porte ouverte et serrure vérouillée
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - lock.serrure_porte_d_entree
    to: locked
  conditions:
  - condition: state
    entity_id: binary_sensor.capteur_ouverture_porte_entree
    state: 'on'
  actions:
  - action: script.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: script.power_notification_serrure_verouillee_sur_porte_ouverte
  mode: single
